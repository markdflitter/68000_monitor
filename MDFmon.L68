00000104 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 27/05/2021 19:12:40

00000000                             1  *------------------------------------------------------------
00000000                             2  * Title         MDFmon 
00000000                             3  * Written by    Mark Flitter
00000000                             4  * Date          March 2021
00000000                             5  * Description:  68000 monitor program
00000000                             6  *-----------------------------------------------------------
00000000                             7  
00000000                             8      ORG  $0
00000000                             9  
00000000  =00000000                 10  DEBUG               EQU 0
00000000                            11  
00000000                            12  ; constants
00000000  =00000000                 13  NULL                EQU 0
00000000  =00000009                 14  TAB                 EQU 9
00000000  =0000000D                 15  CR                  EQU 13
00000000  =0000000A                 16  LF                  EQU 10
00000000                            17  
00000000  =00000000                 18  ROM                 EQU $0
00000000  =00200000                 19  RAM                 EQU $200000
00000000  =002E0000                 20  STACK_ADDRESS       EQU $2E0000
00000000                            21  
00000000  =00A00000                 22  MC68230_BASE        EQU $A00000
00000000  =00000000                 23  MC68230_GENERAL_CONTROL_    EQU $0
00000000  =00000001                 24  MC68230_SERVICE_REQUEST_    EQU $1
00000000  =00000002                 25  MC68230_PORT_A_DIRECTION_   EQU $2
00000000  =00000003                 26  MC68230_PORT_B_DIRECTION_   EQU $3
00000000  =00000004                 27  MC68230_PORT_C_DIRECTION_   EQU $4
00000000  =00000005                 28  MC68230_INTERRUPT_VECTOR_   EQU $5
00000000  =00000006                 29  MC68230_PORT_A_CONTROL_     EQU $6
00000000  =00000007                 30  MC68230_PORT_B_CONTROL_     EQU $7
00000000  =00000008                 31  MC68230_PORT_A_DATA_        EQU $8
00000000  =00000009                 32  MC68230_PORT_B_DATA_        EQU $9
00000000  =0000000A                 33  MC68230_PORT_A_ALTERNATE_   EQU $A
00000000  =0000000B                 34  MC68230_PORT_B_ALTERNATE_   EQU $B
00000000  =0000000C                 35  MC68230_PORT_C_DATA_        EQU $C
00000000  =0000000D                 36  MC68230_STATUS_             EQU $D
00000000                            37  
00000000  =00A00001                 38  MC68230_GENERAL_CONTROL     EQU MC68230_BASE+2*MC68230_GENERAL_CONTROL_+1
00000000  =00A00003                 39  MC68230_SERVICE_REQUEST     EQU MC68230_BASE+2*MC68230_SERVICE_REQUEST_+1
00000000  =00A00005                 40  MC68230_PORT_A_DIRECTION    EQU MC68230_BASE+2*MC68230_PORT_A_DIRECTION_+1
00000000  =00A00007                 41  MC68230_PORT_B_DIRECTION    EQU MC68230_BASE+2*MC68230_PORT_B_DIRECTION_+1
00000000  =00A00009                 42  MC68230_PORT_C_DIRECTION    EQU MC68230_BASE+2*MC68230_PORT_C_DIRECTION_+1
00000000  =00000000                 43  MC68230_PORT_DIRECTION_READ EQU 0
00000000  =000000FF                 44  MC68230_PORT_DIRECTION_WRITE EQU $FF
00000000                            45  
00000000  =00A0000B                 46  MC68230_INTERRUPT_VECTOR    EQU MC68230_BASE+2*MC68230_INTERRUPT_VECTOR_+1
00000000  =00A0000D                 47  MC68230_PORT_A_CONTROL      EQU MC68230_BASE+2*MC68230_PORT_A_CONTROL_+1
00000000  =00A0000F                 48  MC68230_PORT_B_CONTROL      EQU MC68230_BASE+2*MC68230_PORT_B_CONTROL_+1
00000000  =00A00011                 49  MC68230_PORT_A_DATA         EQU MC68230_BASE+2*MC68230_PORT_A_DATA_+1
00000000  =00A00013                 50  MC68230_PORT_B_DATA         EQU MC68230_BASE+2*MC68230_PORT_B_DATA_+1
00000000  =00A00015                 51  MC68230_PORT_A_ALTERNATE    EQU MC68230_BASE+2*MC68230_PORT_A_ALTERNATE_+1
00000000  =00A00017                 52  MC68230_PORT_B_ALTERNATE    EQU MC68230_BASE+2*MC68230_PORT_B_ALTERNATE_+1
00000000  =00A00019                 53  MC68230_PORT_C_DATA         EQU MC68230_BASE+2*MC68230_PORT_C_DATA_+1
00000000  =00000020                 54  MC68230_PORT_C_READ         EQU $20
00000000  =00000010                 55  MC68230_PORT_C_WRITE        EQU $10
00000000  =00000008                 56  MC68230_PORT_C_CS           EQU $08
00000000  =00A0001B                 57  MC68230_STATUS              EQU MC68230_BASE+2*MC68230_STATUS_+1
00000000                            58  
00000000  =00000020                 59  MC68230_PORT_C_READ         EQU $20
00000000  =00000010                 60  MC68230_PORT_C_WRITE        EQU $10
00000000  =00000008                 61  MC68230_PORT_C_CS           EQU $08
00000000                            62  
00000000  =00000000                 63  IDE_DATA_REGISTER           EQU 0
00000000  =00000002                 64  IDE_SECTOR_COUNT_REGISTER   EQU 2
00000000  =00000003                 65  IDE_LBA_0_7_REGISTER        EQU 3
00000000  =00000004                 66  IDE_LBA_8_15_REGISTER       EQU 4
00000000  =00000005                 67  IDE_LBA_16_23_REGISTER      EQU 5
00000000  =00000006                 68  IDE_DRIVESEL_REGISTER       EQU 6
00000000  =000000E0                 69  IDE_DRIVESEL_MASTER         EQU $E0
00000000                            70  
00000000  =00000007                 71  IDE_COMMAND_REGISTER        EQU 7
00000000  =00000020                 72  IDE_COMMAND_READ_WITH_RETRY         EQU $20
00000000                            73  
00000000  =00000007                 74  IDE_STATUS_REGISTER         EQU 7
00000000  =00000007                 75  IDE_STATUS_BUSY             EQU 7
00000000  =00000006                 76  IDE_STATUS_READY            EQU 6
00000000  =00000003                 77  IDE_STATUS_DRQ              EQU 3
00000000                            78  
00000000  =00C00000                 79  DUART_BASE          EQU $C00000
00000000  =00000000                 80  DUART_MRA_          EQU $0
00000000  =00000001                 81  DUART_CSRA_         EQU $1
00000000  =00000001                 82  DUART_SRA_          EQU $1
00000000  =00000002                 83  DUART_CRA_          EQU $2
00000000  =00000003                 84  DUART_TXA_          EQU $3
00000000  =00000003                 85  DUART_RXA_          EQU $3
00000000  =00000004                 86  DUART_ACR_          EQU $4
00000000  =00000005                 87  DUART_IMR_          EQU $5
00000000  =00000006                 88  DUART_CTUR_         EQU $6
00000000  =00000007                 89  DUART_CTLR_         EQU $7
00000000  =00000008                 90  DUART_MRB_          EQU $8
00000000  =00000009                 91  DUART_CSRB_         EQU $9
00000000  =00000009                 92  DUART_SRB_          EQU $9
00000000  =0000000A                 93  DUART_CRB_          EQU $A
00000000  =0000000B                 94  DUART_TXB_          EQU $B
00000000  =0000000B                 95  DUART_RXB_          EQU $B
00000000  =0000000C                 96  DUART_IVR_          EQU $C
00000000  =0000000D                 97  DUART_OPCR_         EQU $D
00000000  =0000000E                 98  DUART_SET_OPR_      EQU $E
00000000  =0000000F                 99  DUART_RESET_OPR_    EQU $F
00000000                           100  
00000000  =00C00001                101  DUART_MRA           EQU DUART_BASE+2*DUART_MRA_+1
00000000  =00C00003                102  DUART_SRA           EQU DUART_BASE+2*DUART_SRA_+1
00000000  =00C00003                103  DUART_CSRA          EQU DUART_BASE+2*DUART_CSRA_+1
00000000  =00C00005                104  DUART_CRA           EQU DUART_BASE+2*DUART_CRA_+1
00000000  =00C00007                105  DUART_TXA           EQU DUART_BASE+2*DUART_TXA_+1
00000000  =00C00007                106  DUART_RXA           EQU DUART_BASE+2*DUART_RXA_+1
00000000                           107  
00000000  =00C00011                108  DUART_MRB           EQU DUART_BASE+2*DUART_MRB_+1
00000000  =00C00013                109  DUART_SRB           EQU DUART_BASE+2*DUART_SRB_+1
00000000  =00C00013                110  DUART_CSRB          EQU DUART_BASE+2*DUART_CSRB_+1
00000000  =00C00015                111  DUART_CRB           EQU DUART_BASE+2*DUART_CRB_+1
00000000  =00C00017                112  DUART_TXB           EQU DUART_BASE+2*DUART_TXB_+1
00000000  =00C00017                113  DUART_RXB           EQU DUART_BASE+2*DUART_RXB_+1
00000000                           114  
00000000  =00C00009                115  DUART_ACR           EQU DUART_BASE+2*DUART_ACR_+1
00000000  =00C0000B                116  DUART_IMR           EQU DUART_BASE+2*DUART_IMR_+1
00000000  =00C0000D                117  DUART_CTUR          EQU DUART_BASE+2*DUART_CTUR_+1
00000000  =00C0000F                118  DUART_CTLR          EQU DUART_BASE+2*DUART_CTLR_+1
00000000  =00C00019                119  DUART_IVR           EQU DUART_BASE+2*DUART_IVR_+1
00000000  =00C0001B                120  DUART_OPCR          EQU DUART_BASE+2*DUART_OPCR_+1
00000000  =00C0001D                121  DUART_SET_OPR       EQU DUART_BASE+2*DUART_SET_OPR_+1
00000000  =00C0001F                122  DUART_RESET_OPR     EQU DUART_BASE+2*DUART_RESET_OPR_+1
00000000                           123  
00000000  =00E00000                124  DISPLAY_BASE        EQU $E00000
00000000  =00000000                125  DISPLAY_            EQU $0
00000000  =00E00001                126  DISPLAY             EQU DISPLAY_BASE+2*DISPLAY_+1
00000000                           127  
00000000                           128  ; macros
00000000                           129  ; convert top 4 bits of input register from binary to a single hex digit
00000000                           130  ; the input register is changed during the process
00000000                           131  ; \1 input data register containing binary number, \2 data register for return value, \3 working address register
00000000                           132  BIN2HEX MACRO
00000000                           133      LEA BIN2HEX_LUT(PC),\3                          ; load the lookup table
00000000                           134      ROL.L #4,\1                                     ; shift the top 4 bits down to bottom of the register the and mask off everything else
00000000                           135      MOVE.B \1,\2
00000000                           136      ANDI.L #$F,\2
00000000                           137      MOVE.B 0(\3,\2),\2                              ; use that as an index into the LUT
00000000                           138      ENDM
00000000                           139  
00000000                           140  ; convert single hex digit to 4 bit binary number in LSbits
00000000                           141  ; the input register is changed during the process
00000000                           142  ; \1 data register containing hex character, \2 data register for return value, \3 working address register
00000000                           143  HEX2BIN MACRO
00000000                           144      LEA HEX2BIN_LUT(PC),\3                          ; load the lookup table
00000000                           145      SUB.B #'0',\1                                   ; work out offset and mask off anything rogue
00000000                           146      AND.L #$FF,\1                                   ; ignore the top 3 bytes
00000000                           147      MOVE.B 0(\3,\1),\2                              ; use that as an index into the LUT   
00000000                           148      ENDM
00000000                           149  
00000000                           150  ; send a single char to the serial port
00000000                           151  ; \1 = char to send, \2 = data register to use for status poll
00000000                           152  ; will stamp on D0 and D1 in debug mode
00000000                           153  PRINT_CHAR MACRO
00000000                           154  WAIT_FOR_READY\@                                    ; wait until the there is space to send
00000000                           155      IFEQ DEBUG
00000000                           156          MOVE.B DUART_SRA,\2                         ; read status register
00000000                           157          BTST #2,\2                                  ; check for space to send
00000000                           158          BEQ WAIT_FOR_READY\@                        ; no space, check again
00000000                           159          MOVE.B \1,DUART_TXA                         ; send the next character
00000000                           160      ENDC
00000000                           161  
00000000                           162      IFNE DEBUG
00000000                           163          MOVE.B \1,D1
00000000                           164          MOVE.L #6,D0   
00000000                           165          TRAP #15                                    ; write to terminal in simulator
00000000                           166      ENDC
00000000                           167  
00000000                           168      ENDM
00000000                           169  
00000000                           170  ; send CR,LF to the serial port
00000000                           171  ; \1 = data register to use for status poll, /2 = working address register
00000000                           172  PRINT_CRLF MACRO
00000000                           173      LEA CRLF(PC),\2
00000000                           174      PRINT_STR \2,\1
00000000                           175      ENDM
00000000                           176  
00000000                           177  ; send C-style, zero terminated string to the serial port
00000000                           178  ; \1 = address register containing address of zero terminated string, \2 = data register to use for status poll, 
00000000                           179  PRINT_STR MACRO
00000000                           180  LOOP\@
00000000                           181      CMP.B #NULL,(\1)                                ; 0 -> done
00000000                           182      BEQ EXIT\@
00000000                           183      PRINT_CHAR (\1)+,\2
00000000                           184      BRA LOOP\@
00000000                           185  EXIT\@
00000000                           186      ENDM
00000000                           187    
00000000                           188  ; send the contents of a data register to the serial port as a 1 digit hex number
00000000                           189  ; \1 = data register containing binary number, \2 = data register to use for status poll, \3 working data register, \4 working address register
00000000                           190  PRINT_REG_4BIT MACRO
00000000                           191      LEA BIN2HEX_LUT(PC),\4                          ; load the lookup table
00000000                           192      MOVE.B \1,\3
00000000                           193      ANDI.L #$F,\3
00000000                           194      MOVE.B 0(\4,\3),\3                              ; use that as an index into the LUT
00000000                           195      PRINT_CHAR \3,\2
00000000                           196      ENDM
00000000                           197  
00000000                           198  ; send the contents of a data register to the serial port as a 8 digit hex number
00000000                           199  ; \1 = data register containing binary number, \2 = data register to use for status poll, \3 working data register, \4 counter register, \5 working address register
00000000                           200  PRINT_REG MACRO
00000000                           201      LEA ox(PC),\5
00000000                           202      PRINT_STR \5,\2
00000000                           203      MOVE.L #7,\4                                    ; loop round all 8 hex characters of 4 bits each
00000000                           204  LOOP\@
00000000                           205      BIN2HEX \1,\3,\5
00000000                           206      PRINT_CHAR \3,\2
00000000                           207      DBEQ \4,LOOP\@
00000000                           208      ENDM
00000000                           209  
00000000                           210  ; wait for a char from the serial port
00000000                           211  ; \ 1= data register for read char, \2 = register to use for status poll
00000000                           212  ; will stamp on D0 and D1 in debug mode
00000000                           213  WAIT_CHAR MACRO
00000000                           214  WAIT_FOR_READY\@                                    ; wait until the there is space to send
00000000                           215      IFEQ DEBUG
00000000                           216          MOVE.B DUART_SRA,\2                         ; read status register
00000000                           217          BTST #0,\2                                  ; check for character
00000000                           218          BEQ WAIT_FOR_READY\@                        ; nothing, check again
00000000                           219      ENDC
00000000                           220  
00000000                           221      READ_CHAR \1
00000000                           222  
00000000                           223      IFEQ DEBUG
00000000                           224          PRINT_CHAR \1,\2                            ; echo it back
00000000                           225      ENDC
00000000                           226      ENDM
00000000                           227  
00000000                           228  ; read a char from the serial port - assumes that there is one!
00000000                           229  ; \ 1= data register for read char
00000000                           230  ; will stamp on D0 and D1 in debug mode
00000000                           231  READ_CHAR MACRO
00000000                           232      IFEQ DEBUG
00000000                           233          MOVE.B DUART_RXA,\1                         ; got a character, read it
00000000                           234      ENDC
00000000                           235      IFNE DEBUG
00000000                           236          MOVE.L #5,D0    
00000000                           237          TRAP #15                                    ; read from keyboard in simulator
00000000                           238          MOVE.L D1,\1
00000000                           239      ENDC
00000000                           240  
00000000                           241      CMP.B #$1B,\1                                   ; check for escape and go to start
00000000                           242      BEQ START
00000000                           243      ENDM
00000000                           244  
00000000                           245  
00000000                           246  ; read data from the download serial port
00000000                           247  ; \ 1= data register for read char
00000000                           248  DOWNLOAD MACRO
00000000                           249  WAIT_FOR_READY\@                                    ; wait until the there is space to send
00000000                           250  
00000000                           251      MOVE.B DUART_SRA,\1                             ; check for command
00000000                           252      BTST #0,\1                                      ; check for character
00000000                           253      BEQ CONTINUE\@                                  ; nothing, continue
00000000                           254  
00000000                           255      READ_CHAR \1                                    ; we're not going to do anything with it, just check for escape
00000000                           256  CONTINUE\@
00000000                           257      MOVE.B DUART_SRB,\1                             ; read download status register
00000000                           258      BTST #0,\1                                      ; check for character
00000000                           259      BEQ WAIT_FOR_READY\@                            ; nothing, check again
00000000                           260      
00000000                           261      MOVE.B DUART_RXB,\1                             ; got a character, read it
00000000                           262      MOVE.B \1,DISPLAY                               ; echo to the display
00000000                           263  
00000000                           264      ENDM
00000000                           265  
00000000                           266  ; unprotect the EEPROM
00000000                           267  UNPROTECT MACRO
00000000                           268      MOVE.W #$AAAA,$2AAA                             ; remove write protect
00000000                           269      NOP
00000000                           270      MOVE.W #$5555,$1554
00000000                           271      NOP
00000000                           272      MOVE.W #$8080,$2AAA
00000000                           273      NOP
00000000                           274      MOVE.W #$AAAA,$2AAA
00000000                           275      NOP
00000000                           276      MOVE.W #$5555,$1554
00000000                           277      NOP
00000000                           278      MOVE.W #$2020,$2AAA
00000000                           279      ENDM
00000000                           280      
00000000                           281  ; protect the EEPROM
00000000                           282  PROTECT MACRO
00000000                           283      MOVE.W #$AAAA,$2AAA                             ; and write protect
00000000                           284      MOVE.W #$5555,$1554
00000000                           285      MOVE.W #$A0A0,$2AAA
00000000                           286      ENDM
00000000                           287  
00000000                           288  
00000000                           289  ; read two hex digits from the download serial port and convert to a byte
00000000                           290  ; \1 result register, \2 = data register for read char, \3 = register to use for status poll, \4 = working data register, \5 = checksum register, \6 = working address register
00000000                           291  DOWNLOAD_BYTE MACRO
00000000                           292      MOVE.B #2,\4
00000000                           293      WHILE.B \4 <GT> 0 DO
00000000                           294          LSL.L #4,\1                                 ; it's OK to do this first, because we are either starting from 0, 
00000000                           295          DOWNLOAD \2                                 ; or we are reading the next byte along, so need to shift up the previous one
00000000                           296          ;PRINT_CHAR \2,\3
00000000                           297          HEX2BIN \2,\2,\6
00000000                           298          OR.B \2,\1
00000000                           299          SUB.B #1,\4
00000000                           300      ENDW
00000000                           301  
00000000                           302      MOVE.L #0,\2                                    ; rextract latest byte of address and add into checksum
00000000                           303      MOVE.B \1,\2
00000000                           304      ADD.L \1,\5
00000000                           305  
00000000                           306      ENDM
00000000                           307  
00000000                           308  ; write word to EEPROM
00000000                           309  ; \1 word to write, \2 = target address, \3 = working data register
00000000                           310  PROGRAM MACRO
00000000                           311    MOVE.W \1,\2                                      ; write the data
00000000                           312  
00000000                           313  WAIT_FOR_COMPLETE\@
00000000                           314          MOVE.W \2,\3
00000000                           315  
00000000                           316          IF.W \3 <NE> \1 THEN
00000000                           317              BRA WAIT_FOR_COMPLETE\@
00000000                           318          ENDI
00000000                           319          ENDM
00000000                           320          
00000000                           321  ; program vector to EEPROM
00000000                           322  ; \1 handler address, \2 = target address, \3 = working data register
00000000                           323  PROGRAM_VECTOR MACRO
00000000                           324      ADD.L #2,\2
00000000                           325      PROGRAM \1, (\2), \3                            ; write it
00000000                           326      LSR.L #8,\1
00000000                           327      LSR.L #8,\1
00000000                           328      SUB.L #2,\2
00000000                           329      PROGRAM \1, (\2), \3
00000000                           330      ENDM
00000000                           331  
00000000                           332  ; read an ide register
00000000                           333  ; \1 = register to read, \2 = data register for result, \3 = working data register 
00000000                           334  READ_8 MACRO
00000000                           335      MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00000000                           336      MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), \3
00000000                           337      ORI.B \1, \3
00000000                           338      MOVE.B \3, MC68230_PORT_C_DATA
00000000                           339      ANDI.B #~MC68230_PORT_C_READ, \3
00000000                           340      MOVE.B \3, MC68230_PORT_C_DATA
00000000                           341      MOVE.B MC68230_PORT_B_DATA, \2
00000000                           342      ORI.B #MC68230_PORT_C_READ, \3
00000000                           343      MOVE.B \3, MC68230_PORT_C_DATA
00000000                           344      MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00000000                           345      ENDM
00000000                           346      
00000000                           347  ; write an ide register
00000000                           348  ; \1 = value to write, \2 = register to write, \3 = working data register 
00000000                           349  WRITE_8 MACRO
00000000                           350      MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
00000000                           351      MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), \3
00000000                           352      ORI.B \2, \3
00000000                           353      MOVE.B \3, MC68230_PORT_C_DATA
00000000                           354      ANDI.B #~MC68230_PORT_C_WRITE, \3
00000000                           355      MOVE.B \1, MC68230_PORT_B_DATA
00000000                           356      MOVE.B \3, MC68230_PORT_C_DATA
00000000                           357      ORI.B #MC68230_PORT_C_WRITE, \3
00000000                           358      MOVE.B \3, MC68230_PORT_C_DATA
00000000                           359      MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00000000                           360      ENDM
00000000                           361  
00000000                           362  ; read ide data
00000000                           363  ; \1 = register to read, \2 = data register for result, \3 = working data register 
00000000                           364  READ_16 MACRO
00000000                           365      MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00000000                           366      MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00000000                           367      
00000000                           368      MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), \3    
00000000                           369      ORI.B \1, \3
00000000                           370      MOVE.B \3, MC68230_PORT_C_DATA
00000000                           371      ANDI.B #~MC68230_PORT_C_READ, \3
00000000                           372      MOVE.B \3, MC68230_PORT_C_DATA
00000000                           373      MOVE.B MC68230_PORT_A_DATA, \2
00000000                           374      LSL.W #8, \2
00000000                           375      MOVE.B MC68230_PORT_B_DATA, \2
00000000                           376      ORI.B #MC68230_PORT_C_READ, \3
00000000                           377      MOVE.B \3, MC68230_PORT_C_DATA
00000000                           378      MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00000000                           379      ENDM
00000000                           380      
00000000                           381  ; read ide data
00000000                           382  ; \1 = register to read, \2 = data register for result, \3 = working data register 
00000000                           383  READ_32 MACRO
00000000                           384      READ_16 \1, \2, \3
00000000                           385      LSL.L #8, \2
00000000                           386      LSL.L #8, \2
00000000                           387      READ_16 \1, \2, \3
00000000                           388      ENDM
00000000                           389          
00000000                           390  ; read ide status
00000000                           391  ;\1 = data register for result, \2 = working data register 
00000000                           392  READ_IDE_STATUS MACRO   
00000000                           393      READ_8 #IDE_STATUS_REGISTER, \1, \2
00000000                           394      ENDM
00000000                           395      
00000000                           396  ; wait for ide drive to be ready
00000000                           397  ;\1 = working data register 1, \2 = working data register 2
00000000                           398  WAIT_DRIVE_READY MACRO
00000000                           399  LOOP\@
00000000                           400      READ_IDE_STATUS \1, \2
00000000                           401      BTST #IDE_STATUS_READY, \1
00000000                           402      BEQ LOOP\@
00000000                           403      ENDM
00000000                           404      
00000000                           405  ; wait for ide drive to be not busy
00000000                           406  ;\1 = working data register 1, \2 = working data register 2
00000000                           407  WAIT_DRIVE_NOT_BUSY MACRO
00000000                           408  LOOP\@
00000000                           409      READ_IDE_STATUS \1, \2
00000000                           410      BTST #IDE_STATUS_BUSY, \1
00000000                           411      BNE LOOP\@
00000000                           412      ENDM
00000000                           413      
00000000                           414  ; wait for ide drive to have data for us
00000000                           415  ;\1 = working data register 1, \2 = working data register 2
00000000                           416  WAIT_DRIVE_DRQ MACRO
00000000                           417  LOOP\@
00000000                           418      READ_IDE_STATUS \1, \2
00000000                           419      BTST #IDE_STATUS_DRQ, \1
00000000                           420      BEQ LOOP\@
00000000                           421      ENDM
00000000                           422      
00000000                           423  ; prepare to send a read command
00000000                           424  ; \1 = block number, \2 = working data register 1, /3 = working data register 2, /4 = working data register 3
00000000                           425  SET_READ_ADDRESS MACRO
00000000                           426      WRITE_8 #1, #IDE_SECTOR_COUNT_REGISTER, \2
00000000                           427      MOVE.L \1,\3
00000000                           428      WRITE_8 \3, #IDE_LBA_0_7_REGISTER, \2
00000000                           429      LSR.L #8, \3
00000000                           430      WRITE_8 \3, #IDE_LBA_8_15_REGISTER, \2
00000000                           431      LSR.L #8, \3                                
00000000                           432      WRITE_8 \3, #IDE_LBA_16_23_REGISTER, \2
00000000                           433      LSR.L #8, \3
00000000                           434      READ_8 #IDE_DRIVESEL_REGISTER, \4, \2
00000000                           435      ANDI.B #$0F,\3
00000000                           436      OR.B \3,\4
00000000                           437      WRITE_8 \4, #IDE_DRIVESEL_REGISTER, \2
00000000                           438      ENDM
00000000                           439  
00000000                           440  ; send command
00000000                           441  ; \1 = command, \2 = working data register 1,
00000000                           442  SEND_COMMAND MACRO
00000000                           443      WRITE_8 \1, #IDE_COMMAND_REGISTER, \2
00000000                           444      ENDM
00000000                           445      
00000000                           446  ; send read command and wait
00000000                           447  ; \1 = block to read, \2 = working data register 1, \2 = working data register 2, \2 = working data register 3
00000000                           448  SEND_READ_COMMAND_AND_WAIT MACRO
00000000                           449      WAIT_DRIVE_NOT_BUSY \2, \3
00000000                           450      SET_READ_ADDRESS \1, \2, \3, \4
00000000                           451      SEND_COMMAND #IDE_COMMAND_READ_WITH_RETRY, \2
00000000                           452      WAIT_DRIVE_NOT_BUSY \2, \3
00000000                           453      WAIT_DRIVE_DRQ \2, \3
00000000                           454      ENDM
00000000                           455  
00000000                           456  ; register catalogue
00000000                           457  ; D0 - used for simulator I/O
00000000                           458  ; D1 - used for simulator I/O
00000000                           459  ; D2 - read character
00000000                           460  ; D3 - serial port status poll / task for TRAP in simulator
00000000                           461  ; D6 - working register used in R/W
00000000                           462  ; D7 - address accumulator, reset by download
00000000                           463  ; A0 - address of string to print 
00000000                           464  
00000000                           465  ; start vector
00000000= 002E0000                 466  STACK   DC.L STACK_ADDRESS                      ; STACK
00000004= 00000104                 467  RESET   DC.L START                              ; RESET
00000008= 000023F2                 468  VECS    DC.L BUS_ERROR_HANDLER                  ; BUS ERROR
0000000C= 000023F2                 469          DC.L BUS_ERROR_HANDLER                  ; ADDRESS ERROR
00000010= 00002546                 470          DC.L ILLEGAL_HANDLER                    ; ILLEGAL INSTRUCTION
00000014= 00002556                 471          DC.L UNHANDLED_HANDLER
00000018= 00002556                 472          DC.L UNHANDLED_HANDLER
0000001C= 00002556                 473          DC.L UNHANDLED_HANDLER
00000020= 00002556                 474          DC.L UNHANDLED_HANDLER
00000024= 00002556                 475          DC.L UNHANDLED_HANDLER
00000028= 00002556                 476          DC.L UNHANDLED_HANDLER
0000002C= 00002556                 477          DC.L UNHANDLED_HANDLER
00000030= 00002556                 478          DC.L UNHANDLED_HANDLER
00000034= 00002556                 479          DC.L UNHANDLED_HANDLER
00000038= 00002556                 480          DC.L UNHANDLED_HANDLER
0000003C= 00002556                 481          DC.L UNHANDLED_HANDLER
00000040= 00002556                 482          DC.L UNHANDLED_HANDLER
00000044= 00002556                 483          DC.L UNHANDLED_HANDLER
00000048= 00002556                 484          DC.L UNHANDLED_HANDLER
0000004C= 00002556                 485          DC.L UNHANDLED_HANDLER
00000050= 00002556                 486          DC.L UNHANDLED_HANDLER
00000054= 00002556                 487          DC.L UNHANDLED_HANDLER
00000058= 00002556                 488          DC.L UNHANDLED_HANDLER
0000005C= 00002556                 489          DC.L UNHANDLED_HANDLER
00000060= 0000257A                 490          DC.L SPURIOUS_HANDLER
00000064= 00002556                 491          DC.L UNHANDLED_HANDLER
00000068= 00002556                 492          DC.L UNHANDLED_HANDLER
0000006C= 00002556                 493          DC.L UNHANDLED_HANDLER
00000070= 00002556                 494          DC.L UNHANDLED_HANDLER
00000074= 00002556                 495          DC.L UNHANDLED_HANDLER
00000078= 00002556                 496          DC.L UNHANDLED_HANDLER
0000007C= 00002556                 497          DC.L UNHANDLED_HANDLER
00000080= 00002556                 498          DC.L UNHANDLED_HANDLER
00000084= 00002556                 499          DC.L UNHANDLED_HANDLER
00000088= 00002556                 500          DC.L UNHANDLED_HANDLER
0000008C= 00002556                 501          DC.L UNHANDLED_HANDLER
00000090= 00002556                 502          DC.L UNHANDLED_HANDLER
00000094= 00002556                 503          DC.L UNHANDLED_HANDLER
00000098= 00002556                 504          DC.L UNHANDLED_HANDLER
0000009C= 00002556                 505          DC.L UNHANDLED_HANDLER
000000A0= 00002556                 506          DC.L UNHANDLED_HANDLER
000000A4= 00002556                 507          DC.L UNHANDLED_HANDLER
000000A8= 00002556                 508          DC.L UNHANDLED_HANDLER
000000AC= 00002556                 509          DC.L UNHANDLED_HANDLER
000000B0= 00002556                 510          DC.L UNHANDLED_HANDLER
000000B4= 00002556                 511          DC.L UNHANDLED_HANDLER
000000B8= 00002556                 512          DC.L UNHANDLED_HANDLER
000000BC= 00002556                 513          DC.L UNHANDLED_HANDLER
000000C0= 00002556                 514          DC.L UNHANDLED_HANDLER
000000C4= 00002556                 515          DC.L UNHANDLED_HANDLER
000000C8= 00002556                 516          DC.L UNHANDLED_HANDLER
000000CC= 00002556                 517          DC.L UNHANDLED_HANDLER
000000D0= 00002556                 518          DC.L UNHANDLED_HANDLER
000000D4= 00002556                 519          DC.L UNHANDLED_HANDLER
000000D8= 00002556                 520          DC.L UNHANDLED_HANDLER 
000000DC= 00002556                 521          DC.L UNHANDLED_HANDLER
000000E0= 00002556                 522          DC.L UNHANDLED_HANDLER
000000E4= 00002556                 523          DC.L UNHANDLED_HANDLER 
000000E8= 00002556                 524          DC.L UNHANDLED_HANDLER 
000000EC= 00002556                 525          DC.L UNHANDLED_HANDLER
000000F0= 00002556                 526          DC.L UNHANDLED_HANDLER 
000000F4= 00002556                 527          DC.L UNHANDLED_HANDLER 
000000F8= 00002556                 528          DC.L UNHANDLED_HANDLER 
000000FC= 00002556                 529          DC.L UNHANDLED_HANDLER
00000100= 0000256A                 530  USER    DC.L TICK_HANDLER
00000104                           531      ; start of program  
00000104                           532  START
00000104  2E7C 002E0000            533      MOVE.L #STACK_ADDRESS,A7
0000010A  13FC 0000 00E00001       534      MOVE.B #0,DISPLAY
00000112                           535  
00000112  7000                     536      MOVE.L #0,D0
00000114  1039 00C00019            537      MOVE.B DUART_IVR,D0                             ; warm start?
0000011A                           538  
0000011A                           539  ; reset the UART in case of warm start
0000011A  13FC 000A 00C00005       540      MOVE.B #$A,DUART_CRA                            ; disable rx & tx
00000122  13FC 000A 00C00015       541      MOVE.B #$A,DUART_CRB                            ; disable rx & tx
0000012A                           542      
0000012A                           543      FOR D1 = #$50 DOWNTO #$10 BY #$10 DO
0000012A  323C 0050                544s     MOVE.W  #$50,D1
0000012E  6000 000E                545s     BRA _20000001
00000132                           546s _20000000
00000132  13C1 00C00005            547          MOVE.B D1,DUART_CRA                         ; reset everyting
00000138  4E71                     548          NOP
0000013A                           549      ENDF
0000013A  0441 0010                550s     SUB.W   #$10,D1
0000013E                           551s _20000001
0000013E  B27C 0010                552s     CMP.W   #$10,D1
00000142  6CEE                     553s     BGE _20000000
00000144                           554  
00000144                           555      FOR D1 = #$50 DOWNTO #$10 BY #$10 DO
00000144  323C 0050                556s     MOVE.W  #$50,D1
00000148  6000 000E                557s     BRA _20000003
0000014C                           558s _20000002
0000014C  13C1 00C00015            559          MOVE.B D1,DUART_CRB                         ; reset everyting
00000152  4E71                     560          NOP
00000154                           561      ENDF
00000154  0441 0010                562s     SUB.W   #$10,D1
00000158                           563s _20000003
00000158  B27C 0010                564s     CMP.W   #$10,D1
0000015C  6CEE                     565s     BGE _20000002
0000015E                           566      
0000015E                           567  ;initialise UART
0000015E  13FC 0000 00C0000B       568      MOVE.B #$0,DUART_IMR                            ; no interrupts, please
00000166  13FC 00FF 00C0000D       569      MOVE.B #$FF,DUART_CTUR
0000016E  13FC 00FF 00C0000F       570      MOVE.B #$FF,DUART_CTLR
00000176  13FC 0070 00C00009       571      MOVE.B #$70,DUART_ACR
0000017E  13FC 0004 00C0001B       572      MOVE.B #$4,DUART_OPCR                           ; enable counter
00000186                           573  
00000186                           574  ; channel A
00000186  13FC 0013 00C00001       575      MOVE.B #$13,DUART_MRA                           ; no flow control, no parity, 8 data bits
0000018E  13FC 0007 00C00001       576      MOVE.B #$07,DUART_MRA                           ; 1 stop bit
00000196  13FC 0066 00C00003       577      MOVE.B #$66,DUART_CSRA                          ; 115K  baud
0000019E  13FC 0005 00C00005       578      MOVE.B #$5,DUART_CRA                            ; enable rx & tx
000001A6                           579  
000001A6                           580  ; channel B
000001A6  13FC 0013 00C00011       581      MOVE.B #$13,DUART_MRB                           ; no flow control, no parity, 8 data bits
000001AE  13FC 0007 00C00011       582      MOVE.B #$07,DUART_MRB                           ; 1 stop bit
000001B6  13FC 0066 00C00013       583      MOVE.B #$66,DUART_CSRB                          ; 115K baud
000001BE  13FC 0005 00C00015       584      MOVE.B #$5,DUART_CRB                            ; enable rx & tx
000001C6  13FC 0040 00C00019       585      MOVE.B #64,DUART_IVR
000001CE                           586  
000001CE                           587m     PRINT_CHAR #0,D1                                ; some non-printing char to flush out the serial port
000001CE                           588m WAIT_FOR_READY_1                                    ; WAIT UNTIL THE THERE IS SPACE TO SEND
000001CE                 TRUE      589m     IFEQ DEBUG
000001CE  1239 00C00003            590m         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
000001D4  0801 0002                591m         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
000001D8  67F4                     592m         BEQ WAIT_FOR_READY_1                        ; NO SPACE, CHECK AGAIN
000001DA  13FC 0000 00C00007       593m         MOVE.B #0,DUART_TXA                         ; SEND THE NEXT CHARACTER
000001E2                           594m     ENDC
000001E2                           595m 
000001E2                 FALSE     596m     IFNE DEBUG
000001E2                           597m     ENDC
000001E2                           598m 
000001E2                           599m     ENDM
000001E2                           600m     PRINT_CHAR #0,D1
000001E2                           601m WAIT_FOR_READY_2                                    ; WAIT UNTIL THE THERE IS SPACE TO SEND
000001E2                 TRUE      602m     IFEQ DEBUG
000001E2  1239 00C00003            603m         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
000001E8  0801 0002                604m         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
000001EC  67F4                     605m         BEQ WAIT_FOR_READY_2                        ; NO SPACE, CHECK AGAIN
000001EE  13FC 0000 00C00007       606m         MOVE.B #0,DUART_TXA                         ; SEND THE NEXT CHARACTER
000001F6                           607m     ENDC
000001F6                           608m 
000001F6                 FALSE     609m     IFNE DEBUG
000001F6                           610m     ENDC
000001F6                           611m 
000001F6                           612m     ENDM
000001F6                           613m     PRINT_CHAR #0,D1
000001F6                           614m WAIT_FOR_READY_3                                    ; WAIT UNTIL THE THERE IS SPACE TO SEND
000001F6                 TRUE      615m     IFEQ DEBUG
000001F6  1239 00C00003            616m         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
000001FC  0801 0002                617m         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00000200  67F4                     618m         BEQ WAIT_FOR_READY_3                        ; NO SPACE, CHECK AGAIN
00000202  13FC 0000 00C00007       619m         MOVE.B #0,DUART_TXA                         ; SEND THE NEXT CHARACTER
0000020A                           620m     ENDC
0000020A                           621m 
0000020A                 FALSE     622m     IFNE DEBUG
0000020A                           623m     ENDC
0000020A                           624m 
0000020A                           625m     ENDM
0000020A                           626      
0000020A                           627      IF D0 <EQ> #$0F THEN
0000020A  B07C 000F                628s     CMP.W   #$0F,D0
0000020E  6600 0008                629s     BNE _00000000
00000212  1039 00C00005            630          MOVE.B DUART_CRA,D0                         ; BRG test mode
00000218                           631      ENDI
00000218                           632s _00000000
00000218                           633  
00000218  13FC 0001 00E00001       634      MOVE.B #1,DISPLAY
00000220                           635      
00000220                           636m     PRINT_CRLF D1,A0
00000220  41FA 25A3                637m     LEA CRLF(PC),A0
00000224                           638mm     PRINT_STR A0,D1
00000224                           639mm LOOP_5
00000224  0C10 0000                640mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
00000228  6700 0016                641mm     BEQ EXIT_5
0000022C                           642mmm     PRINT_CHAR (A0)+,D1
0000022C                           643mmm WAIT_FOR_READY_6                                    ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000022C                 TRUE      644mmm     IFEQ DEBUG
0000022C  1239 00C00003            645mmm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00000232  0801 0002                646mmm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00000236  67F4                     647mmm         BEQ WAIT_FOR_READY_6                        ; NO SPACE, CHECK AGAIN
00000238  13D8 00C00007            648mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
0000023E                           649mmm     ENDC
0000023E                           650mmm 
0000023E                 FALSE     651mmm     IFNE DEBUG
0000023E                           652mmm     ENDC
0000023E                           653mmm 
0000023E                           654mmm     ENDM
0000023E  60E4                     655mm     BRA LOOP_5
00000240                           656mm EXIT_5
00000240                           657mm     ENDM
00000240                           658m     ENDM
00000240  41FA 2624                659      LEA VERSION(PC),A0
00000244                           660m     PRINT_STR A0,D3
00000244                           661m LOOP_7
00000244  0C10 0000                662m     CMP.B #NULL,(A0)                                ; 0 -> DONE
00000248  6700 0016                663m     BEQ EXIT_7
0000024C                           664mm     PRINT_CHAR (A0)+,D3
0000024C                           665mm WAIT_FOR_READY_8                                    ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000024C                 TRUE      666mm     IFEQ DEBUG
0000024C  1639 00C00003            667mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000252  0803 0002                668mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000256  67F4                     669mm         BEQ WAIT_FOR_READY_8                        ; NO SPACE, CHECK AGAIN
00000258  13D8 00C00007            670mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
0000025E                           671mm     ENDC
0000025E                           672mm 
0000025E                 FALSE     673mm     IFNE DEBUG
0000025E                           674mm     ENDC
0000025E                           675mm 
0000025E                           676mm     ENDM
0000025E  60E4                     677m     BRA LOOP_7
00000260                           678m EXIT_7
00000260                           679m     ENDM
00000260                           680  
00000260  41F9 00002884            681      LEA END,A0
00000266  2008                     682      MOVE.L A0,D0
00000268                           683m     PRINT_REG D0,D1,D2,D3,A0
00000268  41FA 2561                684m     LEA OX(PC),A0
0000026C                           685mm     PRINT_STR A0,D1
0000026C                           686mm LOOP_10
0000026C  0C10 0000                687mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
00000270  6700 0016                688mm     BEQ EXIT_10
00000274                           689mmm     PRINT_CHAR (A0)+,D1
00000274                           690mmm WAIT_FOR_READY_11                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000274                 TRUE      691mmm     IFEQ DEBUG
00000274  1239 00C00003            692mmm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
0000027A  0801 0002                693mmm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
0000027E  67F4                     694mmm         BEQ WAIT_FOR_READY_11                       ; NO SPACE, CHECK AGAIN
00000280  13D8 00C00007            695mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000286                           696mmm     ENDC
00000286                           697mmm 
00000286                 FALSE     698mmm     IFNE DEBUG
00000286                           699mmm     ENDC
00000286                           700mmm 
00000286                           701mmm     ENDM
00000286  60E4                     702mm     BRA LOOP_10
00000288                           703mm EXIT_10
00000288                           704mm     ENDM
00000288  7607                     705m     MOVE.L #7,D3                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
0000028A                           706m LOOP_9
0000028A                           707mm     BIN2HEX D0,D2,A0
0000028A  41FA 24FE                708mm     LEA BIN2HEX_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
0000028E  E998                     709mm     ROL.L #4,D0                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00000290  1400                     710mm     MOVE.B D0,D2
00000292  0282 0000000F            711mm     ANDI.L #$F,D2
00000298  1430 2000                712mm     MOVE.B 0(A0,D2),D2                              ; USE THAT AS AN INDEX INTO THE LUT
0000029C                           713mm     ENDM
0000029C                           714mm     PRINT_CHAR D2,D1
0000029C                           715mm WAIT_FOR_READY_13                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000029C                 TRUE      716mm     IFEQ DEBUG
0000029C  1239 00C00003            717mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
000002A2  0801 0002                718mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
000002A6  67F4                     719mm         BEQ WAIT_FOR_READY_13                       ; NO SPACE, CHECK AGAIN
000002A8  13C2 00C00007            720mm         MOVE.B D2,DUART_TXA                         ; SEND THE NEXT CHARACTER
000002AE                           721mm     ENDC
000002AE                           722mm 
000002AE                 FALSE     723mm     IFNE DEBUG
000002AE                           724mm     ENDC
000002AE                           725mm 
000002AE                           726mm     ENDM
000002AE  57CB FFDA                727m     DBEQ D3,LOOP_9
000002B2                           728m     ENDM
000002B2                           729m     PRINT_CRLF D1,A0
000002B2  41FA 2511                730m     LEA CRLF(PC),A0
000002B6                           731mm     PRINT_STR A0,D1
000002B6                           732mm LOOP_15
000002B6  0C10 0000                733mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
000002BA  6700 0016                734mm     BEQ EXIT_15
000002BE                           735mmm     PRINT_CHAR (A0)+,D1
000002BE                           736mmm WAIT_FOR_READY_16                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
000002BE                 TRUE      737mmm     IFEQ DEBUG
000002BE  1239 00C00003            738mmm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
000002C4  0801 0002                739mmm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
000002C8  67F4                     740mmm         BEQ WAIT_FOR_READY_16                       ; NO SPACE, CHECK AGAIN
000002CA  13D8 00C00007            741mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000002D0                           742mmm     ENDC
000002D0                           743mmm 
000002D0                 FALSE     744mmm     IFNE DEBUG
000002D0                           745mmm     ENDC
000002D0                           746mmm 
000002D0                           747mmm     ENDM
000002D0  60E4                     748mm     BRA LOOP_15
000002D2                           749mm EXIT_15
000002D2                           750mm     ENDM
000002D2                           751m     ENDM
000002D2                           752  
000002D2  41FA 22CC                753      LEA HELPPROMPT(PC),A0
000002D6                           754m     PRINT_STR A0,D3
000002D6                           755m LOOP_17
000002D6  0C10 0000                756m     CMP.B #NULL,(A0)                                ; 0 -> DONE
000002DA  6700 0016                757m     BEQ EXIT_17
000002DE                           758mm     PRINT_CHAR (A0)+,D3
000002DE                           759mm WAIT_FOR_READY_18                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
000002DE                 TRUE      760mm     IFEQ DEBUG
000002DE  1639 00C00003            761mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000002E4  0803 0002                762mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
000002E8  67F4                     763mm         BEQ WAIT_FOR_READY_18                       ; NO SPACE, CHECK AGAIN
000002EA  13D8 00C00007            764mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000002F0                           765mm     ENDC
000002F0                           766mm 
000002F0                 FALSE     767mm     IFNE DEBUG
000002F0                           768mm     ENDC
000002F0                           769mm 
000002F0                           770mm     ENDM
000002F0  60E4                     771m     BRA LOOP_17
000002F2                           772m EXIT_17
000002F2                           773m     ENDM
000002F2                           774  
000002F2                           775m     PRINT_CRLF D3,A0
000002F2  41FA 24D1                776m     LEA CRLF(PC),A0
000002F6                           777mm     PRINT_STR A0,D3
000002F6                           778mm LOOP_20
000002F6  0C10 0000                779mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
000002FA  6700 0016                780mm     BEQ EXIT_20
000002FE                           781mmm     PRINT_CHAR (A0)+,D3
000002FE                           782mmm WAIT_FOR_READY_21                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
000002FE                 TRUE      783mmm     IFEQ DEBUG
000002FE  1639 00C00003            784mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000304  0803 0002                785mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000308  67F4                     786mmm         BEQ WAIT_FOR_READY_21                       ; NO SPACE, CHECK AGAIN
0000030A  13D8 00C00007            787mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000310                           788mmm     ENDC
00000310                           789mmm 
00000310                 FALSE     790mmm     IFNE DEBUG
00000310                           791mmm     ENDC
00000310                           792mmm 
00000310                           793mmm     ENDM
00000310  60E4                     794mm     BRA LOOP_20
00000312                           795mm EXIT_20
00000312                           796mm     ENDM
00000312                           797m     ENDM
00000312                           798  
00000312  7E00                     799      MOVE.L #0,D7                                    ; address accumulator
00000314                           800  
00000314  13FC 0002 00E00001       801      MOVE.B #2,DISPLAY
0000031C                           802      
0000031C  13FC 0000 00A00001       803      MOVE.B #$0, MC68230_GENERAL_CONTROL             ; set up the MC68230
00000324  13FC 0040 00A0000D       804      MOVE.B #$40, MC68230_PORT_A_CONTROL
0000032C  13FC 0040 00A0000F       805      MOVE.B #$40, MC68230_PORT_B_CONTROL
00000334  13FC 00FF 00A00009       806      MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_C_DIRECTION
0000033C                           807      
0000033C  13FC 0003 00E00001       808      MOVE.B #3,DISPLAY
00000344                           809      
00000344                           810      
00000344                           811  MAIN_LOOP
00000344  41FA 2482                812      LEA PROMPT(PC),A0
00000348                           813m     PRINT_STR A0,D3
00000348                           814m LOOP_22
00000348  0C10 0000                815m     CMP.B #NULL,(A0)                                ; 0 -> DONE
0000034C  6700 0016                816m     BEQ EXIT_22
00000350                           817mm     PRINT_CHAR (A0)+,D3
00000350                           818mm WAIT_FOR_READY_23                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000350                 TRUE      819mm     IFEQ DEBUG
00000350  1639 00C00003            820mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000356  0803 0002                821mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
0000035A  67F4                     822mm         BEQ WAIT_FOR_READY_23                       ; NO SPACE, CHECK AGAIN
0000035C  13D8 00C00007            823mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000362                           824mm     ENDC
00000362                           825mm 
00000362                 FALSE     826mm     IFNE DEBUG
00000362                           827mm     ENDC
00000362                           828mm 
00000362                           829mm     ENDM
00000362  60E4                     830m     BRA LOOP_22
00000364                           831m EXIT_22
00000364                           832m     ENDM
00000364                           833  
00000364                           834  GET_INPUT
00000364                           835m     WAIT_CHAR D2,D3                                 ; fetch character from serial port -> D2
00000364                           836m WAIT_FOR_READY_24                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000364                 TRUE      837m     IFEQ DEBUG
00000364  1639 00C00003            838m         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
0000036A  0803 0000                839m         BTST #0,D3                                  ; CHECK FOR CHARACTER
0000036E  67F4                     840m         BEQ WAIT_FOR_READY_24                       ; NOTHING, CHECK AGAIN
00000370                           841m     ENDC
00000370                           842m 
00000370                           843mm     READ_CHAR D2
00000370                 TRUE      844mm     IFEQ DEBUG
00000370  1439 00C00007            845mm         MOVE.B DUART_RXA,D2                         ; GOT A CHARACTER, READ IT
00000376                           846mm     ENDC
00000376                 FALSE     847mm     IFNE DEBUG
00000376                           848mm     ENDC
00000376                           849mm 
00000376  B43C 001B                850mm     CMP.B #$1B,D2                                   ; CHECK FOR ESCAPE AND GO TO START
0000037A  6700 FD88                851mm     BEQ START
0000037E                           852mm     ENDM
0000037E                           853m 
0000037E                 TRUE      854m     IFEQ DEBUG
0000037E                           855mm         PRINT_CHAR D2,D3                            ; ECHO IT BACK
0000037E                           856mm WAIT_FOR_READY_26                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000037E                 TRUE      857mm     IFEQ DEBUG
0000037E  1639 00C00003            858mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000384  0803 0002                859mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000388  67F4                     860mm         BEQ WAIT_FOR_READY_26                       ; NO SPACE, CHECK AGAIN
0000038A  13C2 00C00007            861mm         MOVE.B D2,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000390                           862mm     ENDC
00000390                           863mm 
00000390                 FALSE     864mm     IFNE DEBUG
00000390                           865mm     ENDC
00000390                           866mm 
00000390                           867mm     ENDM
00000390                           868m     ENDC
00000390                           869m     ENDM
00000390                           870  
00000390                           871      IF.B D2 <GE> #'0' AND.B D2 <LE> #'9' THEN
00000390  B43C 0030                872s     CMP.B   #'0',D2
00000394  6D00 000E                873s     BLT _00000001
00000398  B43C 0039                874s     CMP.B   #'9',D2
0000039C  6E00 0006                875s     BGT _00000001
000003A0  6000 2036                876          BRA HEX_DIGIT
000003A4                           877      ENDI
000003A4                           878s _00000001
000003A4                           879      IF.B D2 <GE> #'A' AND.B D2 <LE> #'F' THEN
000003A4  B43C 0041                880s     CMP.B   #'A',D2
000003A8  6D00 000E                881s     BLT _00000002
000003AC  B43C 0046                882s     CMP.B   #'F',D2
000003B0  6E00 0006                883s     BGT _00000002
000003B4  6000 2022                884          BRA HEX_DIGIT
000003B8                           885      ENDI
000003B8                           886s _00000002
000003B8                           887  
000003B8  B43C 0077                888      CMP.B #'w',D2
000003BC  6700 01BA                889      BEQ W
000003C0                           890  
000003C0  B43C 006C                891      CMP.B #'l',D2
000003C4  6700 099C                892      BEQ L 
000003C8                           893  
000003C8  B43C 0070                894      CMP.B #'p',D2
000003CC  6700 0C76                895      BEQ P
000003D0                           896  
000003D0                           897m     PRINT_CRLF D3,A0
000003D0  41FA 23F3                898m     LEA CRLF(PC),A0
000003D4                           899mm     PRINT_STR A0,D3
000003D4                           900mm LOOP_28
000003D4  0C10 0000                901mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
000003D8  6700 0016                902mm     BEQ EXIT_28
000003DC                           903mmm     PRINT_CHAR (A0)+,D3
000003DC                           904mmm WAIT_FOR_READY_29                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
000003DC                 TRUE      905mmm     IFEQ DEBUG
000003DC  1639 00C00003            906mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000003E2  0803 0002                907mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
000003E6  67F4                     908mmm         BEQ WAIT_FOR_READY_29                       ; NO SPACE, CHECK AGAIN
000003E8  13D8 00C00007            909mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000003EE                           910mmm     ENDC
000003EE                           911mmm 
000003EE                 FALSE     912mmm     IFNE DEBUG
000003EE                           913mmm     ENDC
000003EE                           914mmm 
000003EE                           915mmm     ENDM
000003EE  60E4                     916mm     BRA LOOP_28
000003F0                           917mm EXIT_28
000003F0                           918mm     ENDM
000003F0                           919m     ENDM
000003F0                           920   
000003F0  B43C 003F                921      CMP.B #'?',D2
000003F4  6700 007E                922      BEQ H
000003F8                           923   
000003F8  B43C 0076                924      CMP.B #'v',D2
000003FC  6700 007E                925      BEQ V
00000400                           926      
00000400  B43C 0072                927      CMP.B #'r',D2
00000404  6700 009A                928      BEQ R
00000408                           929  
00000408  B43C 0073                930      CMP.B #'s',D2
0000040C  6700 01E4                931      BEQ S
00000410                           932  
00000410  B43C 0067                933      CMP.B #'g',D2
00000414  6700 0856                934      BEQ G   
00000418                           935  
00000418  B43C 007A                936      CMP.B #'z',D2
0000041C  6700 0854                937      BEQ Z   
00000420                           938  
00000420  B43C 0078                939      CMP.B #'x',D2
00000424  6700 0DEE                940      BEQ X
00000428                           941  
00000428  B43C 0049                942      CMP.B #'I',D2
0000042C  6700 0F02                943      BEQ EI
00000430                           944  
00000430  B43C 006F                945      CMP.B #'o',D2
00000434  6700 0F0A                946      BEQ DI
00000438                           947  
00000438  B43C 0023                948      CMP.B #'#',D2
0000043C  6700 0F12                949      BEQ HASH
00000440                           950  
00000440  B43C 0069                951      CMP.B #'i',D2
00000444  6700 0F20                952      BEQ I
00000448                           953  
00000448  B43C 0062                954      CMP.B #'b',D2
0000044C  6700 1A3A                955      BEQ B
00000450                           956  
00000450  41FA 22D6                957      LEA HUH(PC),A0
00000454                           958m     PRINT_STR A0,D3
00000454                           959m LOOP_30
00000454  0C10 0000                960m     CMP.B #NULL,(A0)                                ; 0 -> DONE
00000458  6700 0016                961m     BEQ EXIT_30
0000045C                           962mm     PRINT_CHAR (A0)+,D3
0000045C                           963mm WAIT_FOR_READY_31                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000045C                 TRUE      964mm     IFEQ DEBUG
0000045C  1639 00C00003            965mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000462  0803 0002                966mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000466  67F4                     967mm         BEQ WAIT_FOR_READY_31                       ; NO SPACE, CHECK AGAIN
00000468  13D8 00C00007            968mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
0000046E                           969mm     ENDC
0000046E                           970mm 
0000046E                 FALSE     971mm     IFNE DEBUG
0000046E                           972mm     ENDC
0000046E                           973mm 
0000046E                           974mm     ENDM
0000046E  60E4                     975m     BRA LOOP_30
00000470                           976m EXIT_30
00000470                           977m     ENDM
00000470                           978  
00000470  6000 FED2                979      BRA MAIN_LOOP
00000474                           980  
00000474                           981  ; commands
00000474                           982  H
00000474  41FA 213D                983      LEA HELP(PC),A0
00000478  6000 0006                984      BRA PRINTIT
0000047C                           985  
0000047C                           986  V
0000047C  41FA 23E8                987      LEA VERSION(PC),A0
00000480                           988  PRINTIT
00000480                           989m     PRINT_STR A0,D3    
00000480                           990m LOOP_32
00000480  0C10 0000                991m     CMP.B #NULL,(A0)                                ; 0 -> DONE
00000484  6700 0016                992m     BEQ EXIT_32
00000488                           993mm     PRINT_CHAR (A0)+,D3
00000488                           994mm WAIT_FOR_READY_33                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000488                 TRUE      995mm     IFEQ DEBUG
00000488  1639 00C00003            996mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
0000048E  0803 0002                997mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000492  67F4                     998mm         BEQ WAIT_FOR_READY_33                       ; NO SPACE, CHECK AGAIN
00000494  13D8 00C00007            999mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
0000049A                          1000mm     ENDC
0000049A                          1001mm 
0000049A                 FALSE    1002mm     IFNE DEBUG
0000049A                          1003mm     ENDC
0000049A                          1004mm 
0000049A                          1005mm     ENDM
0000049A  60E4                    1006m     BRA LOOP_32
0000049C                          1007m EXIT_32
0000049C                          1008m     ENDM
0000049C  6000 FEA6               1009      BRA MAIN_LOOP
000004A0                          1010  
000004A0                          1011  R
000004A0  2047                    1012      MOVE.L D7,A0                                    ; address accumulator -> address register
000004A2  7E00                    1013      MOVE.L #0,D7                                    ;clear the now used address accumulator
000004A4  2410                    1014      MOVE.L (A0),D2                                  ; read the memory and print it
000004A6                          1015m     PRINT_REG D2,D3,D4,D5,A0
000004A6  41FA 2323               1016m     LEA OX(PC),A0
000004AA                          1017mm     PRINT_STR A0,D3
000004AA                          1018mm LOOP_35
000004AA  0C10 0000               1019mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
000004AE  6700 0016               1020mm     BEQ EXIT_35
000004B2                          1021mmm     PRINT_CHAR (A0)+,D3
000004B2                          1022mmm WAIT_FOR_READY_36                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
000004B2                 TRUE     1023mmm     IFEQ DEBUG
000004B2  1639 00C00003           1024mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000004B8  0803 0002               1025mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
000004BC  67F4                    1026mmm         BEQ WAIT_FOR_READY_36                       ; NO SPACE, CHECK AGAIN
000004BE  13D8 00C00007           1027mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000004C4                          1028mmm     ENDC
000004C4                          1029mmm 
000004C4                 FALSE    1030mmm     IFNE DEBUG
000004C4                          1031mmm     ENDC
000004C4                          1032mmm 
000004C4                          1033mmm     ENDM
000004C4  60E4                    1034mm     BRA LOOP_35
000004C6                          1035mm EXIT_35
000004C6                          1036mm     ENDM
000004C6  7A07                    1037m     MOVE.L #7,D5                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
000004C8                          1038m LOOP_34
000004C8                          1039mm     BIN2HEX D2,D4,A0
000004C8  41FA 22C0               1040mm     LEA BIN2HEX_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
000004CC  E99A                    1041mm     ROL.L #4,D2                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
000004CE  1802                    1042mm     MOVE.B D2,D4
000004D0  0284 0000000F           1043mm     ANDI.L #$F,D4
000004D6  1830 4000               1044mm     MOVE.B 0(A0,D4),D4                              ; USE THAT AS AN INDEX INTO THE LUT
000004DA                          1045mm     ENDM
000004DA                          1046mm     PRINT_CHAR D4,D3
000004DA                          1047mm WAIT_FOR_READY_38                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
000004DA                 TRUE     1048mm     IFEQ DEBUG
000004DA  1639 00C00003           1049mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000004E0  0803 0002               1050mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
000004E4  67F4                    1051mm         BEQ WAIT_FOR_READY_38                       ; NO SPACE, CHECK AGAIN
000004E6  13C4 00C00007           1052mm         MOVE.B D4,DUART_TXA                         ; SEND THE NEXT CHARACTER
000004EC                          1053mm     ENDC
000004EC                          1054mm 
000004EC                 FALSE    1055mm     IFNE DEBUG
000004EC                          1056mm     ENDC
000004EC                          1057mm 
000004EC                          1058mm     ENDM
000004EC  57CD FFDA               1059m     DBEQ D5,LOOP_34
000004F0                          1060m     ENDM
000004F0                          1061      
000004F0                          1062m     PRINT_CHAR #32,D3
000004F0                          1063m WAIT_FOR_READY_39                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
000004F0                 TRUE     1064m     IFEQ DEBUG
000004F0  1639 00C00003           1065m         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000004F6  0803 0002               1066m         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
000004FA  67F4                    1067m         BEQ WAIT_FOR_READY_39                       ; NO SPACE, CHECK AGAIN
000004FC  13FC 0020 00C00007      1068m         MOVE.B #32,DUART_TXA                            ; SEND THE NEXT CHARACTER
00000504                          1069m     ENDC
00000504                          1070m 
00000504                 FALSE    1071m     IFNE DEBUG
00000504                          1072m     ENDC
00000504                          1073m 
00000504                          1074m     ENDM
00000504                          1075  
00000504  E19A                    1076      ROL.L #8,D2
00000506                          1077m     PRINT_CHAR D2,D3
00000506                          1078m WAIT_FOR_READY_40                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000506                 TRUE     1079m     IFEQ DEBUG
00000506  1639 00C00003           1080m         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
0000050C  0803 0002               1081m         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000510  67F4                    1082m         BEQ WAIT_FOR_READY_40                       ; NO SPACE, CHECK AGAIN
00000512  13C2 00C00007           1083m         MOVE.B D2,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000518                          1084m     ENDC
00000518                          1085m 
00000518                 FALSE    1086m     IFNE DEBUG
00000518                          1087m     ENDC
00000518                          1088m 
00000518                          1089m     ENDM
00000518  E19A                    1090      ROL.L #8,D2
0000051A                          1091m     PRINT_CHAR D2,D3
0000051A                          1092m WAIT_FOR_READY_41                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000051A                 TRUE     1093m     IFEQ DEBUG
0000051A  1639 00C00003           1094m         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000520  0803 0002               1095m         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000524  67F4                    1096m         BEQ WAIT_FOR_READY_41                       ; NO SPACE, CHECK AGAIN
00000526  13C2 00C00007           1097m         MOVE.B D2,DUART_TXA                         ; SEND THE NEXT CHARACTER
0000052C                          1098m     ENDC
0000052C                          1099m 
0000052C                 FALSE    1100m     IFNE DEBUG
0000052C                          1101m     ENDC
0000052C                          1102m 
0000052C                          1103m     ENDM
0000052C  E19A                    1104      ROL.L #8,D2
0000052E                          1105m     PRINT_CHAR D2,D3
0000052E                          1106m WAIT_FOR_READY_42                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000052E                 TRUE     1107m     IFEQ DEBUG
0000052E  1639 00C00003           1108m         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000534  0803 0002               1109m         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000538  67F4                    1110m         BEQ WAIT_FOR_READY_42                       ; NO SPACE, CHECK AGAIN
0000053A  13C2 00C00007           1111m         MOVE.B D2,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000540                          1112m     ENDC
00000540                          1113m 
00000540                 FALSE    1114m     IFNE DEBUG
00000540                          1115m     ENDC
00000540                          1116m 
00000540                          1117m     ENDM
00000540  E19A                    1118      ROL.L #8,D2
00000542                          1119m     PRINT_CHAR D2,D3
00000542                          1120m WAIT_FOR_READY_43                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000542                 TRUE     1121m     IFEQ DEBUG
00000542  1639 00C00003           1122m         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000548  0803 0002               1123m         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
0000054C  67F4                    1124m         BEQ WAIT_FOR_READY_43                       ; NO SPACE, CHECK AGAIN
0000054E  13C2 00C00007           1125m         MOVE.B D2,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000554                          1126m     ENDC
00000554                          1127m 
00000554                 FALSE    1128m     IFNE DEBUG
00000554                          1129m     ENDC
00000554                          1130m 
00000554                          1131m     ENDM
00000554                          1132  
00000554                          1133m     PRINT_CRLF D3,A0
00000554  41FA 226F               1134m     LEA CRLF(PC),A0
00000558                          1135mm     PRINT_STR A0,D3
00000558                          1136mm LOOP_45
00000558  0C10 0000               1137mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
0000055C  6700 0016               1138mm     BEQ EXIT_45
00000560                          1139mmm     PRINT_CHAR (A0)+,D3
00000560                          1140mmm WAIT_FOR_READY_46                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000560                 TRUE     1141mmm     IFEQ DEBUG
00000560  1639 00C00003           1142mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000566  0803 0002               1143mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
0000056A  67F4                    1144mmm         BEQ WAIT_FOR_READY_46                       ; NO SPACE, CHECK AGAIN
0000056C  13D8 00C00007           1145mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000572                          1146mmm     ENDC
00000572                          1147mmm 
00000572                 FALSE    1148mmm     IFNE DEBUG
00000572                          1149mmm     ENDC
00000572                          1150mmm 
00000572                          1151mmm     ENDM
00000572  60E4                    1152mm     BRA LOOP_45
00000574                          1153mm EXIT_45
00000574                          1154mm     ENDM
00000574                          1155m     ENDM
00000574                          1156      
00000574  6000 FDCE               1157      BRA MAIN_LOOP
00000578                          1158  
00000578                          1159  W
00000578                          1160      FOR D6 = #0 TO #7 DO                                ; read 4 bytes
00000578  3C3C 0000               1161s     MOVE.W  #0,D6
0000057C  6000 0046               1162s     BRA _20000005
00000580                          1163s _20000004
00000580  E98D                    1164          LSL.L #4,D5                                     ; make what we have so far more significant
00000582                          1165m         WAIT_CHAR D2,D3                                 ; next character -> D2
00000582                          1166m WAIT_FOR_READY_47                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000582                 TRUE     1167m     IFEQ DEBUG
00000582  1639 00C00003           1168m         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000588  0803 0000               1169m         BTST #0,D3                                  ; CHECK FOR CHARACTER
0000058C  67F4                    1170m         BEQ WAIT_FOR_READY_47                       ; NOTHING, CHECK AGAIN
0000058E                          1171m     ENDC
0000058E                          1172m 
0000058E                          1173mm     READ_CHAR D2
0000058E                 TRUE     1174mm     IFEQ DEBUG
0000058E  1439 00C00007           1175mm         MOVE.B DUART_RXA,D2                         ; GOT A CHARACTER, READ IT
00000594                          1176mm     ENDC
00000594                 FALSE    1177mm     IFNE DEBUG
00000594                          1178mm     ENDC
00000594                          1179mm 
00000594  B43C 001B               1180mm     CMP.B #$1B,D2                                   ; CHECK FOR ESCAPE AND GO TO START
00000598  6700 FB6A               1181mm     BEQ START
0000059C                          1182mm     ENDM
0000059C                          1183m 
0000059C                 TRUE     1184m     IFEQ DEBUG
0000059C                          1185mm         PRINT_CHAR D2,D3                            ; ECHO IT BACK
0000059C                          1186mm WAIT_FOR_READY_49                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000059C                 TRUE     1187mm     IFEQ DEBUG
0000059C  1639 00C00003           1188mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000005A2  0803 0002               1189mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
000005A6  67F4                    1190mm         BEQ WAIT_FOR_READY_49                       ; NO SPACE, CHECK AGAIN
000005A8  13C2 00C00007           1191mm         MOVE.B D2,DUART_TXA                         ; SEND THE NEXT CHARACTER
000005AE                          1192mm     ENDC
000005AE                          1193mm 
000005AE                 FALSE    1194mm     IFNE DEBUG
000005AE                          1195mm     ENDC
000005AE                          1196mm 
000005AE                          1197mm     ENDM
000005AE                          1198m     ENDC
000005AE                          1199m     ENDM
000005AE                          1200m         HEX2BIN D2,D2,A0                                ; convert to binary -> D2
000005AE  41FA 21EA               1201m     LEA HEX2BIN_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
000005B2  0402 0030               1202m     SUB.B #'0',D2                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
000005B6  C4BC 000000FF           1203m     AND.L #$FF,D2                                   ; IGNORE THE TOP 3 BYTES
000005BC  1430 2000               1204m     MOVE.B 0(A0,D2),D2                              ; USE THAT AS AN INDEX INTO THE LUT   
000005C0                          1205m     ENDM
000005C0  8A02                    1206          OR.B D2,D5
000005C2                          1207      ENDF
000005C2  5246                    1208s     ADD.W   #1,D6
000005C4                          1209s _20000005
000005C4  BC7C 0007               1210s     CMP.W   #7,D6
000005C8  6FB6                    1211s     BLE _20000004
000005CA                          1212  
000005CA                          1213m     PRINT_CRLF D3,A0
000005CA  41FA 21F9               1214m     LEA CRLF(PC),A0
000005CE                          1215mm     PRINT_STR A0,D3
000005CE                          1216mm LOOP_52
000005CE  0C10 0000               1217mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
000005D2  6700 0016               1218mm     BEQ EXIT_52
000005D6                          1219mmm     PRINT_CHAR (A0)+,D3
000005D6                          1220mmm WAIT_FOR_READY_53                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
000005D6                 TRUE     1221mmm     IFEQ DEBUG
000005D6  1639 00C00003           1222mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000005DC  0803 0002               1223mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
000005E0  67F4                    1224mmm         BEQ WAIT_FOR_READY_53                       ; NO SPACE, CHECK AGAIN
000005E2  13D8 00C00007           1225mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000005E8                          1226mmm     ENDC
000005E8                          1227mmm 
000005E8                 FALSE    1228mmm     IFNE DEBUG
000005E8                          1229mmm     ENDC
000005E8                          1230mmm 
000005E8                          1231mmm     ENDM
000005E8  60E4                    1232mm     BRA LOOP_52
000005EA                          1233mm EXIT_52
000005EA                          1234mm     ENDM
000005EA                          1235m     ENDM
000005EA                          1236  
000005EA  2047                    1237      MOVE.L D7,A0                                    ; address accumulator -> address register
000005EC                          1238  
000005EC  2085                    1239      MOVE.L D5,(A0)                                  ; write the data
000005EE                          1240  
000005EE  6000 FD54               1241      BRA MAIN_LOOP
000005F2                          1242  
000005F2                          1243  ; register map for S
000005F2                          1244  ; A0 - start address
000005F2                          1245  ; A1 - offset
000005F2                          1246  ; A2 - next address to write
000005F2                          1247  ; A3 - next location (jmp)
000005F2                          1248  ; A4 - Working Address Register
000005F2                          1249  ; D0 - record count
000005F2                          1250  ; D1 - 'S', record type, data byte, done flag (0x00000000 = continue, 0xFFFFFFFF = done)
000005F2                          1251  ; D2 - checksum
000005F2                          1252  ; D3 - data byte count
000005F2                          1253  ; D4 - read address, moved into A2
000005F2                          1254  ; D5 - temp
000005F2                          1255  ; D6 - temp
000005F2                          1256  ; D7 - temp
000005F2                          1257  S
000005F2  2078 0000               1258      MOVE.L 0,A0                                     ; start address -> A0
000005F6  2247                    1259      MOVE.L D7,A1                                    ; grab the address accumulator (offset) into A1
000005F8  7E00                    1260      MOVE.L #0,D7
000005FA  7000                    1261      MOVE.L #0,D0                                    ; count of records read -> D0
000005FC                          1262          
000005FC                          1263  WAIT_FOR_SRECORD                                    ; wait for the start of a record, indicated by 'S'
000005FC                          1264m     DOWNLOAD D1
000005FC                          1265m WAIT_FOR_READY_54                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
000005FC                          1266m 
000005FC  1239 00C00003           1267m     MOVE.B DUART_SRA,D1                             ; CHECK FOR COMMAND
00000602  0801 0000               1268m     BTST #0,D1                                      ; CHECK FOR CHARACTER
00000606  6700 0010               1269m     BEQ CONTINUE_54                                 ; NOTHING, CONTINUE
0000060A                          1270m 
0000060A                          1271mm     READ_CHAR D1                                    ; WE're not going to do anything with it, just check for escape
0000060A                 TRUE     1272mm     IFEQ DEBUG
0000060A  1239 00C00007           1273mm         MOVE.B DUART_RXA,D1                         ; GOT A CHARACTER, READ IT
00000610                          1274mm     ENDC
00000610                 FALSE    1275mm     IFNE DEBUG
00000610                          1276mm     ENDC
00000610                          1277mm 
00000610  B23C 001B               1278mm     CMP.B #$1B,D1                                   ; CHECK FOR ESCAPE AND GO TO START
00000614  6700 FAEE               1279mm     BEQ START
00000618                          1280mm     ENDM
00000618                          1281m CONTINUE_54
00000618  1239 00C00013           1282m     MOVE.B DUART_SRB,D1                             ; READ DOWNLOAD STATUS REGISTER
0000061E  0801 0000               1283m     BTST #0,D1                                      ; CHECK FOR CHARACTER
00000622  67D8                    1284m     BEQ WAIT_FOR_READY_54                           ; NOTHING, CHECK AGAIN
00000624                          1285m     
00000624  1239 00C00017           1286m     MOVE.B DUART_RXB,D1                             ; GOT A CHARACTER, READ IT
0000062A  13C1 00E00001           1287m     MOVE.B D1,DISPLAY                               ; ECHO TO THE DISPLAY
00000630                          1288m 
00000630                          1289m     ENDM
00000630  B23C 0053               1290      CMP.B #'S',D1                                   ; found S?
00000634  66C6                    1291      BNE WAIT_FOR_SRECORD                            ; nope, keep waiting
00000636                          1292      
00000636                          1293m     PRINT_CHAR #'.',D5                              ; print a progress indicator
00000636                          1294m WAIT_FOR_READY_56                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000636                 TRUE     1295m     IFEQ DEBUG
00000636  1A39 00C00003           1296m         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
0000063C  0805 0002               1297m         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000640  67F4                    1298m         BEQ WAIT_FOR_READY_56                       ; NO SPACE, CHECK AGAIN
00000642  13FC 002E 00C00007      1299m         MOVE.B #'.',DUART_TXA                           ; SEND THE NEXT CHARACTER
0000064A                          1300m     ENDC
0000064A                          1301m 
0000064A                 FALSE    1302m     IFNE DEBUG
0000064A                          1303m     ENDC
0000064A                          1304m 
0000064A                          1305m     ENDM
0000064A                          1306      ;PRINT_CHAR #'S',D5                             ; print the S
0000064A  5280                    1307      ADD.L #1,D0                                     ; read another S record, increment count
0000064C                          1308      
0000064C                          1309m     DOWNLOAD D1                                     ; read the record identifier and echo it back
0000064C                          1310m WAIT_FOR_READY_57                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000064C                          1311m 
0000064C  1239 00C00003           1312m     MOVE.B DUART_SRA,D1                             ; CHECK FOR COMMAND
00000652  0801 0000               1313m     BTST #0,D1                                      ; CHECK FOR CHARACTER
00000656  6700 0010               1314m     BEQ CONTINUE_57                                 ; NOTHING, CONTINUE
0000065A                          1315m 
0000065A                          1316mm     READ_CHAR D1                                    ; WE're not going to do anything with it, just check for escape
0000065A                 TRUE     1317mm     IFEQ DEBUG
0000065A  1239 00C00007           1318mm         MOVE.B DUART_RXA,D1                         ; GOT A CHARACTER, READ IT
00000660                          1319mm     ENDC
00000660                 FALSE    1320mm     IFNE DEBUG
00000660                          1321mm     ENDC
00000660                          1322mm 
00000660  B23C 001B               1323mm     CMP.B #$1B,D1                                   ; CHECK FOR ESCAPE AND GO TO START
00000664  6700 FA9E               1324mm     BEQ START
00000668                          1325mm     ENDM
00000668                          1326m CONTINUE_57
00000668  1239 00C00013           1327m     MOVE.B DUART_SRB,D1                             ; READ DOWNLOAD STATUS REGISTER
0000066E  0801 0000               1328m     BTST #0,D1                                      ; CHECK FOR CHARACTER
00000672  67D8                    1329m     BEQ WAIT_FOR_READY_57                           ; NOTHING, CHECK AGAIN
00000674                          1330m     
00000674  1239 00C00017           1331m     MOVE.B DUART_RXB,D1                             ; GOT A CHARACTER, READ IT
0000067A  13C1 00E00001           1332m     MOVE.B D1,DISPLAY                               ; ECHO TO THE DISPLAY
00000680                          1333m 
00000680                          1334m     ENDM
00000680                          1335      ;PRINT_CHAR D1,D5
00000680                          1336  
00000680  7400                    1337      MOVE.L #0,D2                                    ; clear the checksum
00000682                          1338  
00000682                          1339m     DOWNLOAD_BYTE D3,D5,D6,D7,D2,A4
00000682  1E3C 0002               1340m     MOVE.B #2,D7
00000686                          1341m     WHILE.B D7 <GT> 0 DO
00000686                          1342ms _10000000
00000686  BE38 0000               1343ms     CMP.B   0,D7
0000068A  6F00 0050               1344ms     BLE _10000001
0000068E  E98B                    1345m         LSL.L #4,D3                                 ; IT's OK to do this first, because we are either starting from 0, 
00000690                          1346mm         DOWNLOAD D5                                 ; OR WE ARE READING THE NEXT BYTE ALONG, SO NEED TO SHIFT UP THE PREVIOUS ONE
00000690                          1347mm WAIT_FOR_READY_60                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000690                          1348mm 
00000690  1A39 00C00003           1349mm     MOVE.B DUART_SRA,D5                             ; CHECK FOR COMMAND
00000696  0805 0000               1350mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
0000069A  6700 0010               1351mm     BEQ CONTINUE_60                                 ; NOTHING, CONTINUE
0000069E                          1352mm 
0000069E                          1353mmm     READ_CHAR D5                                    ; WE're not going to do anything with it, just check for escape
0000069E                 TRUE     1354mmm     IFEQ DEBUG
0000069E  1A39 00C00007           1355mmm         MOVE.B DUART_RXA,D5                         ; GOT A CHARACTER, READ IT
000006A4                          1356mmm     ENDC
000006A4                 FALSE    1357mmm     IFNE DEBUG
000006A4                          1358mmm     ENDC
000006A4                          1359mmm 
000006A4  BA3C 001B               1360mmm     CMP.B #$1B,D5                                   ; CHECK FOR ESCAPE AND GO TO START
000006A8  6700 FA5A               1361mmm     BEQ START
000006AC                          1362mmm     ENDM
000006AC                          1363mm CONTINUE_60
000006AC  1A39 00C00013           1364mm     MOVE.B DUART_SRB,D5                             ; READ DOWNLOAD STATUS REGISTER
000006B2  0805 0000               1365mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
000006B6  67D8                    1366mm     BEQ WAIT_FOR_READY_60                           ; NOTHING, CHECK AGAIN
000006B8                          1367mm     
000006B8  1A39 00C00017           1368mm     MOVE.B DUART_RXB,D5                             ; GOT A CHARACTER, READ IT
000006BE  13C5 00E00001           1369mm     MOVE.B D5,DISPLAY                               ; ECHO TO THE DISPLAY
000006C4                          1370mm 
000006C4                          1371mm     ENDM
000006C4                          1372m         ;PRINT_CHAR D5,D6
000006C4                          1373mm         HEX2BIN D5,D5,A4
000006C4  49FA 20D4               1374mm     LEA HEX2BIN_LUT(PC),A4                          ; LOAD THE LOOKUP TABLE
000006C8  0405 0030               1375mm     SUB.B #'0',D5                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
000006CC  CABC 000000FF           1376mm     AND.L #$FF,D5                                   ; IGNORE THE TOP 3 BYTES
000006D2  1A34 5000               1377mm     MOVE.B 0(A4,D5),D5                              ; USE THAT AS AN INDEX INTO THE LUT   
000006D6                          1378mm     ENDM
000006D6  8605                    1379m         OR.B D5,D3
000006D8  5307                    1380m         SUB.B #1,D7
000006DA                          1381m     ENDW
000006DA  60AA                    1382ms     BRA _10000000
000006DC                          1383ms _10000001
000006DC                          1384m 
000006DC  7A00                    1385m     MOVE.L #0,D5                                    ; REXTRACT LATEST BYTE OF ADDRESS AND ADD INTO CHECKSUM
000006DE  1A03                    1386m     MOVE.B D3,D5
000006E0  D483                    1387m     ADD.L D3,D2
000006E2                          1388m 
000006E2                          1389m     ENDM
000006E2                          1390  
000006E2                          1391      IF.B D1 <EQ> #'0' THEN.L                        ; header, just ignore it
000006E2  B23C 0030               1392s     CMP.B   #'0',D1
000006E6  6600 000A               1393s     BNE.L   _00000003
000006EA                          1394          ;PRINT_CRLF D5,A4
000006EA  6000 FF10               1395          BRA WAIT_FOR_SRECORD
000006EE                          1396      ELSE
000006EE  6000 0360               1397s     BRA _00000004
000006F2                          1398s _00000003
000006F2                          1399          IF.B D1 <EQ> #'1' OR.B D1 <EQ> #'2' THEN.L  ; 16 or 24 bit address data record
000006F2  B23C 0031               1400s     CMP.B   #'1',D1
000006F6  6708                    1401s     BEQ.S   _00000005
000006F8  B23C 0032               1402s     CMP.B   #'2',D1
000006FC  6600 01A8               1403s     BNE.L   _00000006
00000700                          1404s _00000005
00000700  5783                    1405              SUB.L #3,D3                             ; subtract three bytes for 16 bit address and 1 byte checksum
00000702                          1406  
00000702  7800                    1407              MOVE.L #0,D4                            ; read two bytes of address
00000704                          1408m             DOWNLOAD_BYTE D4,D5,D6,D7,D2,A4         ; first byte                                    
00000704  1E3C 0002               1409m     MOVE.B #2,D7
00000708                          1410m     WHILE.B D7 <GT> 0 DO
00000708                          1411ms _10000002
00000708  BE38 0000               1412ms     CMP.B   0,D7
0000070C  6F00 0050               1413ms     BLE _10000003
00000710  E98C                    1414m         LSL.L #4,D4                                 ; IT's OK to do this first, because we are either starting from 0, 
00000712                          1415mm         DOWNLOAD D5                                 ; OR WE ARE READING THE NEXT BYTE ALONG, SO NEED TO SHIFT UP THE PREVIOUS ONE
00000712                          1416mm WAIT_FOR_READY_64                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000712                          1417mm 
00000712  1A39 00C00003           1418mm     MOVE.B DUART_SRA,D5                             ; CHECK FOR COMMAND
00000718  0805 0000               1419mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
0000071C  6700 0010               1420mm     BEQ CONTINUE_64                                 ; NOTHING, CONTINUE
00000720                          1421mm 
00000720                          1422mmm     READ_CHAR D5                                    ; WE're not going to do anything with it, just check for escape
00000720                 TRUE     1423mmm     IFEQ DEBUG
00000720  1A39 00C00007           1424mmm         MOVE.B DUART_RXA,D5                         ; GOT A CHARACTER, READ IT
00000726                          1425mmm     ENDC
00000726                 FALSE    1426mmm     IFNE DEBUG
00000726                          1427mmm     ENDC
00000726                          1428mmm 
00000726  BA3C 001B               1429mmm     CMP.B #$1B,D5                                   ; CHECK FOR ESCAPE AND GO TO START
0000072A  6700 F9D8               1430mmm     BEQ START
0000072E                          1431mmm     ENDM
0000072E                          1432mm CONTINUE_64
0000072E  1A39 00C00013           1433mm     MOVE.B DUART_SRB,D5                             ; READ DOWNLOAD STATUS REGISTER
00000734  0805 0000               1434mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
00000738  67D8                    1435mm     BEQ WAIT_FOR_READY_64                           ; NOTHING, CHECK AGAIN
0000073A                          1436mm     
0000073A  1A39 00C00017           1437mm     MOVE.B DUART_RXB,D5                             ; GOT A CHARACTER, READ IT
00000740  13C5 00E00001           1438mm     MOVE.B D5,DISPLAY                               ; ECHO TO THE DISPLAY
00000746                          1439mm 
00000746                          1440mm     ENDM
00000746                          1441m         ;PRINT_CHAR D5,D6
00000746                          1442mm         HEX2BIN D5,D5,A4
00000746  49FA 2052               1443mm     LEA HEX2BIN_LUT(PC),A4                          ; LOAD THE LOOKUP TABLE
0000074A  0405 0030               1444mm     SUB.B #'0',D5                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
0000074E  CABC 000000FF           1445mm     AND.L #$FF,D5                                   ; IGNORE THE TOP 3 BYTES
00000754  1A34 5000               1446mm     MOVE.B 0(A4,D5),D5                              ; USE THAT AS AN INDEX INTO THE LUT   
00000758                          1447mm     ENDM
00000758  8805                    1448m         OR.B D5,D4
0000075A  5307                    1449m         SUB.B #1,D7
0000075C                          1450m     ENDW
0000075C  60AA                    1451ms     BRA _10000002
0000075E                          1452ms _10000003
0000075E                          1453m 
0000075E  7A00                    1454m     MOVE.L #0,D5                                    ; REXTRACT LATEST BYTE OF ADDRESS AND ADD INTO CHECKSUM
00000760  1A04                    1455m     MOVE.B D4,D5
00000762  D484                    1456m     ADD.L D4,D2
00000764                          1457m 
00000764                          1458m     ENDM
00000764                          1459m             DOWNLOAD_BYTE D4,D5,D6,D7,D2,A4         ; second one
00000764  1E3C 0002               1460m     MOVE.B #2,D7
00000768                          1461m     WHILE.B D7 <GT> 0 DO
00000768                          1462ms _10000004
00000768  BE38 0000               1463ms     CMP.B   0,D7
0000076C  6F00 0050               1464ms     BLE _10000005
00000770  E98C                    1465m         LSL.L #4,D4                                 ; IT's OK to do this first, because we are either starting from 0, 
00000772                          1466mm         DOWNLOAD D5                                 ; OR WE ARE READING THE NEXT BYTE ALONG, SO NEED TO SHIFT UP THE PREVIOUS ONE
00000772                          1467mm WAIT_FOR_READY_68                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000772                          1468mm 
00000772  1A39 00C00003           1469mm     MOVE.B DUART_SRA,D5                             ; CHECK FOR COMMAND
00000778  0805 0000               1470mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
0000077C  6700 0010               1471mm     BEQ CONTINUE_68                                 ; NOTHING, CONTINUE
00000780                          1472mm 
00000780                          1473mmm     READ_CHAR D5                                    ; WE're not going to do anything with it, just check for escape
00000780                 TRUE     1474mmm     IFEQ DEBUG
00000780  1A39 00C00007           1475mmm         MOVE.B DUART_RXA,D5                         ; GOT A CHARACTER, READ IT
00000786                          1476mmm     ENDC
00000786                 FALSE    1477mmm     IFNE DEBUG
00000786                          1478mmm     ENDC
00000786                          1479mmm 
00000786  BA3C 001B               1480mmm     CMP.B #$1B,D5                                   ; CHECK FOR ESCAPE AND GO TO START
0000078A  6700 F978               1481mmm     BEQ START
0000078E                          1482mmm     ENDM
0000078E                          1483mm CONTINUE_68
0000078E  1A39 00C00013           1484mm     MOVE.B DUART_SRB,D5                             ; READ DOWNLOAD STATUS REGISTER
00000794  0805 0000               1485mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
00000798  67D8                    1486mm     BEQ WAIT_FOR_READY_68                           ; NOTHING, CHECK AGAIN
0000079A                          1487mm     
0000079A  1A39 00C00017           1488mm     MOVE.B DUART_RXB,D5                             ; GOT A CHARACTER, READ IT
000007A0  13C5 00E00001           1489mm     MOVE.B D5,DISPLAY                               ; ECHO TO THE DISPLAY
000007A6                          1490mm 
000007A6                          1491mm     ENDM
000007A6                          1492m         ;PRINT_CHAR D5,D6
000007A6                          1493mm         HEX2BIN D5,D5,A4
000007A6  49FA 1FF2               1494mm     LEA HEX2BIN_LUT(PC),A4                          ; LOAD THE LOOKUP TABLE
000007AA  0405 0030               1495mm     SUB.B #'0',D5                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
000007AE  CABC 000000FF           1496mm     AND.L #$FF,D5                                   ; IGNORE THE TOP 3 BYTES
000007B4  1A34 5000               1497mm     MOVE.B 0(A4,D5),D5                              ; USE THAT AS AN INDEX INTO THE LUT   
000007B8                          1498mm     ENDM
000007B8  8805                    1499m         OR.B D5,D4
000007BA  5307                    1500m         SUB.B #1,D7
000007BC                          1501m     ENDW
000007BC  60AA                    1502ms     BRA _10000004
000007BE                          1503ms _10000005
000007BE                          1504m 
000007BE  7A00                    1505m     MOVE.L #0,D5                                    ; REXTRACT LATEST BYTE OF ADDRESS AND ADD INTO CHECKSUM
000007C0  1A04                    1506m     MOVE.B D4,D5
000007C2  D484                    1507m     ADD.L D4,D2
000007C4                          1508m 
000007C4                          1509m     ENDM
000007C4                          1510  
000007C4                          1511              IF.B D1 <EQ> #'2'  THEN.L               ; 24 bit address data record, read another byte
000007C4  B23C 0032               1512s     CMP.B   #'2',D1
000007C8  6600 0064               1513s     BNE.L   _00000007
000007CC  5383                    1514                  SUB.L #1,D3                         ; subtract an extra bytes for 24 bit address    
000007CE                          1515m                 DOWNLOAD_BYTE D4,D5,D6,D7,D2,A4     ; 3rd byte
000007CE  1E3C 0002               1516m     MOVE.B #2,D7
000007D2                          1517m     WHILE.B D7 <GT> 0 DO
000007D2                          1518ms _10000006
000007D2  BE38 0000               1519ms     CMP.B   0,D7
000007D6  6F00 0050               1520ms     BLE _10000007
000007DA  E98C                    1521m         LSL.L #4,D4                                 ; IT's OK to do this first, because we are either starting from 0, 
000007DC                          1522mm         DOWNLOAD D5                                 ; OR WE ARE READING THE NEXT BYTE ALONG, SO NEED TO SHIFT UP THE PREVIOUS ONE
000007DC                          1523mm WAIT_FOR_READY_72                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
000007DC                          1524mm 
000007DC  1A39 00C00003           1525mm     MOVE.B DUART_SRA,D5                             ; CHECK FOR COMMAND
000007E2  0805 0000               1526mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
000007E6  6700 0010               1527mm     BEQ CONTINUE_72                                 ; NOTHING, CONTINUE
000007EA                          1528mm 
000007EA                          1529mmm     READ_CHAR D5                                    ; WE're not going to do anything with it, just check for escape
000007EA                 TRUE     1530mmm     IFEQ DEBUG
000007EA  1A39 00C00007           1531mmm         MOVE.B DUART_RXA,D5                         ; GOT A CHARACTER, READ IT
000007F0                          1532mmm     ENDC
000007F0                 FALSE    1533mmm     IFNE DEBUG
000007F0                          1534mmm     ENDC
000007F0                          1535mmm 
000007F0  BA3C 001B               1536mmm     CMP.B #$1B,D5                                   ; CHECK FOR ESCAPE AND GO TO START
000007F4  6700 F90E               1537mmm     BEQ START
000007F8                          1538mmm     ENDM
000007F8                          1539mm CONTINUE_72
000007F8  1A39 00C00013           1540mm     MOVE.B DUART_SRB,D5                             ; READ DOWNLOAD STATUS REGISTER
000007FE  0805 0000               1541mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
00000802  67D8                    1542mm     BEQ WAIT_FOR_READY_72                           ; NOTHING, CHECK AGAIN
00000804                          1543mm     
00000804  1A39 00C00017           1544mm     MOVE.B DUART_RXB,D5                             ; GOT A CHARACTER, READ IT
0000080A  13C5 00E00001           1545mm     MOVE.B D5,DISPLAY                               ; ECHO TO THE DISPLAY
00000810                          1546mm 
00000810                          1547mm     ENDM
00000810                          1548m         ;PRINT_CHAR D5,D6
00000810                          1549mm         HEX2BIN D5,D5,A4
00000810  49FA 1F88               1550mm     LEA HEX2BIN_LUT(PC),A4                          ; LOAD THE LOOKUP TABLE
00000814  0405 0030               1551mm     SUB.B #'0',D5                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
00000818  CABC 000000FF           1552mm     AND.L #$FF,D5                                   ; IGNORE THE TOP 3 BYTES
0000081E  1A34 5000               1553mm     MOVE.B 0(A4,D5),D5                              ; USE THAT AS AN INDEX INTO THE LUT   
00000822                          1554mm     ENDM
00000822  8805                    1555m         OR.B D5,D4
00000824  5307                    1556m         SUB.B #1,D7
00000826                          1557m     ENDW
00000826  60AA                    1558ms     BRA _10000006
00000828                          1559ms _10000007
00000828                          1560m 
00000828  7A00                    1561m     MOVE.L #0,D5                                    ; REXTRACT LATEST BYTE OF ADDRESS AND ADD INTO CHECKSUM
0000082A  1A04                    1562m     MOVE.B D4,D5
0000082C  D484                    1563m     ADD.L D4,D2
0000082E                          1564m 
0000082E                          1565m     ENDM
0000082E                          1566              ENDI
0000082E                          1567s _00000007
0000082E                          1568  
0000082E  2444                    1569              MOVE.L D4,A2                            ; put the address in an address register
00000830  D5C9                    1570              ADD.L A1,A2                             ; add in the offset
00000832                          1571  
00000832                          1572              WHILE.B D3 <GT> #0 DO                   ; read the data bytes
00000832                          1573s _10000008
00000832  B63C 0000               1574s     CMP.B   #0,D3
00000836  6F00 0068               1575s     BLE _10000009
0000083A                          1576m                 DOWNLOAD_BYTE D1,D5,D6,D7,D2,A4     ; read it
0000083A  1E3C 0002               1577m     MOVE.B #2,D7
0000083E                          1578m     WHILE.B D7 <GT> 0 DO
0000083E                          1579ms _1000000A
0000083E  BE38 0000               1580ms     CMP.B   0,D7
00000842  6F00 0050               1581ms     BLE _1000000B
00000846  E989                    1582m         LSL.L #4,D1                                 ; IT's OK to do this first, because we are either starting from 0, 
00000848                          1583mm         DOWNLOAD D5                                 ; OR WE ARE READING THE NEXT BYTE ALONG, SO NEED TO SHIFT UP THE PREVIOUS ONE
00000848                          1584mm WAIT_FOR_READY_76                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000848                          1585mm 
00000848  1A39 00C00003           1586mm     MOVE.B DUART_SRA,D5                             ; CHECK FOR COMMAND
0000084E  0805 0000               1587mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
00000852  6700 0010               1588mm     BEQ CONTINUE_76                                 ; NOTHING, CONTINUE
00000856                          1589mm 
00000856                          1590mmm     READ_CHAR D5                                    ; WE're not going to do anything with it, just check for escape
00000856                 TRUE     1591mmm     IFEQ DEBUG
00000856  1A39 00C00007           1592mmm         MOVE.B DUART_RXA,D5                         ; GOT A CHARACTER, READ IT
0000085C                          1593mmm     ENDC
0000085C                 FALSE    1594mmm     IFNE DEBUG
0000085C                          1595mmm     ENDC
0000085C                          1596mmm 
0000085C  BA3C 001B               1597mmm     CMP.B #$1B,D5                                   ; CHECK FOR ESCAPE AND GO TO START
00000860  6700 F8A2               1598mmm     BEQ START
00000864                          1599mmm     ENDM
00000864                          1600mm CONTINUE_76
00000864  1A39 00C00013           1601mm     MOVE.B DUART_SRB,D5                             ; READ DOWNLOAD STATUS REGISTER
0000086A  0805 0000               1602mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
0000086E  67D8                    1603mm     BEQ WAIT_FOR_READY_76                           ; NOTHING, CHECK AGAIN
00000870                          1604mm     
00000870  1A39 00C00017           1605mm     MOVE.B DUART_RXB,D5                             ; GOT A CHARACTER, READ IT
00000876  13C5 00E00001           1606mm     MOVE.B D5,DISPLAY                               ; ECHO TO THE DISPLAY
0000087C                          1607mm 
0000087C                          1608mm     ENDM
0000087C                          1609m         ;PRINT_CHAR D5,D6
0000087C                          1610mm         HEX2BIN D5,D5,A4
0000087C  49FA 1F1C               1611mm     LEA HEX2BIN_LUT(PC),A4                          ; LOAD THE LOOKUP TABLE
00000880  0405 0030               1612mm     SUB.B #'0',D5                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
00000884  CABC 000000FF           1613mm     AND.L #$FF,D5                                   ; IGNORE THE TOP 3 BYTES
0000088A  1A34 5000               1614mm     MOVE.B 0(A4,D5),D5                              ; USE THAT AS AN INDEX INTO THE LUT   
0000088E                          1615mm     ENDM
0000088E  8205                    1616m         OR.B D5,D1
00000890  5307                    1617m         SUB.B #1,D7
00000892                          1618m     ENDW
00000892  60AA                    1619ms     BRA _1000000A
00000894                          1620ms _1000000B
00000894                          1621m 
00000894  7A00                    1622m     MOVE.L #0,D5                                    ; REXTRACT LATEST BYTE OF ADDRESS AND ADD INTO CHECKSUM
00000896  1A01                    1623m     MOVE.B D1,D5
00000898  D481                    1624m     ADD.L D1,D2
0000089A                          1625m 
0000089A                          1626m     ENDM
0000089A                          1627   
0000089A  14C1                    1628                  MOVE.B D1,(A2)+                     ; store it!
0000089C                          1629  
0000089C  5303                    1630                  SUB.B #1,D3                         ; 1 less byte to go
0000089E                          1631              ENDW
0000089E  6092                    1632s     BRA _10000008
000008A0                          1633s _10000009
000008A0                          1634  
000008A0  7200                    1635              MOVE.L #0,D1                            ; not done yet
000008A2                          1636          ELSE
000008A2  6000 01AC               1637s     BRA _00000008
000008A6                          1638s _00000006
000008A6                          1639              IF.B D1 <EQ> #'8' THEN.L                ; termination record, exit
000008A6  B23C 0038               1640s     CMP.B   #'8',D1
000008AA  6600 012E               1641s     BNE.L   _00000009
000008AE  7800                    1642                  MOVE.L #0,D4                        ; read the 24 bit start address
000008B0                          1643m                 DOWNLOAD_BYTE D4,D5,D6,D7,D2,A4     ; top byte
000008B0  1E3C 0002               1644m     MOVE.B #2,D7
000008B4                          1645m     WHILE.B D7 <GT> 0 DO
000008B4                          1646ms _1000000C
000008B4  BE38 0000               1647ms     CMP.B   0,D7
000008B8  6F00 0050               1648ms     BLE _1000000D
000008BC  E98C                    1649m         LSL.L #4,D4                                 ; IT's OK to do this first, because we are either starting from 0, 
000008BE                          1650mm         DOWNLOAD D5                                 ; OR WE ARE READING THE NEXT BYTE ALONG, SO NEED TO SHIFT UP THE PREVIOUS ONE
000008BE                          1651mm WAIT_FOR_READY_80                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
000008BE                          1652mm 
000008BE  1A39 00C00003           1653mm     MOVE.B DUART_SRA,D5                             ; CHECK FOR COMMAND
000008C4  0805 0000               1654mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
000008C8  6700 0010               1655mm     BEQ CONTINUE_80                                 ; NOTHING, CONTINUE
000008CC                          1656mm 
000008CC                          1657mmm     READ_CHAR D5                                    ; WE're not going to do anything with it, just check for escape
000008CC                 TRUE     1658mmm     IFEQ DEBUG
000008CC  1A39 00C00007           1659mmm         MOVE.B DUART_RXA,D5                         ; GOT A CHARACTER, READ IT
000008D2                          1660mmm     ENDC
000008D2                 FALSE    1661mmm     IFNE DEBUG
000008D2                          1662mmm     ENDC
000008D2                          1663mmm 
000008D2  BA3C 001B               1664mmm     CMP.B #$1B,D5                                   ; CHECK FOR ESCAPE AND GO TO START
000008D6  6700 F82C               1665mmm     BEQ START
000008DA                          1666mmm     ENDM
000008DA                          1667mm CONTINUE_80
000008DA  1A39 00C00013           1668mm     MOVE.B DUART_SRB,D5                             ; READ DOWNLOAD STATUS REGISTER
000008E0  0805 0000               1669mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
000008E4  67D8                    1670mm     BEQ WAIT_FOR_READY_80                           ; NOTHING, CHECK AGAIN
000008E6                          1671mm     
000008E6  1A39 00C00017           1672mm     MOVE.B DUART_RXB,D5                             ; GOT A CHARACTER, READ IT
000008EC  13C5 00E00001           1673mm     MOVE.B D5,DISPLAY                               ; ECHO TO THE DISPLAY
000008F2                          1674mm 
000008F2                          1675mm     ENDM
000008F2                          1676m         ;PRINT_CHAR D5,D6
000008F2                          1677mm         HEX2BIN D5,D5,A4
000008F2  49FA 1EA6               1678mm     LEA HEX2BIN_LUT(PC),A4                          ; LOAD THE LOOKUP TABLE
000008F6  0405 0030               1679mm     SUB.B #'0',D5                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
000008FA  CABC 000000FF           1680mm     AND.L #$FF,D5                                   ; IGNORE THE TOP 3 BYTES
00000900  1A34 5000               1681mm     MOVE.B 0(A4,D5),D5                              ; USE THAT AS AN INDEX INTO THE LUT   
00000904                          1682mm     ENDM
00000904  8805                    1683m         OR.B D5,D4
00000906  5307                    1684m         SUB.B #1,D7
00000908                          1685m     ENDW
00000908  60AA                    1686ms     BRA _1000000C
0000090A                          1687ms _1000000D
0000090A                          1688m 
0000090A  7A00                    1689m     MOVE.L #0,D5                                    ; REXTRACT LATEST BYTE OF ADDRESS AND ADD INTO CHECKSUM
0000090C  1A04                    1690m     MOVE.B D4,D5
0000090E  D484                    1691m     ADD.L D4,D2
00000910                          1692m 
00000910                          1693m     ENDM
00000910                          1694m                 DOWNLOAD_BYTE D4,D5,D6,D7,D2,A4     ; middle byte
00000910  1E3C 0002               1695m     MOVE.B #2,D7
00000914                          1696m     WHILE.B D7 <GT> 0 DO
00000914                          1697ms _1000000E
00000914  BE38 0000               1698ms     CMP.B   0,D7
00000918  6F00 0050               1699ms     BLE _1000000F
0000091C  E98C                    1700m         LSL.L #4,D4                                 ; IT's OK to do this first, because we are either starting from 0, 
0000091E                          1701mm         DOWNLOAD D5                                 ; OR WE ARE READING THE NEXT BYTE ALONG, SO NEED TO SHIFT UP THE PREVIOUS ONE
0000091E                          1702mm WAIT_FOR_READY_84                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000091E                          1703mm 
0000091E  1A39 00C00003           1704mm     MOVE.B DUART_SRA,D5                             ; CHECK FOR COMMAND
00000924  0805 0000               1705mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
00000928  6700 0010               1706mm     BEQ CONTINUE_84                                 ; NOTHING, CONTINUE
0000092C                          1707mm 
0000092C                          1708mmm     READ_CHAR D5                                    ; WE're not going to do anything with it, just check for escape
0000092C                 TRUE     1709mmm     IFEQ DEBUG
0000092C  1A39 00C00007           1710mmm         MOVE.B DUART_RXA,D5                         ; GOT A CHARACTER, READ IT
00000932                          1711mmm     ENDC
00000932                 FALSE    1712mmm     IFNE DEBUG
00000932                          1713mmm     ENDC
00000932                          1714mmm 
00000932  BA3C 001B               1715mmm     CMP.B #$1B,D5                                   ; CHECK FOR ESCAPE AND GO TO START
00000936  6700 F7CC               1716mmm     BEQ START
0000093A                          1717mmm     ENDM
0000093A                          1718mm CONTINUE_84
0000093A  1A39 00C00013           1719mm     MOVE.B DUART_SRB,D5                             ; READ DOWNLOAD STATUS REGISTER
00000940  0805 0000               1720mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
00000944  67D8                    1721mm     BEQ WAIT_FOR_READY_84                           ; NOTHING, CHECK AGAIN
00000946                          1722mm     
00000946  1A39 00C00017           1723mm     MOVE.B DUART_RXB,D5                             ; GOT A CHARACTER, READ IT
0000094C  13C5 00E00001           1724mm     MOVE.B D5,DISPLAY                               ; ECHO TO THE DISPLAY
00000952                          1725mm 
00000952                          1726mm     ENDM
00000952                          1727m         ;PRINT_CHAR D5,D6
00000952                          1728mm         HEX2BIN D5,D5,A4
00000952  49FA 1E46               1729mm     LEA HEX2BIN_LUT(PC),A4                          ; LOAD THE LOOKUP TABLE
00000956  0405 0030               1730mm     SUB.B #'0',D5                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
0000095A  CABC 000000FF           1731mm     AND.L #$FF,D5                                   ; IGNORE THE TOP 3 BYTES
00000960  1A34 5000               1732mm     MOVE.B 0(A4,D5),D5                              ; USE THAT AS AN INDEX INTO THE LUT   
00000964                          1733mm     ENDM
00000964  8805                    1734m         OR.B D5,D4
00000966  5307                    1735m         SUB.B #1,D7
00000968                          1736m     ENDW
00000968  60AA                    1737ms     BRA _1000000E
0000096A                          1738ms _1000000F
0000096A                          1739m 
0000096A  7A00                    1740m     MOVE.L #0,D5                                    ; REXTRACT LATEST BYTE OF ADDRESS AND ADD INTO CHECKSUM
0000096C  1A04                    1741m     MOVE.B D4,D5
0000096E  D484                    1742m     ADD.L D4,D2
00000970                          1743m 
00000970                          1744m     ENDM
00000970                          1745m                 DOWNLOAD_BYTE D4,D5,D6,D7,D2,A4     ; bottom byte
00000970  1E3C 0002               1746m     MOVE.B #2,D7
00000974                          1747m     WHILE.B D7 <GT> 0 DO
00000974                          1748ms _10000010
00000974  BE38 0000               1749ms     CMP.B   0,D7
00000978  6F00 0050               1750ms     BLE _10000011
0000097C  E98C                    1751m         LSL.L #4,D4                                 ; IT's OK to do this first, because we are either starting from 0, 
0000097E                          1752mm         DOWNLOAD D5                                 ; OR WE ARE READING THE NEXT BYTE ALONG, SO NEED TO SHIFT UP THE PREVIOUS ONE
0000097E                          1753mm WAIT_FOR_READY_88                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000097E                          1754mm 
0000097E  1A39 00C00003           1755mm     MOVE.B DUART_SRA,D5                             ; CHECK FOR COMMAND
00000984  0805 0000               1756mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
00000988  6700 0010               1757mm     BEQ CONTINUE_88                                 ; NOTHING, CONTINUE
0000098C                          1758mm 
0000098C                          1759mmm     READ_CHAR D5                                    ; WE're not going to do anything with it, just check for escape
0000098C                 TRUE     1760mmm     IFEQ DEBUG
0000098C  1A39 00C00007           1761mmm         MOVE.B DUART_RXA,D5                         ; GOT A CHARACTER, READ IT
00000992                          1762mmm     ENDC
00000992                 FALSE    1763mmm     IFNE DEBUG
00000992                          1764mmm     ENDC
00000992                          1765mmm 
00000992  BA3C 001B               1766mmm     CMP.B #$1B,D5                                   ; CHECK FOR ESCAPE AND GO TO START
00000996  6700 F76C               1767mmm     BEQ START
0000099A                          1768mmm     ENDM
0000099A                          1769mm CONTINUE_88
0000099A  1A39 00C00013           1770mm     MOVE.B DUART_SRB,D5                             ; READ DOWNLOAD STATUS REGISTER
000009A0  0805 0000               1771mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
000009A4  67D8                    1772mm     BEQ WAIT_FOR_READY_88                           ; NOTHING, CHECK AGAIN
000009A6                          1773mm     
000009A6  1A39 00C00017           1774mm     MOVE.B DUART_RXB,D5                             ; GOT A CHARACTER, READ IT
000009AC  13C5 00E00001           1775mm     MOVE.B D5,DISPLAY                               ; ECHO TO THE DISPLAY
000009B2                          1776mm 
000009B2                          1777mm     ENDM
000009B2                          1778m         ;PRINT_CHAR D5,D6
000009B2                          1779mm         HEX2BIN D5,D5,A4
000009B2  49FA 1DE6               1780mm     LEA HEX2BIN_LUT(PC),A4                          ; LOAD THE LOOKUP TABLE
000009B6  0405 0030               1781mm     SUB.B #'0',D5                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
000009BA  CABC 000000FF           1782mm     AND.L #$FF,D5                                   ; IGNORE THE TOP 3 BYTES
000009C0  1A34 5000               1783mm     MOVE.B 0(A4,D5),D5                              ; USE THAT AS AN INDEX INTO THE LUT   
000009C4                          1784mm     ENDM
000009C4  8805                    1785m         OR.B D5,D4
000009C6  5307                    1786m         SUB.B #1,D7
000009C8                          1787m     ENDW
000009C8  60AA                    1788ms     BRA _10000010
000009CA                          1789ms _10000011
000009CA                          1790m 
000009CA  7A00                    1791m     MOVE.L #0,D5                                    ; REXTRACT LATEST BYTE OF ADDRESS AND ADD INTO CHECKSUM
000009CC  1A04                    1792m     MOVE.B D4,D5
000009CE  D484                    1793m     ADD.L D4,D2
000009D0                          1794m 
000009D0                          1795m     ENDM
000009D0                          1796  
000009D0  2044                    1797                  MOVE.L D4,A0                        ; start address -> A0
000009D2  D1C9                    1798                  ADD.L A1,A0                         ; add in the offset
000009D4                          1799  
000009D4  72FF                    1800                  MOVE.L #$FFFFFFFF,D1                ; done
000009D6                          1801              ELSE
000009D6  6000 0078               1802s     BRA _0000000A
000009DA                          1803s _00000009
000009DA                          1804m                 PRINT_CRLF D5,A4
000009DA  49FA 1DE9               1805m     LEA CRLF(PC),A4
000009DE                          1806mm     PRINT_STR A4,D5
000009DE                          1807mm LOOP_92
000009DE  0C14 0000               1808mm     CMP.B #NULL,(A4)                                ; 0 -> DONE
000009E2  6700 0016               1809mm     BEQ EXIT_92
000009E6                          1810mmm     PRINT_CHAR (A4)+,D5
000009E6                          1811mmm WAIT_FOR_READY_93                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
000009E6                 TRUE     1812mmm     IFEQ DEBUG
000009E6  1A39 00C00003           1813mmm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
000009EC  0805 0002               1814mmm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
000009F0  67F4                    1815mmm         BEQ WAIT_FOR_READY_93                       ; NO SPACE, CHECK AGAIN
000009F2  13DC 00C00007           1816mmm         MOVE.B (A4)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000009F8                          1817mmm     ENDC
000009F8                          1818mmm 
000009F8                 FALSE    1819mmm     IFNE DEBUG
000009F8                          1820mmm     ENDC
000009F8                          1821mmm 
000009F8                          1822mmm     ENDM
000009F8  60E4                    1823mm     BRA LOOP_92
000009FA                          1824mm EXIT_92
000009FA                          1825mm     ENDM
000009FA                          1826m     ENDM
000009FA                          1827  
000009FA  49FA 1D55               1828                  LEA UNREC(PC),A4                    ; warn for unrecognised type
000009FE                          1829m                 PRINT_STR A4,D5
000009FE                          1830m LOOP_94
000009FE  0C14 0000               1831m     CMP.B #NULL,(A4)                                ; 0 -> DONE
00000A02  6700 0016               1832m     BEQ EXIT_94
00000A06                          1833mm     PRINT_CHAR (A4)+,D5
00000A06                          1834mm WAIT_FOR_READY_95                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000A06                 TRUE     1835mm     IFEQ DEBUG
00000A06  1A39 00C00003           1836mm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000A0C  0805 0002               1837mm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000A10  67F4                    1838mm         BEQ WAIT_FOR_READY_95                       ; NO SPACE, CHECK AGAIN
00000A12  13DC 00C00007           1839mm         MOVE.B (A4)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000A18                          1840mm     ENDC
00000A18                          1841mm 
00000A18                 FALSE    1842mm     IFNE DEBUG
00000A18                          1843mm     ENDC
00000A18                          1844mm 
00000A18                          1845mm     ENDM
00000A18  60E4                    1846m     BRA LOOP_94
00000A1A                          1847m EXIT_94
00000A1A                          1848m     ENDM
00000A1A                          1849m                 PRINT_CHAR D1,D5
00000A1A                          1850m WAIT_FOR_READY_96                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000A1A                 TRUE     1851m     IFEQ DEBUG
00000A1A  1A39 00C00003           1852m         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000A20  0805 0002               1853m         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000A24  67F4                    1854m         BEQ WAIT_FOR_READY_96                       ; NO SPACE, CHECK AGAIN
00000A26  13C1 00C00007           1855m         MOVE.B D1,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000A2C                          1856m     ENDC
00000A2C                          1857m 
00000A2C                 FALSE    1858m     IFNE DEBUG
00000A2C                          1859m     ENDC
00000A2C                          1860m 
00000A2C                          1861m     ENDM
00000A2C                          1862m                 PRINT_CRLF D5,A4
00000A2C  49FA 1D97               1863m     LEA CRLF(PC),A4
00000A30                          1864mm     PRINT_STR A4,D5
00000A30                          1865mm LOOP_98
00000A30  0C14 0000               1866mm     CMP.B #NULL,(A4)                                ; 0 -> DONE
00000A34  6700 0016               1867mm     BEQ EXIT_98
00000A38                          1868mmm     PRINT_CHAR (A4)+,D5
00000A38                          1869mmm WAIT_FOR_READY_99                                   ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000A38                 TRUE     1870mmm     IFEQ DEBUG
00000A38  1A39 00C00003           1871mmm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000A3E  0805 0002               1872mmm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000A42  67F4                    1873mmm         BEQ WAIT_FOR_READY_99                       ; NO SPACE, CHECK AGAIN
00000A44  13DC 00C00007           1874mmm         MOVE.B (A4)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000A4A                          1875mmm     ENDC
00000A4A                          1876mmm 
00000A4A                 FALSE    1877mmm     IFNE DEBUG
00000A4A                          1878mmm     ENDC
00000A4A                          1879mmm 
00000A4A                          1880mmm     ENDM
00000A4A  60E4                    1881mm     BRA LOOP_98
00000A4C                          1882mm EXIT_98
00000A4C                          1883mm     ENDM
00000A4C                          1884m     ENDM
00000A4C                          1885  
00000A4C  6000 FBAE               1886                  BRA WAIT_FOR_SRECORD                ; ignore any other type 
00000A50                          1887              ENDI
00000A50                          1888s _0000000A
00000A50                          1889          ENDI
00000A50                          1890s _00000008
00000A50                          1891      ENDI
00000A50                          1892s _00000004
00000A50                          1893  
00000A50                          1894m     DOWNLOAD_BYTE D4,D5,D6,D7,D2,A4
00000A50  1E3C 0002               1895m     MOVE.B #2,D7
00000A54                          1896m     WHILE.B D7 <GT> 0 DO
00000A54                          1897ms _10000012
00000A54  BE38 0000               1898ms     CMP.B   0,D7
00000A58  6F00 0050               1899ms     BLE _10000013
00000A5C  E98C                    1900m         LSL.L #4,D4                                 ; IT's OK to do this first, because we are either starting from 0, 
00000A5E                          1901mm         DOWNLOAD D5                                 ; OR WE ARE READING THE NEXT BYTE ALONG, SO NEED TO SHIFT UP THE PREVIOUS ONE
00000A5E                          1902mm WAIT_FOR_READY_101                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000A5E                          1903mm 
00000A5E  1A39 00C00003           1904mm     MOVE.B DUART_SRA,D5                             ; CHECK FOR COMMAND
00000A64  0805 0000               1905mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
00000A68  6700 0010               1906mm     BEQ CONTINUE_101                                    ; NOTHING, CONTINUE
00000A6C                          1907mm 
00000A6C                          1908mmm     READ_CHAR D5                                    ; WE're not going to do anything with it, just check for escape
00000A6C                 TRUE     1909mmm     IFEQ DEBUG
00000A6C  1A39 00C00007           1910mmm         MOVE.B DUART_RXA,D5                         ; GOT A CHARACTER, READ IT
00000A72                          1911mmm     ENDC
00000A72                 FALSE    1912mmm     IFNE DEBUG
00000A72                          1913mmm     ENDC
00000A72                          1914mmm 
00000A72  BA3C 001B               1915mmm     CMP.B #$1B,D5                                   ; CHECK FOR ESCAPE AND GO TO START
00000A76  6700 F68C               1916mmm     BEQ START
00000A7A                          1917mmm     ENDM
00000A7A                          1918mm CONTINUE_101
00000A7A  1A39 00C00013           1919mm     MOVE.B DUART_SRB,D5                             ; READ DOWNLOAD STATUS REGISTER
00000A80  0805 0000               1920mm     BTST #0,D5                                      ; CHECK FOR CHARACTER
00000A84  67D8                    1921mm     BEQ WAIT_FOR_READY_101                          ; NOTHING, CHECK AGAIN
00000A86                          1922mm     
00000A86  1A39 00C00017           1923mm     MOVE.B DUART_RXB,D5                             ; GOT A CHARACTER, READ IT
00000A8C  13C5 00E00001           1924mm     MOVE.B D5,DISPLAY                               ; ECHO TO THE DISPLAY
00000A92                          1925mm 
00000A92                          1926mm     ENDM
00000A92                          1927m         ;PRINT_CHAR D5,D6
00000A92                          1928mm         HEX2BIN D5,D5,A4
00000A92  49FA 1D06               1929mm     LEA HEX2BIN_LUT(PC),A4                          ; LOAD THE LOOKUP TABLE
00000A96  0405 0030               1930mm     SUB.B #'0',D5                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
00000A9A  CABC 000000FF           1931mm     AND.L #$FF,D5                                   ; IGNORE THE TOP 3 BYTES
00000AA0  1A34 5000               1932mm     MOVE.B 0(A4,D5),D5                              ; USE THAT AS AN INDEX INTO THE LUT   
00000AA4                          1933mm     ENDM
00000AA4  8805                    1934m         OR.B D5,D4
00000AA6  5307                    1935m         SUB.B #1,D7
00000AA8                          1936m     ENDW
00000AA8  60AA                    1937ms     BRA _10000012
00000AAA                          1938ms _10000013
00000AAA                          1939m 
00000AAA  7A00                    1940m     MOVE.L #0,D5                                    ; REXTRACT LATEST BYTE OF ADDRESS AND ADD INTO CHECKSUM
00000AAC  1A04                    1941m     MOVE.B D4,D5
00000AAE  D484                    1942m     ADD.L D4,D2
00000AB0                          1943m 
00000AB0                          1944m     ENDM
00000AB0                          1945  
00000AB0                          1946      IF.B D2 <NE> #$FF THEN.L
00000AB0  B43C 00FF               1947s     CMP.B   #$FF,D2
00000AB4  6700 00B0               1948s     BEQ.L   _0000000B
00000AB8                          1949m         PRINT_CRLF D5,A4
00000AB8  49FA 1D0B               1950m     LEA CRLF(PC),A4
00000ABC                          1951mm     PRINT_STR A4,D5
00000ABC                          1952mm LOOP_105
00000ABC  0C14 0000               1953mm     CMP.B #NULL,(A4)                                ; 0 -> DONE
00000AC0  6700 0016               1954mm     BEQ EXIT_105
00000AC4                          1955mmm     PRINT_CHAR (A4)+,D5
00000AC4                          1956mmm WAIT_FOR_READY_106                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000AC4                 TRUE     1957mmm     IFEQ DEBUG
00000AC4  1A39 00C00003           1958mmm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000ACA  0805 0002               1959mmm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000ACE  67F4                    1960mmm         BEQ WAIT_FOR_READY_106                      ; NO SPACE, CHECK AGAIN
00000AD0  13DC 00C00007           1961mmm         MOVE.B (A4)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000AD6                          1962mmm     ENDC
00000AD6                          1963mmm 
00000AD6                 FALSE    1964mmm     IFNE DEBUG
00000AD6                          1965mmm     ENDC
00000AD6                          1966mmm 
00000AD6                          1967mmm     ENDM
00000AD6  60E4                    1968mm     BRA LOOP_105
00000AD8                          1969mm EXIT_105
00000AD8                          1970mm     ENDM
00000AD8                          1971m     ENDM
00000AD8  49FA 1C8E               1972          LEA CS_FAILURE(PC),A4                       ; warn for mismatched checksum
00000ADC                          1973m         PRINT_STR A4,D5
00000ADC                          1974m LOOP_107
00000ADC  0C14 0000               1975m     CMP.B #NULL,(A4)                                ; 0 -> DONE
00000AE0  6700 0016               1976m     BEQ EXIT_107
00000AE4                          1977mm     PRINT_CHAR (A4)+,D5
00000AE4                          1978mm WAIT_FOR_READY_108                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000AE4                 TRUE     1979mm     IFEQ DEBUG
00000AE4  1A39 00C00003           1980mm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000AEA  0805 0002               1981mm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000AEE  67F4                    1982mm         BEQ WAIT_FOR_READY_108                      ; NO SPACE, CHECK AGAIN
00000AF0  13DC 00C00007           1983mm         MOVE.B (A4)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000AF6                          1984mm     ENDC
00000AF6                          1985mm 
00000AF6                 FALSE    1986mm     IFNE DEBUG
00000AF6                          1987mm     ENDC
00000AF6                          1988mm 
00000AF6                          1989mm     ENDM
00000AF6  60E4                    1990m     BRA LOOP_107
00000AF8                          1991m EXIT_107
00000AF8                          1992m     ENDM
00000AF8                          1993m         PRINT_REG D0,D5,D3,D6,A4
00000AF8  49FA 1CD1               1994m     LEA OX(PC),A4
00000AFC                          1995mm     PRINT_STR A4,D5
00000AFC                          1996mm LOOP_110
00000AFC  0C14 0000               1997mm     CMP.B #NULL,(A4)                                ; 0 -> DONE
00000B00  6700 0016               1998mm     BEQ EXIT_110
00000B04                          1999mmm     PRINT_CHAR (A4)+,D5
00000B04                          2000mmm WAIT_FOR_READY_111                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000B04                 TRUE     2001mmm     IFEQ DEBUG
00000B04  1A39 00C00003           2002mmm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000B0A  0805 0002               2003mmm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000B0E  67F4                    2004mmm         BEQ WAIT_FOR_READY_111                      ; NO SPACE, CHECK AGAIN
00000B10  13DC 00C00007           2005mmm         MOVE.B (A4)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000B16                          2006mmm     ENDC
00000B16                          2007mmm 
00000B16                 FALSE    2008mmm     IFNE DEBUG
00000B16                          2009mmm     ENDC
00000B16                          2010mmm 
00000B16                          2011mmm     ENDM
00000B16  60E4                    2012mm     BRA LOOP_110
00000B18                          2013mm EXIT_110
00000B18                          2014mm     ENDM
00000B18  7C07                    2015m     MOVE.L #7,D6                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00000B1A                          2016m LOOP_109
00000B1A                          2017mm     BIN2HEX D0,D3,A4
00000B1A  49FA 1C6E               2018mm     LEA BIN2HEX_LUT(PC),A4                          ; LOAD THE LOOKUP TABLE
00000B1E  E998                    2019mm     ROL.L #4,D0                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00000B20  1600                    2020mm     MOVE.B D0,D3
00000B22  0283 0000000F           2021mm     ANDI.L #$F,D3
00000B28  1634 3000               2022mm     MOVE.B 0(A4,D3),D3                              ; USE THAT AS AN INDEX INTO THE LUT
00000B2C                          2023mm     ENDM
00000B2C                          2024mm     PRINT_CHAR D3,D5
00000B2C                          2025mm WAIT_FOR_READY_113                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000B2C                 TRUE     2026mm     IFEQ DEBUG
00000B2C  1A39 00C00003           2027mm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000B32  0805 0002               2028mm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000B36  67F4                    2029mm         BEQ WAIT_FOR_READY_113                      ; NO SPACE, CHECK AGAIN
00000B38  13C3 00C00007           2030mm         MOVE.B D3,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000B3E                          2031mm     ENDC
00000B3E                          2032mm 
00000B3E                 FALSE    2033mm     IFNE DEBUG
00000B3E                          2034mm     ENDC
00000B3E                          2035mm 
00000B3E                          2036mm     ENDM
00000B3E  57CE FFDA               2037m     DBEQ D6,LOOP_109
00000B42                          2038m     ENDM
00000B42                          2039m         PRINT_CRLF D5,A4
00000B42  49FA 1C81               2040m     LEA CRLF(PC),A4
00000B46                          2041mm     PRINT_STR A4,D5
00000B46                          2042mm LOOP_115
00000B46  0C14 0000               2043mm     CMP.B #NULL,(A4)                                ; 0 -> DONE
00000B4A  6700 0016               2044mm     BEQ EXIT_115
00000B4E                          2045mmm     PRINT_CHAR (A4)+,D5
00000B4E                          2046mmm WAIT_FOR_READY_116                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000B4E                 TRUE     2047mmm     IFEQ DEBUG
00000B4E  1A39 00C00003           2048mmm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000B54  0805 0002               2049mmm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000B58  67F4                    2050mmm         BEQ WAIT_FOR_READY_116                      ; NO SPACE, CHECK AGAIN
00000B5A  13DC 00C00007           2051mmm         MOVE.B (A4)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000B60                          2052mmm     ENDC
00000B60                          2053mmm 
00000B60                 FALSE    2054mmm     IFNE DEBUG
00000B60                          2055mmm     ENDC
00000B60                          2056mmm 
00000B60                          2057mmm     ENDM
00000B60  60E4                    2058mm     BRA LOOP_115
00000B62                          2059mm EXIT_115
00000B62                          2060mm     ENDM
00000B62                          2061m     ENDM
00000B62                          2062          
00000B62  6000 F7E0               2063          BRA MAIN_LOOP
00000B66                          2064      ENDI
00000B66                          2065s _0000000B
00000B66                          2066  
00000B66                          2067      IF D1 <EQ> #0 THEN
00000B66  B27C 0000               2068s     CMP.W   #0,D1
00000B6A  6600 0006               2069s     BNE _0000000C
00000B6E  6000 FA8C               2070        BRA WAIT_FOR_SRECORD
00000B72                          2071      ENDI
00000B72                          2072s _0000000C
00000B72                          2073  DOWNLOAD_DONE
00000B72                          2074m     PRINT_CRLF D5,A4
00000B72  49FA 1C51               2075m     LEA CRLF(PC),A4
00000B76                          2076mm     PRINT_STR A4,D5
00000B76                          2077mm LOOP_118
00000B76  0C14 0000               2078mm     CMP.B #NULL,(A4)                                ; 0 -> DONE
00000B7A  6700 0016               2079mm     BEQ EXIT_118
00000B7E                          2080mmm     PRINT_CHAR (A4)+,D5
00000B7E                          2081mmm WAIT_FOR_READY_119                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000B7E                 TRUE     2082mmm     IFEQ DEBUG
00000B7E  1A39 00C00003           2083mmm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000B84  0805 0002               2084mmm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000B88  67F4                    2085mmm         BEQ WAIT_FOR_READY_119                      ; NO SPACE, CHECK AGAIN
00000B8A  13DC 00C00007           2086mmm         MOVE.B (A4)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000B90                          2087mmm     ENDC
00000B90                          2088mmm 
00000B90                 FALSE    2089mmm     IFNE DEBUG
00000B90                          2090mmm     ENDC
00000B90                          2091mmm 
00000B90                          2092mmm     ENDM
00000B90  60E4                    2093mm     BRA LOOP_118
00000B92                          2094mm EXIT_118
00000B92                          2095mm     ENDM
00000B92                          2096m     ENDM
00000B92                          2097m     PRINT_REG D0,D5,D6,D2,A1                        ; print out number of Srecords read
00000B92  43FA 1C37               2098m     LEA OX(PC),A1
00000B96                          2099mm     PRINT_STR A1,D5
00000B96                          2100mm LOOP_121
00000B96  0C11 0000               2101mm     CMP.B #NULL,(A1)                                ; 0 -> DONE
00000B9A  6700 0016               2102mm     BEQ EXIT_121
00000B9E                          2103mmm     PRINT_CHAR (A1)+,D5
00000B9E                          2104mmm WAIT_FOR_READY_122                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000B9E                 TRUE     2105mmm     IFEQ DEBUG
00000B9E  1A39 00C00003           2106mmm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000BA4  0805 0002               2107mmm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000BA8  67F4                    2108mmm         BEQ WAIT_FOR_READY_122                      ; NO SPACE, CHECK AGAIN
00000BAA  13D9 00C00007           2109mmm         MOVE.B (A1)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000BB0                          2110mmm     ENDC
00000BB0                          2111mmm 
00000BB0                 FALSE    2112mmm     IFNE DEBUG
00000BB0                          2113mmm     ENDC
00000BB0                          2114mmm 
00000BB0                          2115mmm     ENDM
00000BB0  60E4                    2116mm     BRA LOOP_121
00000BB2                          2117mm EXIT_121
00000BB2                          2118mm     ENDM
00000BB2  7407                    2119m     MOVE.L #7,D2                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00000BB4                          2120m LOOP_120
00000BB4                          2121mm     BIN2HEX D0,D6,A1
00000BB4  43FA 1BD4               2122mm     LEA BIN2HEX_LUT(PC),A1                          ; LOAD THE LOOKUP TABLE
00000BB8  E998                    2123mm     ROL.L #4,D0                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00000BBA  1C00                    2124mm     MOVE.B D0,D6
00000BBC  0286 0000000F           2125mm     ANDI.L #$F,D6
00000BC2  1C31 6000               2126mm     MOVE.B 0(A1,D6),D6                              ; USE THAT AS AN INDEX INTO THE LUT
00000BC6                          2127mm     ENDM
00000BC6                          2128mm     PRINT_CHAR D6,D5
00000BC6                          2129mm WAIT_FOR_READY_124                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000BC6                 TRUE     2130mm     IFEQ DEBUG
00000BC6  1A39 00C00003           2131mm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000BCC  0805 0002               2132mm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000BD0  67F4                    2133mm         BEQ WAIT_FOR_READY_124                      ; NO SPACE, CHECK AGAIN
00000BD2  13C6 00C00007           2134mm         MOVE.B D6,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000BD8                          2135mm     ENDC
00000BD8                          2136mm 
00000BD8                 FALSE    2137mm     IFNE DEBUG
00000BD8                          2138mm     ENDC
00000BD8                          2139mm 
00000BD8                          2140mm     ENDM
00000BD8  57CA FFDA               2141m     DBEQ D2,LOOP_120
00000BDC                          2142m     ENDM
00000BDC  43FA 1B51               2143      LEA READ(PC),A1
00000BE0                          2144m     PRINT_STR A1,D5
00000BE0                          2145m LOOP_125
00000BE0  0C11 0000               2146m     CMP.B #NULL,(A1)                                ; 0 -> DONE
00000BE4  6700 0016               2147m     BEQ EXIT_125
00000BE8                          2148mm     PRINT_CHAR (A1)+,D5
00000BE8                          2149mm WAIT_FOR_READY_126                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000BE8                 TRUE     2150mm     IFEQ DEBUG
00000BE8  1A39 00C00003           2151mm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000BEE  0805 0002               2152mm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000BF2  67F4                    2153mm         BEQ WAIT_FOR_READY_126                      ; NO SPACE, CHECK AGAIN
00000BF4  13D9 00C00007           2154mm         MOVE.B (A1)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000BFA                          2155mm     ENDC
00000BFA                          2156mm 
00000BFA                 FALSE    2157mm     IFNE DEBUG
00000BFA                          2158mm     ENDC
00000BFA                          2159mm 
00000BFA                          2160mm     ENDM
00000BFA  60E4                    2161m     BRA LOOP_125
00000BFC                          2162m EXIT_125
00000BFC                          2163m     ENDM
00000BFC  2E08                    2164      MOVE.L A0,D7                                    ; set address accumulator to start address
00000BFE                          2165m     PRINT_REG D7,D5,D6,D2,A1                        ; print out start address
00000BFE  43FA 1BCB               2166m     LEA OX(PC),A1
00000C02                          2167mm     PRINT_STR A1,D5
00000C02                          2168mm LOOP_128
00000C02  0C11 0000               2169mm     CMP.B #NULL,(A1)                                ; 0 -> DONE
00000C06  6700 0016               2170mm     BEQ EXIT_128
00000C0A                          2171mmm     PRINT_CHAR (A1)+,D5
00000C0A                          2172mmm WAIT_FOR_READY_129                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000C0A                 TRUE     2173mmm     IFEQ DEBUG
00000C0A  1A39 00C00003           2174mmm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000C10  0805 0002               2175mmm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000C14  67F4                    2176mmm         BEQ WAIT_FOR_READY_129                      ; NO SPACE, CHECK AGAIN
00000C16  13D9 00C00007           2177mmm         MOVE.B (A1)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000C1C                          2178mmm     ENDC
00000C1C                          2179mmm 
00000C1C                 FALSE    2180mmm     IFNE DEBUG
00000C1C                          2181mmm     ENDC
00000C1C                          2182mmm 
00000C1C                          2183mmm     ENDM
00000C1C  60E4                    2184mm     BRA LOOP_128
00000C1E                          2185mm EXIT_128
00000C1E                          2186mm     ENDM
00000C1E  7407                    2187m     MOVE.L #7,D2                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00000C20                          2188m LOOP_127
00000C20                          2189mm     BIN2HEX D7,D6,A1
00000C20  43FA 1B68               2190mm     LEA BIN2HEX_LUT(PC),A1                          ; LOAD THE LOOKUP TABLE
00000C24  E99F                    2191mm     ROL.L #4,D7                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00000C26  1C07                    2192mm     MOVE.B D7,D6
00000C28  0286 0000000F           2193mm     ANDI.L #$F,D6
00000C2E  1C31 6000               2194mm     MOVE.B 0(A1,D6),D6                              ; USE THAT AS AN INDEX INTO THE LUT
00000C32                          2195mm     ENDM
00000C32                          2196mm     PRINT_CHAR D6,D5
00000C32                          2197mm WAIT_FOR_READY_131                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000C32                 TRUE     2198mm     IFEQ DEBUG
00000C32  1A39 00C00003           2199mm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000C38  0805 0002               2200mm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000C3C  67F4                    2201mm         BEQ WAIT_FOR_READY_131                      ; NO SPACE, CHECK AGAIN
00000C3E  13C6 00C00007           2202mm         MOVE.B D6,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000C44                          2203mm     ENDC
00000C44                          2204mm 
00000C44                 FALSE    2205mm     IFNE DEBUG
00000C44                          2206mm     ENDC
00000C44                          2207mm 
00000C44                          2208mm     ENDM
00000C44  57CA FFDA               2209m     DBEQ D2,LOOP_127
00000C48                          2210m     ENDM
00000C48                          2211m     PRINT_CRLF D5,A4
00000C48  49FA 1B7B               2212m     LEA CRLF(PC),A4
00000C4C                          2213mm     PRINT_STR A4,D5
00000C4C                          2214mm LOOP_133
00000C4C  0C14 0000               2215mm     CMP.B #NULL,(A4)                                ; 0 -> DONE
00000C50  6700 0016               2216mm     BEQ EXIT_133
00000C54                          2217mmm     PRINT_CHAR (A4)+,D5
00000C54                          2218mmm WAIT_FOR_READY_134                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000C54                 TRUE     2219mmm     IFEQ DEBUG
00000C54  1A39 00C00003           2220mmm         MOVE.B DUART_SRA,D5                         ; READ STATUS REGISTER
00000C5A  0805 0002               2221mmm         BTST #2,D5                                  ; CHECK FOR SPACE TO SEND
00000C5E  67F4                    2222mmm         BEQ WAIT_FOR_READY_134                      ; NO SPACE, CHECK AGAIN
00000C60  13DC 00C00007           2223mmm         MOVE.B (A4)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000C66                          2224mmm     ENDC
00000C66                          2225mmm 
00000C66                 FALSE    2226mmm     IFNE DEBUG
00000C66                          2227mmm     ENDC
00000C66                          2228mmm 
00000C66                          2229mmm     ENDM
00000C66  60E4                    2230mm     BRA LOOP_133
00000C68                          2231mm EXIT_133
00000C68                          2232mm     ENDM
00000C68                          2233m     ENDM
00000C68                          2234  
00000C68  6000 F6DA               2235      BRA MAIN_LOOP
00000C6C                          2236  
00000C6C                          2237  G
00000C6C  2047                    2238      MOVE.L D7,A0                                    ; grab the address accumulator and then clear it
00000C6E  7E00                    2239      MOVE.L #0,D7
00000C70                          2240  
00000C70  4ED0                    2241      JMP (A0)
00000C72                          2242          
00000C72                          2243  Z
00000C72  207C 00200000           2244      MOVE.L #RAM,A0                                  ; address of RAM
00000C78  D1FC 00100000           2245      ADD.L #$100000,A0
00000C7E                          2246  
00000C7E                          2247      FOR.L D0 = #0 TO #$FFFFC BY #4 DO               ; write
00000C7E  7000                    2248s     MOVE.L  #0,D0
00000C80  6000 0012               2249s     BRA _20000007
00000C84                          2250s _20000006
00000C84  2200                    2251          MOVE.L D0,D1                                ; progress update
00000C86  E089                    2252          LSR.L #8,D1 
00000C88  E089                    2253          LSR.L #8,D1
00000C8A  13C1 00E00001           2254          MOVE.B D1,DISPLAY
00000C90                          2255          
00000C90  2108                    2256          MOVE.L A0,-(A0)
00000C92                          2257      ENDF
00000C92  5880                    2258s     ADD.L   #4,D0
00000C94                          2259s _20000007
00000C94  B0BC 000FFFFC           2260s     CMP.L   #$FFFFC,D0
00000C9A  6FE8                    2261s     BLE _20000006
00000C9C                          2262  
00000C9C  207C 00200000           2263      MOVE.L #RAM,A0                                  ; address of RAM
00000CA2  D1FC 00100000           2264      ADD.L #$100000,A0
00000CA8                          2265  
00000CA8                          2266      FOR.L D0 = #0 TO #$FFFFC BY #4 DO               ; read back and check 
00000CA8  7000                    2267s     MOVE.L  #0,D0
00000CAA  6000 00A8               2268s     BRA _20000009
00000CAE                          2269s _20000008
00000CAE  2200                    2270          MOVE.L D0,D1                                ; progress update
00000CB0  E089                    2271          LSR.L #8,D1
00000CB2  E089                    2272          LSR.L #8,D1
00000CB4  13C1 00E00001           2273          MOVE.B D1,DISPLAY
00000CBA                          2274  
00000CBA  2408                    2275          MOVE.L A0,D2
00000CBC  2220                    2276          MOVE.L -(A0),D1
00000CBE                          2277  
00000CBE                          2278          IF.L D2 <NE> D1 THEN
00000CBE  B481                    2279s     CMP.L   D1,D2
00000CC0  6700 0090               2280s     BEQ _0000000D
00000CC4  43FA 1AB3               2281              LEA RAM_ERROR(PC),A1
00000CC8                          2282m             PRINT_STR A1,D1
00000CC8                          2283m LOOP_135
00000CC8  0C11 0000               2284m     CMP.B #NULL,(A1)                                ; 0 -> DONE
00000CCC  6700 0016               2285m     BEQ EXIT_135
00000CD0                          2286mm     PRINT_CHAR (A1)+,D1
00000CD0                          2287mm WAIT_FOR_READY_136                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000CD0                 TRUE     2288mm     IFEQ DEBUG
00000CD0  1239 00C00003           2289mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00000CD6  0801 0002               2290mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00000CDA  67F4                    2291mm         BEQ WAIT_FOR_READY_136                      ; NO SPACE, CHECK AGAIN
00000CDC  13D9 00C00007           2292mm         MOVE.B (A1)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000CE2                          2293mm     ENDC
00000CE2                          2294mm 
00000CE2                 FALSE    2295mm     IFNE DEBUG
00000CE2                          2296mm     ENDC
00000CE2                          2297mm 
00000CE2                          2298mm     ENDM
00000CE2  60E4                    2299m     BRA LOOP_135
00000CE4                          2300m EXIT_135
00000CE4                          2301m     ENDM
00000CE4  2208                    2302              MOVE.L A0,D1
00000CE6  5981                    2303              SUB.L #4,D1
00000CE8                          2304m             PRINT_REG D1,D3,D2,D6,A1                ; print out failure address
00000CE8  43FA 1AE1               2305m     LEA OX(PC),A1
00000CEC                          2306mm     PRINT_STR A1,D3
00000CEC                          2307mm LOOP_138
00000CEC  0C11 0000               2308mm     CMP.B #NULL,(A1)                                ; 0 -> DONE
00000CF0  6700 0016               2309mm     BEQ EXIT_138
00000CF4                          2310mmm     PRINT_CHAR (A1)+,D3
00000CF4                          2311mmm WAIT_FOR_READY_139                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000CF4                 TRUE     2312mmm     IFEQ DEBUG
00000CF4  1639 00C00003           2313mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000CFA  0803 0002               2314mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000CFE  67F4                    2315mmm         BEQ WAIT_FOR_READY_139                      ; NO SPACE, CHECK AGAIN
00000D00  13D9 00C00007           2316mmm         MOVE.B (A1)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000D06                          2317mmm     ENDC
00000D06                          2318mmm 
00000D06                 FALSE    2319mmm     IFNE DEBUG
00000D06                          2320mmm     ENDC
00000D06                          2321mmm 
00000D06                          2322mmm     ENDM
00000D06  60E4                    2323mm     BRA LOOP_138
00000D08                          2324mm EXIT_138
00000D08                          2325mm     ENDM
00000D08  7C07                    2326m     MOVE.L #7,D6                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00000D0A                          2327m LOOP_137
00000D0A                          2328mm     BIN2HEX D1,D2,A1
00000D0A  43FA 1A7E               2329mm     LEA BIN2HEX_LUT(PC),A1                          ; LOAD THE LOOKUP TABLE
00000D0E  E999                    2330mm     ROL.L #4,D1                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00000D10  1401                    2331mm     MOVE.B D1,D2
00000D12  0282 0000000F           2332mm     ANDI.L #$F,D2
00000D18  1431 2000               2333mm     MOVE.B 0(A1,D2),D2                              ; USE THAT AS AN INDEX INTO THE LUT
00000D1C                          2334mm     ENDM
00000D1C                          2335mm     PRINT_CHAR D2,D3
00000D1C                          2336mm WAIT_FOR_READY_141                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000D1C                 TRUE     2337mm     IFEQ DEBUG
00000D1C  1639 00C00003           2338mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000D22  0803 0002               2339mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000D26  67F4                    2340mm         BEQ WAIT_FOR_READY_141                      ; NO SPACE, CHECK AGAIN
00000D28  13C2 00C00007           2341mm         MOVE.B D2,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000D2E                          2342mm     ENDC
00000D2E                          2343mm 
00000D2E                 FALSE    2344mm     IFNE DEBUG
00000D2E                          2345mm     ENDC
00000D2E                          2346mm 
00000D2E                          2347mm     ENDM
00000D2E  57CE FFDA               2348m     DBEQ D6,LOOP_137
00000D32                          2349m     ENDM
00000D32                          2350m             PRINT_CRLF D3,A1
00000D32  43FA 1A91               2351m     LEA CRLF(PC),A1
00000D36                          2352mm     PRINT_STR A1,D3
00000D36                          2353mm LOOP_143
00000D36  0C11 0000               2354mm     CMP.B #NULL,(A1)                                ; 0 -> DONE
00000D3A  6700 0016               2355mm     BEQ EXIT_143
00000D3E                          2356mmm     PRINT_CHAR (A1)+,D3
00000D3E                          2357mmm WAIT_FOR_READY_144                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000D3E                 TRUE     2358mmm     IFEQ DEBUG
00000D3E  1639 00C00003           2359mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000D44  0803 0002               2360mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000D48  67F4                    2361mmm         BEQ WAIT_FOR_READY_144                      ; NO SPACE, CHECK AGAIN
00000D4A  13D9 00C00007           2362mmm         MOVE.B (A1)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000D50                          2363mmm     ENDC
00000D50                          2364mmm 
00000D50                 FALSE    2365mmm     IFNE DEBUG
00000D50                          2366mmm     ENDC
00000D50                          2367mmm 
00000D50                          2368mmm     ENDM
00000D50  60E4                    2369mm     BRA LOOP_143
00000D52                          2370mm EXIT_143
00000D52                          2371mm     ENDM
00000D52                          2372m     ENDM
00000D52                          2373          ENDI 
00000D52                          2374s _0000000D
00000D52                          2375      ENDF
00000D52  5880                    2376s     ADD.L   #4,D0
00000D54                          2377s _20000009
00000D54  B0BC 000FFFFC           2378s     CMP.L   #$FFFFC,D0
00000D5A  6F00 FF52               2379s     BLE _20000008
00000D5E                          2380  
00000D5E  6000 F5E4               2381      BRA MAIN_LOOP
00000D62                          2382  
00000D62                          2383  L
00000D62  7000                    2384      MOVE.L #0,D0                                    ; D0 will be the length to write               
00000D64  7200                    2385      MOVE.L #0,D1                                    ; D1 will be the address to write 
00000D66                          2386  
00000D66                          2387      FOR D2 = #0 TO #7 DO                            ; read 4 bytes, we'll split into 2 byte address (MS) and 2 byte length (LS)
00000D66  343C 0000               2388s     MOVE.W  #0,D2
00000D6A  6000 0046               2389s     BRA _2000000B
00000D6E                          2390s _2000000A
00000D6E  E989                    2391          LSL.L #4,D1                                 ; make what we have so far more significant
00000D70                          2392m         WAIT_CHAR D3,D4                             ; next character -> D2
00000D70                          2393m WAIT_FOR_READY_145                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000D70                 TRUE     2394m     IFEQ DEBUG
00000D70  1839 00C00003           2395m         MOVE.B DUART_SRA,D4                         ; READ STATUS REGISTER
00000D76  0804 0000               2396m         BTST #0,D4                                  ; CHECK FOR CHARACTER
00000D7A  67F4                    2397m         BEQ WAIT_FOR_READY_145                      ; NOTHING, CHECK AGAIN
00000D7C                          2398m     ENDC
00000D7C                          2399m 
00000D7C                          2400mm     READ_CHAR D3
00000D7C                 TRUE     2401mm     IFEQ DEBUG
00000D7C  1639 00C00007           2402mm         MOVE.B DUART_RXA,D3                         ; GOT A CHARACTER, READ IT
00000D82                          2403mm     ENDC
00000D82                 FALSE    2404mm     IFNE DEBUG
00000D82                          2405mm     ENDC
00000D82                          2406mm 
00000D82  B63C 001B               2407mm     CMP.B #$1B,D3                                   ; CHECK FOR ESCAPE AND GO TO START
00000D86  6700 F37C               2408mm     BEQ START
00000D8A                          2409mm     ENDM
00000D8A                          2410m 
00000D8A                 TRUE     2411m     IFEQ DEBUG
00000D8A                          2412mm         PRINT_CHAR D3,D4                            ; ECHO IT BACK
00000D8A                          2413mm WAIT_FOR_READY_147                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000D8A                 TRUE     2414mm     IFEQ DEBUG
00000D8A  1839 00C00003           2415mm         MOVE.B DUART_SRA,D4                         ; READ STATUS REGISTER
00000D90  0804 0002               2416mm         BTST #2,D4                                  ; CHECK FOR SPACE TO SEND
00000D94  67F4                    2417mm         BEQ WAIT_FOR_READY_147                      ; NO SPACE, CHECK AGAIN
00000D96  13C3 00C00007           2418mm         MOVE.B D3,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000D9C                          2419mm     ENDC
00000D9C                          2420mm 
00000D9C                 FALSE    2421mm     IFNE DEBUG
00000D9C                          2422mm     ENDC
00000D9C                          2423mm 
00000D9C                          2424mm     ENDM
00000D9C                          2425m     ENDC
00000D9C                          2426m     ENDM
00000D9C                          2427m         HEX2BIN D3,D3,A0                            ; convert to binary -> D2
00000D9C  41FA 19FC               2428m     LEA HEX2BIN_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
00000DA0  0403 0030               2429m     SUB.B #'0',D3                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
00000DA4  C6BC 000000FF           2430m     AND.L #$FF,D3                                   ; IGNORE THE TOP 3 BYTES
00000DAA  1630 3000               2431m     MOVE.B 0(A0,D3),D3                              ; USE THAT AS AN INDEX INTO THE LUT   
00000DAE                          2432m     ENDM
00000DAE  8203                    2433          OR.B D3,D1
00000DB0                          2434      ENDF
00000DB0  5242                    2435s     ADD.W   #1,D2
00000DB2                          2436s _2000000B
00000DB2  B47C 0007               2437s     CMP.W   #7,D2
00000DB6  6FB6                    2438s     BLE _2000000A
00000DB8                          2439  
00000DB8  3001                    2440      MOVE.W D1,D0                                    ; extract the LSword for the length 
00000DBA  0480 00000104           2441      SUB.L #START,D0                                 ; remove the vector table from the length
00000DC0  E089                    2442      LSR.L #8,D1                                     ; extract the MSword for the address
00000DC2  E089                    2443      LSR.L #8,D1
00000DC4                          2444  
00000DC4                          2445m     PRINT_CRLF D2,A1
00000DC4  43FA 19FF               2446m     LEA CRLF(PC),A1
00000DC8                          2447mm     PRINT_STR A1,D2
00000DC8                          2448mm LOOP_150
00000DC8  0C11 0000               2449mm     CMP.B #NULL,(A1)                                ; 0 -> DONE
00000DCC  6700 0016               2450mm     BEQ EXIT_150
00000DD0                          2451mmm     PRINT_CHAR (A1)+,D2
00000DD0                          2452mmm WAIT_FOR_READY_151                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000DD0                 TRUE     2453mmm     IFEQ DEBUG
00000DD0  1439 00C00003           2454mmm         MOVE.B DUART_SRA,D2                         ; READ STATUS REGISTER
00000DD6  0802 0002               2455mmm         BTST #2,D2                                  ; CHECK FOR SPACE TO SEND
00000DDA  67F4                    2456mmm         BEQ WAIT_FOR_READY_151                      ; NO SPACE, CHECK AGAIN
00000DDC  13D9 00C00007           2457mmm         MOVE.B (A1)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000DE2                          2458mmm     ENDC
00000DE2                          2459mmm 
00000DE2                 FALSE    2460mmm     IFNE DEBUG
00000DE2                          2461mmm     ENDC
00000DE2                          2462mmm 
00000DE2                          2463mmm     ENDM
00000DE2  60E4                    2464mm     BRA LOOP_150
00000DE4                          2465mm EXIT_150
00000DE4                          2466mm     ENDM
00000DE4                          2467m     ENDM
00000DE4                          2468  
00000DE4  2041                    2469      MOVE.L D1,A0                                    ; target address
00000DE6  2641                    2470      MOVE.L D1,A3                                    ; keep a copy for later
00000DE8                          2471  
00000DE8  2247                    2472      MOVE.L D7,A1                                    ; address accumulator -> address register
00000DEA  D3FC 00000104           2473      ADD.L #START,A1                                 ; skip the vectors
00000DF0  2847                    2474      MOVE.L D7,A4                                    ; keep a clean copy for later
00000DF2  7E00                    2475      MOVE.L #0,D7                                    ; clear the now used address accumulator
00000DF4                          2476  
00000DF4                          2477m     UNPROTECT                                       ; important to only unprotect when we are fully committed (ie, can't escape)
00000DF4  31FC AAAA 2AAA          2478m     MOVE.W #$AAAA,$2AAA                             ; REMOVE WRITE PROTECT
00000DFA  4E71                    2479m     NOP
00000DFC  31FC 5555 1554          2480m     MOVE.W #$5555,$1554
00000E02  4E71                    2481m     NOP
00000E04  31FC 8080 2AAA          2482m     MOVE.W #$8080,$2AAA
00000E0A  4E71                    2483m     NOP
00000E0C  31FC AAAA 2AAA          2484m     MOVE.W #$AAAA,$2AAA
00000E12  4E71                    2485m     NOP
00000E14  31FC 5555 1554          2486m     MOVE.W #$5555,$1554
00000E1A  4E71                    2487m     NOP
00000E1C  31FC 2020 2AAA          2488m     MOVE.W #$2020,$2AAA
00000E22                          2489m     ENDM
00000E22                          2490                      
00000E22                          2491      FOR D7 = #$0 TO #$FFFFFFFF DO                   ; dead timing loop to wait for unprotect
00000E22  3E3C 0000               2492s     MOVE.W  #$0,D7
00000E26  6000 0006               2493s     BRA _2000000D
00000E2A                          2494s _2000000C
00000E2A  4E71                    2495          NOP
00000E2C                          2496      ENDF
00000E2C  5247                    2497s     ADD.W   #1,D7
00000E2E                          2498s _2000000D
00000E2E  BE7C FFFF               2499s     CMP.W   #$FFFFFFFF,D7
00000E32  6FF6                    2500s     BLE _2000000C
00000E34                          2501                  
00000E34  45FA 197B               2502      LEA LOADING(PC),A2
00000E38                          2503m     PRINT_STR A2,D2
00000E38                          2504m LOOP_153
00000E38  0C12 0000               2505m     CMP.B #NULL,(A2)                                ; 0 -> DONE
00000E3C  6700 0016               2506m     BEQ EXIT_153
00000E40                          2507mm     PRINT_CHAR (A2)+,D2
00000E40                          2508mm WAIT_FOR_READY_154                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000E40                 TRUE     2509mm     IFEQ DEBUG
00000E40  1439 00C00003           2510mm         MOVE.B DUART_SRA,D2                         ; READ STATUS REGISTER
00000E46  0802 0002               2511mm         BTST #2,D2                                  ; CHECK FOR SPACE TO SEND
00000E4A  67F4                    2512mm         BEQ WAIT_FOR_READY_154                      ; NO SPACE, CHECK AGAIN
00000E4C  13DA 00C00007           2513mm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000E52                          2514mm     ENDC
00000E52                          2515mm 
00000E52                 FALSE    2516mm     IFNE DEBUG
00000E52                          2517mm     ENDC
00000E52                          2518mm 
00000E52                          2519mm     ENDM
00000E52  60E4                    2520m     BRA LOOP_153
00000E54                          2521m EXIT_153
00000E54                          2522m     ENDM
00000E54                          2523          
00000E54  2409                    2524      MOVE.L A1,D2
00000E56                          2525m     PRINT_REG D2,D3,D4,D5,A2
00000E56  45FA 1973               2526m     LEA OX(PC),A2
00000E5A                          2527mm     PRINT_STR A2,D3
00000E5A                          2528mm LOOP_156
00000E5A  0C12 0000               2529mm     CMP.B #NULL,(A2)                                ; 0 -> DONE
00000E5E  6700 0016               2530mm     BEQ EXIT_156
00000E62                          2531mmm     PRINT_CHAR (A2)+,D3
00000E62                          2532mmm WAIT_FOR_READY_157                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000E62                 TRUE     2533mmm     IFEQ DEBUG
00000E62  1639 00C00003           2534mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000E68  0803 0002               2535mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000E6C  67F4                    2536mmm         BEQ WAIT_FOR_READY_157                      ; NO SPACE, CHECK AGAIN
00000E6E  13DA 00C00007           2537mmm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000E74                          2538mmm     ENDC
00000E74                          2539mmm 
00000E74                 FALSE    2540mmm     IFNE DEBUG
00000E74                          2541mmm     ENDC
00000E74                          2542mmm 
00000E74                          2543mmm     ENDM
00000E74  60E4                    2544mm     BRA LOOP_156
00000E76                          2545mm EXIT_156
00000E76                          2546mm     ENDM
00000E76  7A07                    2547m     MOVE.L #7,D5                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00000E78                          2548m LOOP_155
00000E78                          2549mm     BIN2HEX D2,D4,A2
00000E78  45FA 1910               2550mm     LEA BIN2HEX_LUT(PC),A2                          ; LOAD THE LOOKUP TABLE
00000E7C  E99A                    2551mm     ROL.L #4,D2                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00000E7E  1802                    2552mm     MOVE.B D2,D4
00000E80  0284 0000000F           2553mm     ANDI.L #$F,D4
00000E86  1832 4000               2554mm     MOVE.B 0(A2,D4),D4                              ; USE THAT AS AN INDEX INTO THE LUT
00000E8A                          2555mm     ENDM
00000E8A                          2556mm     PRINT_CHAR D4,D3
00000E8A                          2557mm WAIT_FOR_READY_159                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000E8A                 TRUE     2558mm     IFEQ DEBUG
00000E8A  1639 00C00003           2559mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000E90  0803 0002               2560mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000E94  67F4                    2561mm         BEQ WAIT_FOR_READY_159                      ; NO SPACE, CHECK AGAIN
00000E96  13C4 00C00007           2562mm         MOVE.B D4,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000E9C                          2563mm     ENDC
00000E9C                          2564mm 
00000E9C                 FALSE    2565mm     IFNE DEBUG
00000E9C                          2566mm     ENDC
00000E9C                          2567mm 
00000E9C                          2568mm     ENDM
00000E9C  57CD FFDA               2569m     DBEQ D5,LOOP_155
00000EA0                          2570m     ENDM
00000EA0                          2571  
00000EA0  45FA 192C               2572      LEA TO(PC),A2
00000EA4                          2573m     PRINT_STR A2,D3
00000EA4                          2574m LOOP_160
00000EA4  0C12 0000               2575m     CMP.B #NULL,(A2)                                ; 0 -> DONE
00000EA8  6700 0016               2576m     BEQ EXIT_160
00000EAC                          2577mm     PRINT_CHAR (A2)+,D3
00000EAC                          2578mm WAIT_FOR_READY_161                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000EAC                 TRUE     2579mm     IFEQ DEBUG
00000EAC  1639 00C00003           2580mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000EB2  0803 0002               2581mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000EB6  67F4                    2582mm         BEQ WAIT_FOR_READY_161                      ; NO SPACE, CHECK AGAIN
00000EB8  13DA 00C00007           2583mm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000EBE                          2584mm     ENDC
00000EBE                          2585mm 
00000EBE                 FALSE    2586mm     IFNE DEBUG
00000EBE                          2587mm     ENDC
00000EBE                          2588mm 
00000EBE                          2589mm     ENDM
00000EBE  60E4                    2590m     BRA LOOP_160
00000EC0                          2591m EXIT_160
00000EC0                          2592m     ENDM
00000EC0                          2593  
00000EC0  2408                    2594      MOVE.L A0,D2
00000EC2                          2595m     PRINT_REG D2,D3,D4,D5,A2
00000EC2  45FA 1907               2596m     LEA OX(PC),A2
00000EC6                          2597mm     PRINT_STR A2,D3
00000EC6                          2598mm LOOP_163
00000EC6  0C12 0000               2599mm     CMP.B #NULL,(A2)                                ; 0 -> DONE
00000ECA  6700 0016               2600mm     BEQ EXIT_163
00000ECE                          2601mmm     PRINT_CHAR (A2)+,D3
00000ECE                          2602mmm WAIT_FOR_READY_164                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000ECE                 TRUE     2603mmm     IFEQ DEBUG
00000ECE  1639 00C00003           2604mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000ED4  0803 0002               2605mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000ED8  67F4                    2606mmm         BEQ WAIT_FOR_READY_164                      ; NO SPACE, CHECK AGAIN
00000EDA  13DA 00C00007           2607mmm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000EE0                          2608mmm     ENDC
00000EE0                          2609mmm 
00000EE0                 FALSE    2610mmm     IFNE DEBUG
00000EE0                          2611mmm     ENDC
00000EE0                          2612mmm 
00000EE0                          2613mmm     ENDM
00000EE0  60E4                    2614mm     BRA LOOP_163
00000EE2                          2615mm EXIT_163
00000EE2                          2616mm     ENDM
00000EE2  7A07                    2617m     MOVE.L #7,D5                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00000EE4                          2618m LOOP_162
00000EE4                          2619mm     BIN2HEX D2,D4,A2
00000EE4  45FA 18A4               2620mm     LEA BIN2HEX_LUT(PC),A2                          ; LOAD THE LOOKUP TABLE
00000EE8  E99A                    2621mm     ROL.L #4,D2                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00000EEA  1802                    2622mm     MOVE.B D2,D4
00000EEC  0284 0000000F           2623mm     ANDI.L #$F,D4
00000EF2  1832 4000               2624mm     MOVE.B 0(A2,D4),D4                              ; USE THAT AS AN INDEX INTO THE LUT
00000EF6                          2625mm     ENDM
00000EF6                          2626mm     PRINT_CHAR D4,D3
00000EF6                          2627mm WAIT_FOR_READY_166                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000EF6                 TRUE     2628mm     IFEQ DEBUG
00000EF6  1639 00C00003           2629mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000EFC  0803 0002               2630mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000F00  67F4                    2631mm         BEQ WAIT_FOR_READY_166                      ; NO SPACE, CHECK AGAIN
00000F02  13C4 00C00007           2632mm         MOVE.B D4,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000F08                          2633mm     ENDC
00000F08                          2634mm 
00000F08                 FALSE    2635mm     IFNE DEBUG
00000F08                          2636mm     ENDC
00000F08                          2637mm 
00000F08                          2638mm     ENDM
00000F08  57CD FFDA               2639m     DBEQ D5,LOOP_162
00000F0C                          2640m     ENDM
00000F0C                          2641  
00000F0C  45FA 18C5               2642      LEA FOR(PC),A2
00000F10                          2643m     PRINT_STR A2,D3
00000F10                          2644m LOOP_167
00000F10  0C12 0000               2645m     CMP.B #NULL,(A2)                                ; 0 -> DONE
00000F14  6700 0016               2646m     BEQ EXIT_167
00000F18                          2647mm     PRINT_CHAR (A2)+,D3
00000F18                          2648mm WAIT_FOR_READY_168                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000F18                 TRUE     2649mm     IFEQ DEBUG
00000F18  1639 00C00003           2650mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000F1E  0803 0002               2651mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000F22  67F4                    2652mm         BEQ WAIT_FOR_READY_168                      ; NO SPACE, CHECK AGAIN
00000F24  13DA 00C00007           2653mm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000F2A                          2654mm     ENDC
00000F2A                          2655mm 
00000F2A                 FALSE    2656mm     IFNE DEBUG
00000F2A                          2657mm     ENDC
00000F2A                          2658mm 
00000F2A                          2659mm     ENDM
00000F2A  60E4                    2660m     BRA LOOP_167
00000F2C                          2661m EXIT_167
00000F2C                          2662m     ENDM
00000F2C                          2663m     PRINT_REG D0,D3,D4,D5,A2
00000F2C  45FA 189D               2664m     LEA OX(PC),A2
00000F30                          2665mm     PRINT_STR A2,D3
00000F30                          2666mm LOOP_170
00000F30  0C12 0000               2667mm     CMP.B #NULL,(A2)                                ; 0 -> DONE
00000F34  6700 0016               2668mm     BEQ EXIT_170
00000F38                          2669mmm     PRINT_CHAR (A2)+,D3
00000F38                          2670mmm WAIT_FOR_READY_171                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000F38                 TRUE     2671mmm     IFEQ DEBUG
00000F38  1639 00C00003           2672mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000F3E  0803 0002               2673mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000F42  67F4                    2674mmm         BEQ WAIT_FOR_READY_171                      ; NO SPACE, CHECK AGAIN
00000F44  13DA 00C00007           2675mmm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000F4A                          2676mmm     ENDC
00000F4A                          2677mmm 
00000F4A                 FALSE    2678mmm     IFNE DEBUG
00000F4A                          2679mmm     ENDC
00000F4A                          2680mmm 
00000F4A                          2681mmm     ENDM
00000F4A  60E4                    2682mm     BRA LOOP_170
00000F4C                          2683mm EXIT_170
00000F4C                          2684mm     ENDM
00000F4C  7A07                    2685m     MOVE.L #7,D5                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00000F4E                          2686m LOOP_169
00000F4E                          2687mm     BIN2HEX D0,D4,A2
00000F4E  45FA 183A               2688mm     LEA BIN2HEX_LUT(PC),A2                          ; LOAD THE LOOKUP TABLE
00000F52  E998                    2689mm     ROL.L #4,D0                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00000F54  1800                    2690mm     MOVE.B D0,D4
00000F56  0284 0000000F           2691mm     ANDI.L #$F,D4
00000F5C  1832 4000               2692mm     MOVE.B 0(A2,D4),D4                              ; USE THAT AS AN INDEX INTO THE LUT
00000F60                          2693mm     ENDM
00000F60                          2694mm     PRINT_CHAR D4,D3
00000F60                          2695mm WAIT_FOR_READY_173                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000F60                 TRUE     2696mm     IFEQ DEBUG
00000F60  1639 00C00003           2697mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000F66  0803 0002               2698mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000F6A  67F4                    2699mm         BEQ WAIT_FOR_READY_173                      ; NO SPACE, CHECK AGAIN
00000F6C  13C4 00C00007           2700mm         MOVE.B D4,DUART_TXA                         ; SEND THE NEXT CHARACTER
00000F72                          2701mm     ENDC
00000F72                          2702mm 
00000F72                 FALSE    2703mm     IFNE DEBUG
00000F72                          2704mm     ENDC
00000F72                          2705mm 
00000F72                          2706mm     ENDM
00000F72  57CD FFDA               2707m     DBEQ D5,LOOP_169
00000F76                          2708m     ENDM
00000F76                          2709  
00000F76                          2710m     PRINT_CRLF D3,A2
00000F76  45FA 184D               2711m     LEA CRLF(PC),A2
00000F7A                          2712mm     PRINT_STR A2,D3
00000F7A                          2713mm LOOP_175
00000F7A  0C12 0000               2714mm     CMP.B #NULL,(A2)                                ; 0 -> DONE
00000F7E  6700 0016               2715mm     BEQ EXIT_175
00000F82                          2716mmm     PRINT_CHAR (A2)+,D3
00000F82                          2717mmm WAIT_FOR_READY_176                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00000F82                 TRUE     2718mmm     IFEQ DEBUG
00000F82  1639 00C00003           2719mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00000F88  0803 0002               2720mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00000F8C  67F4                    2721mmm         BEQ WAIT_FOR_READY_176                      ; NO SPACE, CHECK AGAIN
00000F8E  13DA 00C00007           2722mmm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00000F94                          2723mmm     ENDC
00000F94                          2724mmm 
00000F94                 FALSE    2725mmm     IFNE DEBUG
00000F94                          2726mmm     ENDC
00000F94                          2727mmm 
00000F94                          2728mmm     ENDM
00000F94  60E4                    2729mm     BRA LOOP_175
00000F96                          2730mm EXIT_175
00000F96                          2731mm     ENDM
00000F96                          2732m     ENDM
00000F96                          2733  
00000F96                          2734      WHILE D0 <GT> #0 DO
00000F96                          2735s _10000014
00000F96  B07C 0000               2736s     CMP.W   #0,D0
00000F9A  6F00 001C               2737s     BLE _10000015
00000F9E  5580                    2738          SUB.L #2,D0
00000FA0                          2739  
00000FA0  13D1 00E00001           2740          MOVE.B (A1),DISPLAY
00000FA6                          2741m         PROGRAM (A1),(A0),D2
00000FA6  3091                    2742m   MOVE.W (A1),(A0)                                      ; WRITE THE DATA
00000FA8                          2743m 
00000FA8                          2744m WAIT_FOR_COMPLETE_177
00000FA8  3410                    2745m         MOVE.W (A0),D2
00000FAA                          2746m 
00000FAA                          2747m         IF.W D2 <NE> (A1) THEN
00000FAA  B451                    2748ms     CMP.W   (A1),D2
00000FAC  6700 0004               2749ms     BEQ _0000000E
00000FB0  60F6                    2750m             BRA WAIT_FOR_COMPLETE_177
00000FB2                          2751m         ENDI
00000FB2                          2752ms _0000000E
00000FB2                          2753m         ENDM
00000FB2                          2754                  
00000FB2  5488                    2755          ADD.L #2,A0
00000FB4  5489                    2756          ADD.L #2,A1
00000FB6                          2757      ENDW
00000FB6  60DE                    2758s     BRA _10000014
00000FB8                          2759s _10000015
00000FB8                          2760      
00000FB8  41F8 0000               2761      LEA STACK,A0
00000FBC  D1CC                    2762      ADD.L A4,A0
00000FBE  2010                    2763      MOVE.L (A0),D0
00000FC0                          2764      
00000FC0  207C 00000000           2765      MOVE.L #0,A0
00000FC6                          2766m     PROGRAM_VECTOR D0,A0,D2
00000FC6  5488                    2767m     ADD.L #2,A0
00000FC8                          2768mm     PROGRAM D0, (A0), D2                            ; WRITE IT
00000FC8  3080                    2769mm   MOVE.W D0,(A0)                                        ; WRITE THE DATA
00000FCA                          2770mm 
00000FCA                          2771mm WAIT_FOR_COMPLETE_179
00000FCA  3410                    2772mm         MOVE.W (A0),D2
00000FCC                          2773mm 
00000FCC                          2774mm         IF.W D2 <NE> D0 THEN
00000FCC  B440                    2775mms     CMP.W   D0,D2
00000FCE  6700 0004               2776mms     BEQ _0000000F
00000FD2  60F6                    2777mm             BRA WAIT_FOR_COMPLETE_179
00000FD4                          2778mm         ENDI
00000FD4                          2779mms _0000000F
00000FD4                          2780mm         ENDM
00000FD4  E088                    2781m     LSR.L #8,D0
00000FD6  E088                    2782m     LSR.L #8,D0
00000FD8  5588                    2783m     SUB.L #2,A0
00000FDA                          2784mm     PROGRAM D0, (A0), D2
00000FDA  3080                    2785mm   MOVE.W D0,(A0)                                        ; WRITE THE DATA
00000FDC                          2786mm 
00000FDC                          2787mm WAIT_FOR_COMPLETE_180
00000FDC  3410                    2788mm         MOVE.W (A0),D2
00000FDE                          2789mm 
00000FDE                          2790mm         IF.W D2 <NE> D0 THEN
00000FDE  B440                    2791mms     CMP.W   D0,D2
00000FE0  6700 0004               2792mms     BEQ _00000010
00000FE4  60F6                    2793mm             BRA WAIT_FOR_COMPLETE_180
00000FE6                          2794mm         ENDI
00000FE6                          2795mms _00000010
00000FE6                          2796mm         ENDM
00000FE6                          2797m     ENDM
00000FE6                          2798      
00000FE6                          2799      FOR A0 = #RESET TO #START-4 BY #4 DO
00000FE6  307C 0004               2800s     MOVE.W  #RESET,A0
00000FEA  6000 003C               2801s     BRA _2000000F
00000FEE                          2802s _2000000E
00000FEE                          2803  
00000FEE  2248                    2804          MOVE.L A0,A1
00000FF0  D3CC                    2805          ADD.L A4,A1
00000FF2                          2806              
00000FF2  2011                    2807          MOVE.L (A1),D0  
00000FF4  D081                    2808          ADD.L D1,D0
00000FF6  0480 00000104           2809          SUB.L #START,D0
00000FFC                          2810  
00000FFC  2408                    2811          MOVE.L A0,D2
00000FFE                          2812          
00000FFE  2408                    2813          MOVE.L A0,D2
00001000  13C2 00E00001           2814          MOVE.B D2,DISPLAY
00001006                          2815m         PROGRAM_VECTOR D0,A0,D2
00001006  5488                    2816m     ADD.L #2,A0
00001008                          2817mm     PROGRAM D0, (A0), D2                            ; WRITE IT
00001008  3080                    2818mm   MOVE.W D0,(A0)                                        ; WRITE THE DATA
0000100A                          2819mm 
0000100A                          2820mm WAIT_FOR_COMPLETE_182
0000100A  3410                    2821mm         MOVE.W (A0),D2
0000100C                          2822mm 
0000100C                          2823mm         IF.W D2 <NE> D0 THEN
0000100C  B440                    2824mms     CMP.W   D0,D2
0000100E  6700 0004               2825mms     BEQ _00000011
00001012  60F6                    2826mm             BRA WAIT_FOR_COMPLETE_182
00001014                          2827mm         ENDI
00001014                          2828mms _00000011
00001014                          2829mm         ENDM
00001014  E088                    2830m     LSR.L #8,D0
00001016  E088                    2831m     LSR.L #8,D0
00001018  5588                    2832m     SUB.L #2,A0
0000101A                          2833mm     PROGRAM D0, (A0), D2
0000101A  3080                    2834mm   MOVE.W D0,(A0)                                        ; WRITE THE DATA
0000101C                          2835mm 
0000101C                          2836mm WAIT_FOR_COMPLETE_183
0000101C  3410                    2837mm         MOVE.W (A0),D2
0000101E                          2838mm 
0000101E                          2839mm         IF.W D2 <NE> D0 THEN
0000101E  B440                    2840mms     CMP.W   D0,D2
00001020  6700 0004               2841mms     BEQ _00000012
00001024  60F6                    2842mm             BRA WAIT_FOR_COMPLETE_183
00001026                          2843mm         ENDI
00001026                          2844mms _00000012
00001026                          2845mm         ENDM
00001026                          2846m     ENDM
00001026                          2847      ENDF
00001026  5848                    2848s     ADD.W   #4,A0
00001028                          2849s _2000000F
00001028  B0FC 0100               2850s     CMP.W   #START-4,A0
0000102C  6FC0                    2851s     BLE _2000000E
0000102E                          2852                                          
0000102E                          2853m     PROTECT
0000102E  31FC AAAA 2AAA          2854m     MOVE.W #$AAAA,$2AAA                             ; AND WRITE PROTECT
00001034  31FC 5555 1554          2855m     MOVE.W #$5555,$1554
0000103A  31FC A0A0 2AAA          2856m     MOVE.W #$A0A0,$2AAA
00001040                          2857m     ENDM
00001040                          2858  
00001040  6000 F302               2859      BRA MAIN_LOOP
00001044                          2860      
00001044                          2861  P
00001044  7000                    2862      MOVE.L #0,D0                                    ; D0 will be the data to write
00001046                          2863  
00001046                          2864      FOR D1 = #0 TO #3 DO                            ; read 2 bytes
00001046  323C 0000               2865s     MOVE.W  #0,D1
0000104A  6000 0046               2866s     BRA _20000011
0000104E                          2867s _20000010
0000104E  E988                    2868          LSL.L #4,D0                                 ; make what we have so far more significant
00001050                          2869m         WAIT_CHAR D2,D3                             ; next character -> D2
00001050                          2870m WAIT_FOR_READY_185                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001050                 TRUE     2871m     IFEQ DEBUG
00001050  1639 00C00003           2872m         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00001056  0803 0000               2873m         BTST #0,D3                                  ; CHECK FOR CHARACTER
0000105A  67F4                    2874m         BEQ WAIT_FOR_READY_185                      ; NOTHING, CHECK AGAIN
0000105C                          2875m     ENDC
0000105C                          2876m 
0000105C                          2877mm     READ_CHAR D2
0000105C                 TRUE     2878mm     IFEQ DEBUG
0000105C  1439 00C00007           2879mm         MOVE.B DUART_RXA,D2                         ; GOT A CHARACTER, READ IT
00001062                          2880mm     ENDC
00001062                 FALSE    2881mm     IFNE DEBUG
00001062                          2882mm     ENDC
00001062                          2883mm 
00001062  B43C 001B               2884mm     CMP.B #$1B,D2                                   ; CHECK FOR ESCAPE AND GO TO START
00001066  6700 F09C               2885mm     BEQ START
0000106A                          2886mm     ENDM
0000106A                          2887m 
0000106A                 TRUE     2888m     IFEQ DEBUG
0000106A                          2889mm         PRINT_CHAR D2,D3                            ; ECHO IT BACK
0000106A                          2890mm WAIT_FOR_READY_187                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000106A                 TRUE     2891mm     IFEQ DEBUG
0000106A  1639 00C00003           2892mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00001070  0803 0002               2893mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00001074  67F4                    2894mm         BEQ WAIT_FOR_READY_187                      ; NO SPACE, CHECK AGAIN
00001076  13C2 00C00007           2895mm         MOVE.B D2,DUART_TXA                         ; SEND THE NEXT CHARACTER
0000107C                          2896mm     ENDC
0000107C                          2897mm 
0000107C                 FALSE    2898mm     IFNE DEBUG
0000107C                          2899mm     ENDC
0000107C                          2900mm 
0000107C                          2901mm     ENDM
0000107C                          2902m     ENDC
0000107C                          2903m     ENDM
0000107C                          2904m         HEX2BIN D2,D2,A0                            ; convert to binary -> D2
0000107C  41FA 171C               2905m     LEA HEX2BIN_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
00001080  0402 0030               2906m     SUB.B #'0',D2                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
00001084  C4BC 000000FF           2907m     AND.L #$FF,D2                                   ; IGNORE THE TOP 3 BYTES
0000108A  1430 2000               2908m     MOVE.B 0(A0,D2),D2                              ; USE THAT AS AN INDEX INTO THE LUT   
0000108E                          2909m     ENDM
0000108E  8002                    2910          OR.B D2,D0
00001090                          2911      ENDF
00001090  5241                    2912s     ADD.W   #1,D1
00001092                          2913s _20000011
00001092  B27C 0003               2914s     CMP.W   #3,D1
00001096  6FB6                    2915s     BLE _20000010
00001098                          2916  
00001098                          2917m     PRINT_CRLF D2,A1
00001098  43FA 172B               2918m     LEA CRLF(PC),A1
0000109C                          2919mm     PRINT_STR A1,D2
0000109C                          2920mm LOOP_190
0000109C  0C11 0000               2921mm     CMP.B #NULL,(A1)                                ; 0 -> DONE
000010A0  6700 0016               2922mm     BEQ EXIT_190
000010A4                          2923mmm     PRINT_CHAR (A1)+,D2
000010A4                          2924mmm WAIT_FOR_READY_191                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
000010A4                 TRUE     2925mmm     IFEQ DEBUG
000010A4  1439 00C00003           2926mmm         MOVE.B DUART_SRA,D2                         ; READ STATUS REGISTER
000010AA  0802 0002               2927mmm         BTST #2,D2                                  ; CHECK FOR SPACE TO SEND
000010AE  67F4                    2928mmm         BEQ WAIT_FOR_READY_191                      ; NO SPACE, CHECK AGAIN
000010B0  13D9 00C00007           2929mmm         MOVE.B (A1)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000010B6                          2930mmm     ENDC
000010B6                          2931mmm 
000010B6                 FALSE    2932mmm     IFNE DEBUG
000010B6                          2933mmm     ENDC
000010B6                          2934mmm 
000010B6                          2935mmm     ENDM
000010B6  60E4                    2936mm     BRA LOOP_190
000010B8                          2937mm EXIT_190
000010B8                          2938mm     ENDM
000010B8                          2939m     ENDM
000010B8                          2940  
000010B8  2047                    2941      MOVE.L D7,A0                                    ; address accumulator -> target address register
000010BA  7E00                    2942      MOVE.L #0,D7                                    ; clear the now used address accumulator
000010BC                          2943  
000010BC                          2944m     UNPROTECT                                       ; important to only unprotect when we are fully committed (ie, can't escape)
000010BC  31FC AAAA 2AAA          2945m     MOVE.W #$AAAA,$2AAA                             ; REMOVE WRITE PROTECT
000010C2  4E71                    2946m     NOP
000010C4  31FC 5555 1554          2947m     MOVE.W #$5555,$1554
000010CA  4E71                    2948m     NOP
000010CC  31FC 8080 2AAA          2949m     MOVE.W #$8080,$2AAA
000010D2  4E71                    2950m     NOP
000010D4  31FC AAAA 2AAA          2951m     MOVE.W #$AAAA,$2AAA
000010DA  4E71                    2952m     NOP
000010DC  31FC 5555 1554          2953m     MOVE.W #$5555,$1554
000010E2  4E71                    2954m     NOP
000010E4  31FC 2020 2AAA          2955m     MOVE.W #$2020,$2AAA
000010EA                          2956m     ENDM
000010EA                          2957                              
000010EA                          2958      FOR D7 = #$0 TO #$FFFFFFFF DO                   ; dead timing loop to wait for unprotect
000010EA  3E3C 0000               2959s     MOVE.W  #$0,D7
000010EE  6000 0006               2960s     BRA _20000013
000010F2                          2961s _20000012
000010F2  4E71                    2962          NOP
000010F4                          2963      ENDF
000010F4  5247                    2964s     ADD.W   #1,D7
000010F6                          2965s _20000013
000010F6  BE7C FFFF               2966s     CMP.W   #$FFFFFFFF,D7
000010FA  6FF6                    2967s     BLE _20000012
000010FC                          2968               
000010FC  45FA 16B3               2969      LEA LOADING(PC),A2                              ; the prints seem to be important for timing to unprotect the EEPROM
00001100                          2970m     PRINT_STR A2,D2
00001100                          2971m LOOP_193
00001100  0C12 0000               2972m     CMP.B #NULL,(A2)                                ; 0 -> DONE
00001104  6700 0016               2973m     BEQ EXIT_193
00001108                          2974mm     PRINT_CHAR (A2)+,D2
00001108                          2975mm WAIT_FOR_READY_194                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001108                 TRUE     2976mm     IFEQ DEBUG
00001108  1439 00C00003           2977mm         MOVE.B DUART_SRA,D2                         ; READ STATUS REGISTER
0000110E  0802 0002               2978mm         BTST #2,D2                                  ; CHECK FOR SPACE TO SEND
00001112  67F4                    2979mm         BEQ WAIT_FOR_READY_194                      ; NO SPACE, CHECK AGAIN
00001114  13DA 00C00007           2980mm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
0000111A                          2981mm     ENDC
0000111A                          2982mm 
0000111A                 FALSE    2983mm     IFNE DEBUG
0000111A                          2984mm     ENDC
0000111A                          2985mm 
0000111A                          2986mm     ENDM
0000111A  60E4                    2987m     BRA LOOP_193
0000111C                          2988m EXIT_193
0000111C                          2989m     ENDM
0000111C                          2990  
0000111C                          2991m     PRINT_REG D0,D3,D4,D5,A2
0000111C  45FA 16AD               2992m     LEA OX(PC),A2
00001120                          2993mm     PRINT_STR A2,D3
00001120                          2994mm LOOP_196
00001120  0C12 0000               2995mm     CMP.B #NULL,(A2)                                ; 0 -> DONE
00001124  6700 0016               2996mm     BEQ EXIT_196
00001128                          2997mmm     PRINT_CHAR (A2)+,D3
00001128                          2998mmm WAIT_FOR_READY_197                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001128                 TRUE     2999mmm     IFEQ DEBUG
00001128  1639 00C00003           3000mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
0000112E  0803 0002               3001mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00001132  67F4                    3002mmm         BEQ WAIT_FOR_READY_197                      ; NO SPACE, CHECK AGAIN
00001134  13DA 00C00007           3003mmm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
0000113A                          3004mmm     ENDC
0000113A                          3005mmm 
0000113A                 FALSE    3006mmm     IFNE DEBUG
0000113A                          3007mmm     ENDC
0000113A                          3008mmm 
0000113A                          3009mmm     ENDM
0000113A  60E4                    3010mm     BRA LOOP_196
0000113C                          3011mm EXIT_196
0000113C                          3012mm     ENDM
0000113C  7A07                    3013m     MOVE.L #7,D5                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
0000113E                          3014m LOOP_195
0000113E                          3015mm     BIN2HEX D0,D4,A2
0000113E  45FA 164A               3016mm     LEA BIN2HEX_LUT(PC),A2                          ; LOAD THE LOOKUP TABLE
00001142  E998                    3017mm     ROL.L #4,D0                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00001144  1800                    3018mm     MOVE.B D0,D4
00001146  0284 0000000F           3019mm     ANDI.L #$F,D4
0000114C  1832 4000               3020mm     MOVE.B 0(A2,D4),D4                              ; USE THAT AS AN INDEX INTO THE LUT
00001150                          3021mm     ENDM
00001150                          3022mm     PRINT_CHAR D4,D3
00001150                          3023mm WAIT_FOR_READY_199                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001150                 TRUE     3024mm     IFEQ DEBUG
00001150  1639 00C00003           3025mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00001156  0803 0002               3026mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
0000115A  67F4                    3027mm         BEQ WAIT_FOR_READY_199                      ; NO SPACE, CHECK AGAIN
0000115C  13C4 00C00007           3028mm         MOVE.B D4,DUART_TXA                         ; SEND THE NEXT CHARACTER
00001162                          3029mm     ENDC
00001162                          3030mm 
00001162                 FALSE    3031mm     IFNE DEBUG
00001162                          3032mm     ENDC
00001162                          3033mm 
00001162                          3034mm     ENDM
00001162  57CD FFDA               3035m     DBEQ D5,LOOP_195
00001166                          3036m     ENDM
00001166                          3037  
00001166  45FA 1666               3038      LEA TO(PC),A2
0000116A                          3039m     PRINT_STR A2,D3
0000116A                          3040m LOOP_200
0000116A  0C12 0000               3041m     CMP.B #NULL,(A2)                                ; 0 -> DONE
0000116E  6700 0016               3042m     BEQ EXIT_200
00001172                          3043mm     PRINT_CHAR (A2)+,D3
00001172                          3044mm WAIT_FOR_READY_201                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001172                 TRUE     3045mm     IFEQ DEBUG
00001172  1639 00C00003           3046mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00001178  0803 0002               3047mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
0000117C  67F4                    3048mm         BEQ WAIT_FOR_READY_201                      ; NO SPACE, CHECK AGAIN
0000117E  13DA 00C00007           3049mm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00001184                          3050mm     ENDC
00001184                          3051mm 
00001184                 FALSE    3052mm     IFNE DEBUG
00001184                          3053mm     ENDC
00001184                          3054mm 
00001184                          3055mm     ENDM
00001184  60E4                    3056m     BRA LOOP_200
00001186                          3057m EXIT_200
00001186                          3058m     ENDM
00001186                          3059  
00001186  2408                    3060      MOVE.L A0,D2
00001188                          3061m     PRINT_REG D2,D3,D4,D5,A2
00001188  45FA 1641               3062m     LEA OX(PC),A2
0000118C                          3063mm     PRINT_STR A2,D3
0000118C                          3064mm LOOP_203
0000118C  0C12 0000               3065mm     CMP.B #NULL,(A2)                                ; 0 -> DONE
00001190  6700 0016               3066mm     BEQ EXIT_203
00001194                          3067mmm     PRINT_CHAR (A2)+,D3
00001194                          3068mmm WAIT_FOR_READY_204                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001194                 TRUE     3069mmm     IFEQ DEBUG
00001194  1639 00C00003           3070mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
0000119A  0803 0002               3071mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
0000119E  67F4                    3072mmm         BEQ WAIT_FOR_READY_204                      ; NO SPACE, CHECK AGAIN
000011A0  13DA 00C00007           3073mmm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000011A6                          3074mmm     ENDC
000011A6                          3075mmm 
000011A6                 FALSE    3076mmm     IFNE DEBUG
000011A6                          3077mmm     ENDC
000011A6                          3078mmm 
000011A6                          3079mmm     ENDM
000011A6  60E4                    3080mm     BRA LOOP_203
000011A8                          3081mm EXIT_203
000011A8                          3082mm     ENDM
000011A8  7A07                    3083m     MOVE.L #7,D5                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
000011AA                          3084m LOOP_202
000011AA                          3085mm     BIN2HEX D2,D4,A2
000011AA  45FA 15DE               3086mm     LEA BIN2HEX_LUT(PC),A2                          ; LOAD THE LOOKUP TABLE
000011AE  E99A                    3087mm     ROL.L #4,D2                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
000011B0  1802                    3088mm     MOVE.B D2,D4
000011B2  0284 0000000F           3089mm     ANDI.L #$F,D4
000011B8  1832 4000               3090mm     MOVE.B 0(A2,D4),D4                              ; USE THAT AS AN INDEX INTO THE LUT
000011BC                          3091mm     ENDM
000011BC                          3092mm     PRINT_CHAR D4,D3
000011BC                          3093mm WAIT_FOR_READY_206                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
000011BC                 TRUE     3094mm     IFEQ DEBUG
000011BC  1639 00C00003           3095mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000011C2  0803 0002               3096mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
000011C6  67F4                    3097mm         BEQ WAIT_FOR_READY_206                      ; NO SPACE, CHECK AGAIN
000011C8  13C4 00C00007           3098mm         MOVE.B D4,DUART_TXA                         ; SEND THE NEXT CHARACTER
000011CE                          3099mm     ENDC
000011CE                          3100mm 
000011CE                 FALSE    3101mm     IFNE DEBUG
000011CE                          3102mm     ENDC
000011CE                          3103mm 
000011CE                          3104mm     ENDM
000011CE  57CD FFDA               3105m     DBEQ D5,LOOP_202
000011D2                          3106m     ENDM
000011D2                          3107  
000011D2                          3108m     PRINT_CRLF D3,A2
000011D2  45FA 15F1               3109m     LEA CRLF(PC),A2
000011D6                          3110mm     PRINT_STR A2,D3
000011D6                          3111mm LOOP_208
000011D6  0C12 0000               3112mm     CMP.B #NULL,(A2)                                ; 0 -> DONE
000011DA  6700 0016               3113mm     BEQ EXIT_208
000011DE                          3114mmm     PRINT_CHAR (A2)+,D3
000011DE                          3115mmm WAIT_FOR_READY_209                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
000011DE                 TRUE     3116mmm     IFEQ DEBUG
000011DE  1639 00C00003           3117mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000011E4  0803 0002               3118mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
000011E8  67F4                    3119mmm         BEQ WAIT_FOR_READY_209                      ; NO SPACE, CHECK AGAIN
000011EA  13DA 00C00007           3120mmm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000011F0                          3121mmm     ENDC
000011F0                          3122mmm 
000011F0                 FALSE    3123mmm     IFNE DEBUG
000011F0                          3124mmm     ENDC
000011F0                          3125mmm 
000011F0                          3126mmm     ENDM
000011F0  60E4                    3127mm     BRA LOOP_208
000011F2                          3128mm EXIT_208
000011F2                          3129mm     ENDM
000011F2                          3130m     ENDM
000011F2                          3131  
000011F2                          3132m     PROGRAM D0,(A0),D2
000011F2  3080                    3133m   MOVE.W D0,(A0)                                        ; WRITE THE DATA
000011F4                          3134m 
000011F4                          3135m WAIT_FOR_COMPLETE_210
000011F4  3410                    3136m         MOVE.W (A0),D2
000011F6                          3137m 
000011F6                          3138m         IF.W D2 <NE> D0 THEN
000011F6  B440                    3139ms     CMP.W   D0,D2
000011F8  6700 0004               3140ms     BEQ _00000013
000011FC  60F6                    3141m             BRA WAIT_FOR_COMPLETE_210
000011FE                          3142m         ENDI
000011FE                          3143ms _00000013
000011FE                          3144m         ENDM
000011FE                          3145  
000011FE                          3146m     PROTECT
000011FE  31FC AAAA 2AAA          3147m     MOVE.W #$AAAA,$2AAA                             ; AND WRITE PROTECT
00001204  31FC 5555 1554          3148m     MOVE.W #$5555,$1554
0000120A  31FC A0A0 2AAA          3149m     MOVE.W #$A0A0,$2AAA
00001210                          3150m     ENDM
00001210                          3151      
00001210  6000 F132               3152      BRA MAIN_LOOP
00001214                          3153      
00001214                          3154  X
00001214  45FA 15C8               3155      LEA STATUS_REGISTER(PC),A2
00001218                          3156m     PRINT_STR A2,D3
00001218                          3157m LOOP_212
00001218  0C12 0000               3158m     CMP.B #NULL,(A2)                                ; 0 -> DONE
0000121C  6700 0016               3159m     BEQ EXIT_212
00001220                          3160mm     PRINT_CHAR (A2)+,D3
00001220                          3161mm WAIT_FOR_READY_213                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001220                 TRUE     3162mm     IFEQ DEBUG
00001220  1639 00C00003           3163mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00001226  0803 0002               3164mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
0000122A  67F4                    3165mm         BEQ WAIT_FOR_READY_213                      ; NO SPACE, CHECK AGAIN
0000122C  13DA 00C00007           3166mm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00001232                          3167mm     ENDC
00001232                          3168mm 
00001232                 FALSE    3169mm     IFNE DEBUG
00001232                          3170mm     ENDC
00001232                          3171mm 
00001232                          3172mm     ENDM
00001232  60E4                    3173m     BRA LOOP_212
00001234                          3174m EXIT_212
00001234                          3175m     ENDM
00001234                          3176  
00001234  40C0                    3177      MOVE SR,D0
00001236                          3178m     PRINT_REG D0,D3,D4,D5,A2
00001236  45FA 1593               3179m     LEA OX(PC),A2
0000123A                          3180mm     PRINT_STR A2,D3
0000123A                          3181mm LOOP_215
0000123A  0C12 0000               3182mm     CMP.B #NULL,(A2)                                ; 0 -> DONE
0000123E  6700 0016               3183mm     BEQ EXIT_215
00001242                          3184mmm     PRINT_CHAR (A2)+,D3
00001242                          3185mmm WAIT_FOR_READY_216                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001242                 TRUE     3186mmm     IFEQ DEBUG
00001242  1639 00C00003           3187mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00001248  0803 0002               3188mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
0000124C  67F4                    3189mmm         BEQ WAIT_FOR_READY_216                      ; NO SPACE, CHECK AGAIN
0000124E  13DA 00C00007           3190mmm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00001254                          3191mmm     ENDC
00001254                          3192mmm 
00001254                 FALSE    3193mmm     IFNE DEBUG
00001254                          3194mmm     ENDC
00001254                          3195mmm 
00001254                          3196mmm     ENDM
00001254  60E4                    3197mm     BRA LOOP_215
00001256                          3198mm EXIT_215
00001256                          3199mm     ENDM
00001256  7A07                    3200m     MOVE.L #7,D5                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00001258                          3201m LOOP_214
00001258                          3202mm     BIN2HEX D0,D4,A2
00001258  45FA 1530               3203mm     LEA BIN2HEX_LUT(PC),A2                          ; LOAD THE LOOKUP TABLE
0000125C  E998                    3204mm     ROL.L #4,D0                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
0000125E  1800                    3205mm     MOVE.B D0,D4
00001260  0284 0000000F           3206mm     ANDI.L #$F,D4
00001266  1832 4000               3207mm     MOVE.B 0(A2,D4),D4                              ; USE THAT AS AN INDEX INTO THE LUT
0000126A                          3208mm     ENDM
0000126A                          3209mm     PRINT_CHAR D4,D3
0000126A                          3210mm WAIT_FOR_READY_218                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000126A                 TRUE     3211mm     IFEQ DEBUG
0000126A  1639 00C00003           3212mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00001270  0803 0002               3213mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00001274  67F4                    3214mm         BEQ WAIT_FOR_READY_218                      ; NO SPACE, CHECK AGAIN
00001276  13C4 00C00007           3215mm         MOVE.B D4,DUART_TXA                         ; SEND THE NEXT CHARACTER
0000127C                          3216mm     ENDC
0000127C                          3217mm 
0000127C                 FALSE    3218mm     IFNE DEBUG
0000127C                          3219mm     ENDC
0000127C                          3220mm 
0000127C                          3221mm     ENDM
0000127C  57CD FFDA               3222m     DBEQ D5,LOOP_214
00001280                          3223m     ENDM
00001280                          3224m     PRINT_CRLF D3,A2
00001280  45FA 1543               3225m     LEA CRLF(PC),A2
00001284                          3226mm     PRINT_STR A2,D3
00001284                          3227mm LOOP_220
00001284  0C12 0000               3228mm     CMP.B #NULL,(A2)                                ; 0 -> DONE
00001288  6700 0016               3229mm     BEQ EXIT_220
0000128C                          3230mmm     PRINT_CHAR (A2)+,D3
0000128C                          3231mmm WAIT_FOR_READY_221                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000128C                 TRUE     3232mmm     IFEQ DEBUG
0000128C  1639 00C00003           3233mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
00001292  0803 0002               3234mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00001296  67F4                    3235mmm         BEQ WAIT_FOR_READY_221                      ; NO SPACE, CHECK AGAIN
00001298  13DA 00C00007           3236mmm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
0000129E                          3237mmm     ENDC
0000129E                          3238mmm 
0000129E                 FALSE    3239mmm     IFNE DEBUG
0000129E                          3240mmm     ENDC
0000129E                          3241mmm 
0000129E                          3242mmm     ENDM
0000129E  60E4                    3243mm     BRA LOOP_220
000012A0                          3244mm EXIT_220
000012A0                          3245mm     ENDM
000012A0                          3246m     ENDM
000012A0                          3247  
000012A0  45FA 1537               3248      LEA STACK_POINTER(PC),A2
000012A4                          3249m     PRINT_STR A2,D3
000012A4                          3250m LOOP_222
000012A4  0C12 0000               3251m     CMP.B #NULL,(A2)                                ; 0 -> DONE
000012A8  6700 0016               3252m     BEQ EXIT_222
000012AC                          3253mm     PRINT_CHAR (A2)+,D3
000012AC                          3254mm WAIT_FOR_READY_223                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
000012AC                 TRUE     3255mm     IFEQ DEBUG
000012AC  1639 00C00003           3256mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000012B2  0803 0002               3257mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
000012B6  67F4                    3258mm         BEQ WAIT_FOR_READY_223                      ; NO SPACE, CHECK AGAIN
000012B8  13DA 00C00007           3259mm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000012BE                          3260mm     ENDC
000012BE                          3261mm 
000012BE                 FALSE    3262mm     IFNE DEBUG
000012BE                          3263mm     ENDC
000012BE                          3264mm 
000012BE                          3265mm     ENDM
000012BE  60E4                    3266m     BRA LOOP_222
000012C0                          3267m EXIT_222
000012C0                          3268m     ENDM
000012C0                          3269  
000012C0  200F                    3270      MOVE.L SP,D0
000012C2                          3271m     PRINT_REG D0,D3,D4,D5,A2
000012C2  45FA 1507               3272m     LEA OX(PC),A2
000012C6                          3273mm     PRINT_STR A2,D3
000012C6                          3274mm LOOP_225
000012C6  0C12 0000               3275mm     CMP.B #NULL,(A2)                                ; 0 -> DONE
000012CA  6700 0016               3276mm     BEQ EXIT_225
000012CE                          3277mmm     PRINT_CHAR (A2)+,D3
000012CE                          3278mmm WAIT_FOR_READY_226                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
000012CE                 TRUE     3279mmm     IFEQ DEBUG
000012CE  1639 00C00003           3280mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000012D4  0803 0002               3281mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
000012D8  67F4                    3282mmm         BEQ WAIT_FOR_READY_226                      ; NO SPACE, CHECK AGAIN
000012DA  13DA 00C00007           3283mmm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000012E0                          3284mmm     ENDC
000012E0                          3285mmm 
000012E0                 FALSE    3286mmm     IFNE DEBUG
000012E0                          3287mmm     ENDC
000012E0                          3288mmm 
000012E0                          3289mmm     ENDM
000012E0  60E4                    3290mm     BRA LOOP_225
000012E2                          3291mm EXIT_225
000012E2                          3292mm     ENDM
000012E2  7A07                    3293m     MOVE.L #7,D5                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
000012E4                          3294m LOOP_224
000012E4                          3295mm     BIN2HEX D0,D4,A2
000012E4  45FA 14A4               3296mm     LEA BIN2HEX_LUT(PC),A2                          ; LOAD THE LOOKUP TABLE
000012E8  E998                    3297mm     ROL.L #4,D0                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
000012EA  1800                    3298mm     MOVE.B D0,D4
000012EC  0284 0000000F           3299mm     ANDI.L #$F,D4
000012F2  1832 4000               3300mm     MOVE.B 0(A2,D4),D4                              ; USE THAT AS AN INDEX INTO THE LUT
000012F6                          3301mm     ENDM
000012F6                          3302mm     PRINT_CHAR D4,D3
000012F6                          3303mm WAIT_FOR_READY_228                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
000012F6                 TRUE     3304mm     IFEQ DEBUG
000012F6  1639 00C00003           3305mm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000012FC  0803 0002               3306mm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00001300  67F4                    3307mm         BEQ WAIT_FOR_READY_228                      ; NO SPACE, CHECK AGAIN
00001302  13C4 00C00007           3308mm         MOVE.B D4,DUART_TXA                         ; SEND THE NEXT CHARACTER
00001308                          3309mm     ENDC
00001308                          3310mm 
00001308                 FALSE    3311mm     IFNE DEBUG
00001308                          3312mm     ENDC
00001308                          3313mm 
00001308                          3314mm     ENDM
00001308  57CD FFDA               3315m     DBEQ D5,LOOP_224
0000130C                          3316m     ENDM
0000130C                          3317m     PRINT_CRLF D3,A2
0000130C  45FA 14B7               3318m     LEA CRLF(PC),A2
00001310                          3319mm     PRINT_STR A2,D3
00001310                          3320mm LOOP_230
00001310  0C12 0000               3321mm     CMP.B #NULL,(A2)                                ; 0 -> DONE
00001314  6700 0016               3322mm     BEQ EXIT_230
00001318                          3323mmm     PRINT_CHAR (A2)+,D3
00001318                          3324mmm WAIT_FOR_READY_231                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001318                 TRUE     3325mmm     IFEQ DEBUG
00001318  1639 00C00003           3326mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
0000131E  0803 0002               3327mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
00001322  67F4                    3328mmm         BEQ WAIT_FOR_READY_231                      ; NO SPACE, CHECK AGAIN
00001324  13DA 00C00007           3329mmm         MOVE.B (A2)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
0000132A                          3330mmm     ENDC
0000132A                          3331mmm 
0000132A                 FALSE    3332mmm     IFNE DEBUG
0000132A                          3333mmm     ENDC
0000132A                          3334mmm 
0000132A                          3335mmm     ENDM
0000132A  60E4                    3336mm     BRA LOOP_230
0000132C                          3337mm EXIT_230
0000132C                          3338mm     ENDM
0000132C                          3339m     ENDM
0000132C                          3340  
0000132C  6000 F016               3341      BRA MAIN_LOOP
00001330                          3342          
00001330                          3343  EI
00001330  13FC 0008 00C0000B      3344      MOVE.B #8,DUART_IMR
00001338  027C F8FF               3345      AND.W #$F8FF,SR
0000133C  6000 F006               3346      BRA MAIN_LOOP
00001340                          3347      
00001340                          3348  DI
00001340  13FC 0000 00C0000B      3349      MOVE.B #0,DUART_IMR
00001348  007C 0700               3350      OR.W #$0700,SR
0000134C  6000 EFF6               3351      BRA MAIN_LOOP
00001350                          3352          
00001350                          3353  HASH
00001350                          3354m     PROTECT
00001350  31FC AAAA 2AAA          3355m     MOVE.W #$AAAA,$2AAA                             ; AND WRITE PROTECT
00001356  31FC 5555 1554          3356m     MOVE.W #$5555,$1554
0000135C  31FC A0A0 2AAA          3357m     MOVE.W #$A0A0,$2AAA
00001362                          3358m     ENDM
00001362  6000 EFE0               3359      BRA MAIN_LOOP
00001366                          3360  
00001366                          3361  I
00001366  13FC 0038 00A00019      3362      MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
0000136E                          3363      
0000136E                          3364m     WRITE_8 #IDE_DRIVESEL_MASTER, #IDE_DRIVESEL_REGISTER, D0
0000136E  13FC 00FF 00A00007      3365m     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
00001376  103C 0030               3366m     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
0000137A  0000 0006               3367m     ORI.B #IDE_DRIVESEL_REGISTER, D0
0000137E  13C0 00A00019           3368m     MOVE.B D0, MC68230_PORT_C_DATA
00001384  0200 00EF               3369m     ANDI.B #~MC68230_PORT_C_WRITE, D0
00001388  13FC 00E0 00A00013      3370m     MOVE.B #IDE_DRIVESEL_MASTER, MC68230_PORT_B_DATA
00001390  13C0 00A00019           3371m     MOVE.B D0, MC68230_PORT_C_DATA
00001396  0000 0010               3372m     ORI.B #MC68230_PORT_C_WRITE, D0
0000139A  13C0 00A00019           3373m     MOVE.B D0, MC68230_PORT_C_DATA
000013A0  13FC 0038 00A00019      3374m     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000013A8                          3375m     ENDM
000013A8                          3376m     WAIT_DRIVE_READY D0, D1
000013A8                          3377m LOOP_234
000013A8                          3378mm     READ_IDE_STATUS D0, D1
000013A8                          3379mmm     READ_8 #IDE_STATUS_REGISTER, D0, D1
000013A8  13FC 0000 00A00007      3380mmm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
000013B0  123C 0030               3381mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1
000013B4  0001 0007               3382mmm     ORI.B #IDE_STATUS_REGISTER, D1
000013B8  13C1 00A00019           3383mmm     MOVE.B D1, MC68230_PORT_C_DATA
000013BE  0201 00DF               3384mmm     ANDI.B #~MC68230_PORT_C_READ, D1
000013C2  13C1 00A00019           3385mmm     MOVE.B D1, MC68230_PORT_C_DATA
000013C8  1039 00A00013           3386mmm     MOVE.B MC68230_PORT_B_DATA, D0
000013CE  0001 0020               3387mmm     ORI.B #MC68230_PORT_C_READ, D1
000013D2  13C1 00A00019           3388mmm     MOVE.B D1, MC68230_PORT_C_DATA
000013D8  13FC 0038 00A00019      3389mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000013E0                          3390mmm     ENDM
000013E0                          3391mm     ENDM
000013E0  0800 0006               3392m     BTST #IDE_STATUS_READY, D0
000013E4  67C2                    3393m     BEQ LOOP_234
000013E6                          3394m     ENDM
000013E6                          3395          
000013E6                          3396m     SEND_READ_COMMAND_AND_WAIT #0, D0, D1, D2
000013E6                          3397mm     WAIT_DRIVE_NOT_BUSY D0, D1
000013E6                          3398mm LOOP_238
000013E6                          3399mmm     READ_IDE_STATUS D0, D1
000013E6                          3400mmmm     READ_8 #IDE_STATUS_REGISTER, D0, D1
000013E6  13FC 0000 00A00007      3401mmmm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
000013EE  123C 0030               3402mmmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1
000013F2  0001 0007               3403mmmm     ORI.B #IDE_STATUS_REGISTER, D1
000013F6  13C1 00A00019           3404mmmm     MOVE.B D1, MC68230_PORT_C_DATA
000013FC  0201 00DF               3405mmmm     ANDI.B #~MC68230_PORT_C_READ, D1
00001400  13C1 00A00019           3406mmmm     MOVE.B D1, MC68230_PORT_C_DATA
00001406  1039 00A00013           3407mmmm     MOVE.B MC68230_PORT_B_DATA, D0
0000140C  0001 0020               3408mmmm     ORI.B #MC68230_PORT_C_READ, D1
00001410  13C1 00A00019           3409mmmm     MOVE.B D1, MC68230_PORT_C_DATA
00001416  13FC 0038 00A00019      3410mmmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
0000141E                          3411mmmm     ENDM
0000141E                          3412mmm     ENDM
0000141E  0800 0007               3413mm     BTST #IDE_STATUS_BUSY, D0
00001422  66C2                    3414mm     BNE LOOP_238
00001424                          3415mm     ENDM
00001424                          3416mm     SET_READ_ADDRESS #0, D0, D1, D2
00001424                          3417mmm     WRITE_8 #1, #IDE_SECTOR_COUNT_REGISTER, D0
00001424  13FC 00FF 00A00007      3418mmm     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
0000142C  103C 0030               3419mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
00001430  0000 0002               3420mmm     ORI.B #IDE_SECTOR_COUNT_REGISTER, D0
00001434  13C0 00A00019           3421mmm     MOVE.B D0, MC68230_PORT_C_DATA
0000143A  0200 00EF               3422mmm     ANDI.B #~MC68230_PORT_C_WRITE, D0
0000143E  13FC 0001 00A00013      3423mmm     MOVE.B #1, MC68230_PORT_B_DATA
00001446  13C0 00A00019           3424mmm     MOVE.B D0, MC68230_PORT_C_DATA
0000144C  0000 0010               3425mmm     ORI.B #MC68230_PORT_C_WRITE, D0
00001450  13C0 00A00019           3426mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001456  13FC 0038 00A00019      3427mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
0000145E                          3428mmm     ENDM
0000145E  7200                    3429mm     MOVE.L #0,D1
00001460                          3430mmm     WRITE_8 D1, #IDE_LBA_0_7_REGISTER, D0
00001460  13FC 00FF 00A00007      3431mmm     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
00001468  103C 0030               3432mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
0000146C  0000 0003               3433mmm     ORI.B #IDE_LBA_0_7_REGISTER, D0
00001470  13C0 00A00019           3434mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001476  0200 00EF               3435mmm     ANDI.B #~MC68230_PORT_C_WRITE, D0
0000147A  13C1 00A00013           3436mmm     MOVE.B D1, MC68230_PORT_B_DATA
00001480  13C0 00A00019           3437mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001486  0000 0010               3438mmm     ORI.B #MC68230_PORT_C_WRITE, D0
0000148A  13C0 00A00019           3439mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001490  13FC 0038 00A00019      3440mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001498                          3441mmm     ENDM
00001498  E089                    3442mm     LSR.L #8, D1
0000149A                          3443mmm     WRITE_8 D1, #IDE_LBA_8_15_REGISTER, D0
0000149A  13FC 00FF 00A00007      3444mmm     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
000014A2  103C 0030               3445mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
000014A6  0000 0004               3446mmm     ORI.B #IDE_LBA_8_15_REGISTER, D0
000014AA  13C0 00A00019           3447mmm     MOVE.B D0, MC68230_PORT_C_DATA
000014B0  0200 00EF               3448mmm     ANDI.B #~MC68230_PORT_C_WRITE, D0
000014B4  13C1 00A00013           3449mmm     MOVE.B D1, MC68230_PORT_B_DATA
000014BA  13C0 00A00019           3450mmm     MOVE.B D0, MC68230_PORT_C_DATA
000014C0  0000 0010               3451mmm     ORI.B #MC68230_PORT_C_WRITE, D0
000014C4  13C0 00A00019           3452mmm     MOVE.B D0, MC68230_PORT_C_DATA
000014CA  13FC 0038 00A00019      3453mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000014D2                          3454mmm     ENDM
000014D2  E089                    3455mm     LSR.L #8, D1                                
000014D4                          3456mmm     WRITE_8 D1, #IDE_LBA_16_23_REGISTER, D0
000014D4  13FC 00FF 00A00007      3457mmm     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
000014DC  103C 0030               3458mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
000014E0  0000 0005               3459mmm     ORI.B #IDE_LBA_16_23_REGISTER, D0
000014E4  13C0 00A00019           3460mmm     MOVE.B D0, MC68230_PORT_C_DATA
000014EA  0200 00EF               3461mmm     ANDI.B #~MC68230_PORT_C_WRITE, D0
000014EE  13C1 00A00013           3462mmm     MOVE.B D1, MC68230_PORT_B_DATA
000014F4  13C0 00A00019           3463mmm     MOVE.B D0, MC68230_PORT_C_DATA
000014FA  0000 0010               3464mmm     ORI.B #MC68230_PORT_C_WRITE, D0
000014FE  13C0 00A00019           3465mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001504  13FC 0038 00A00019      3466mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
0000150C                          3467mmm     ENDM
0000150C  E089                    3468mm     LSR.L #8, D1
0000150E                          3469mmm     READ_8 #IDE_DRIVESEL_REGISTER, D2, D0
0000150E  13FC 0000 00A00007      3470mmm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001516  103C 0030               3471mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
0000151A  0000 0006               3472mmm     ORI.B #IDE_DRIVESEL_REGISTER, D0
0000151E  13C0 00A00019           3473mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001524  0200 00DF               3474mmm     ANDI.B #~MC68230_PORT_C_READ, D0
00001528  13C0 00A00019           3475mmm     MOVE.B D0, MC68230_PORT_C_DATA
0000152E  1439 00A00013           3476mmm     MOVE.B MC68230_PORT_B_DATA, D2
00001534  0000 0020               3477mmm     ORI.B #MC68230_PORT_C_READ, D0
00001538  13C0 00A00019           3478mmm     MOVE.B D0, MC68230_PORT_C_DATA
0000153E  13FC 0038 00A00019      3479mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001546                          3480mmm     ENDM
00001546  0201 000F               3481mm     ANDI.B #$0F,D1
0000154A  8401                    3482mm     OR.B D1,D2
0000154C                          3483mmm     WRITE_8 D2, #IDE_DRIVESEL_REGISTER, D0
0000154C  13FC 00FF 00A00007      3484mmm     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
00001554  103C 0030               3485mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
00001558  0000 0006               3486mmm     ORI.B #IDE_DRIVESEL_REGISTER, D0
0000155C  13C0 00A00019           3487mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001562  0200 00EF               3488mmm     ANDI.B #~MC68230_PORT_C_WRITE, D0
00001566  13C2 00A00013           3489mmm     MOVE.B D2, MC68230_PORT_B_DATA
0000156C  13C0 00A00019           3490mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001572  0000 0010               3491mmm     ORI.B #MC68230_PORT_C_WRITE, D0
00001576  13C0 00A00019           3492mmm     MOVE.B D0, MC68230_PORT_C_DATA
0000157C  13FC 0038 00A00019      3493mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001584                          3494mmm     ENDM
00001584                          3495mm     ENDM
00001584                          3496mm     SEND_COMMAND #IDE_COMMAND_READ_WITH_RETRY, D0
00001584                          3497mmm     WRITE_8 #IDE_COMMAND_READ_WITH_RETRY, #IDE_COMMAND_REGISTER, D0
00001584  13FC 00FF 00A00007      3498mmm     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
0000158C  103C 0030               3499mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
00001590  0000 0007               3500mmm     ORI.B #IDE_COMMAND_REGISTER, D0
00001594  13C0 00A00019           3501mmm     MOVE.B D0, MC68230_PORT_C_DATA
0000159A  0200 00EF               3502mmm     ANDI.B #~MC68230_PORT_C_WRITE, D0
0000159E  13FC 0020 00A00013      3503mmm     MOVE.B #IDE_COMMAND_READ_WITH_RETRY, MC68230_PORT_B_DATA
000015A6  13C0 00A00019           3504mmm     MOVE.B D0, MC68230_PORT_C_DATA
000015AC  0000 0010               3505mmm     ORI.B #MC68230_PORT_C_WRITE, D0
000015B0  13C0 00A00019           3506mmm     MOVE.B D0, MC68230_PORT_C_DATA
000015B6  13FC 0038 00A00019      3507mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000015BE                          3508mmm     ENDM
000015BE                          3509mm     ENDM
000015BE                          3510mm     WAIT_DRIVE_NOT_BUSY D0, D1
000015BE                          3511mm LOOP_250
000015BE                          3512mmm     READ_IDE_STATUS D0, D1
000015BE                          3513mmmm     READ_8 #IDE_STATUS_REGISTER, D0, D1
000015BE  13FC 0000 00A00007      3514mmmm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
000015C6  123C 0030               3515mmmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1
000015CA  0001 0007               3516mmmm     ORI.B #IDE_STATUS_REGISTER, D1
000015CE  13C1 00A00019           3517mmmm     MOVE.B D1, MC68230_PORT_C_DATA
000015D4  0201 00DF               3518mmmm     ANDI.B #~MC68230_PORT_C_READ, D1
000015D8  13C1 00A00019           3519mmmm     MOVE.B D1, MC68230_PORT_C_DATA
000015DE  1039 00A00013           3520mmmm     MOVE.B MC68230_PORT_B_DATA, D0
000015E4  0001 0020               3521mmmm     ORI.B #MC68230_PORT_C_READ, D1
000015E8  13C1 00A00019           3522mmmm     MOVE.B D1, MC68230_PORT_C_DATA
000015EE  13FC 0038 00A00019      3523mmmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000015F6                          3524mmmm     ENDM
000015F6                          3525mmm     ENDM
000015F6  0800 0007               3526mm     BTST #IDE_STATUS_BUSY, D0
000015FA  66C2                    3527mm     BNE LOOP_250
000015FC                          3528mm     ENDM
000015FC                          3529mm     WAIT_DRIVE_DRQ D0, D1
000015FC                          3530mm LOOP_253
000015FC                          3531mmm     READ_IDE_STATUS D0, D1
000015FC                          3532mmmm     READ_8 #IDE_STATUS_REGISTER, D0, D1
000015FC  13FC 0000 00A00007      3533mmmm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001604  123C 0030               3534mmmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1
00001608  0001 0007               3535mmmm     ORI.B #IDE_STATUS_REGISTER, D1
0000160C  13C1 00A00019           3536mmmm     MOVE.B D1, MC68230_PORT_C_DATA
00001612  0201 00DF               3537mmmm     ANDI.B #~MC68230_PORT_C_READ, D1
00001616  13C1 00A00019           3538mmmm     MOVE.B D1, MC68230_PORT_C_DATA
0000161C  1039 00A00013           3539mmmm     MOVE.B MC68230_PORT_B_DATA, D0
00001622  0001 0020               3540mmmm     ORI.B #MC68230_PORT_C_READ, D1
00001626  13C1 00A00019           3541mmmm     MOVE.B D1, MC68230_PORT_C_DATA
0000162C  13FC 0038 00A00019      3542mmmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001634                          3543mmmm     ENDM
00001634                          3544mmm     ENDM
00001634  0800 0003               3545mm     BTST #IDE_STATUS_DRQ, D0
00001638  67C2                    3546mm     BEQ LOOP_253
0000163A                          3547mm     ENDM
0000163A                          3548m     ENDM
0000163A                          3549  
0000163A  7800                    3550      MOVE.L #0,D4                                ; words read from block
0000163C                          3551  
0000163C                          3552m     READ_32 #IDE_DATA_REGISTER, D2, D1          ; num entries -> D2
0000163C                          3553mm     READ_16 #IDE_DATA_REGISTER, D2, D1
0000163C  13FC 0000 00A00007      3554mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001644  13FC 0000 00A00005      3555mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
0000164C                          3556mm     
0000164C  123C 0030               3557mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001650  0001 0000               3558mm     ORI.B #IDE_DATA_REGISTER, D1
00001654  13C1 00A00019           3559mm     MOVE.B D1, MC68230_PORT_C_DATA
0000165A  0201 00DF               3560mm     ANDI.B #~MC68230_PORT_C_READ, D1
0000165E  13C1 00A00019           3561mm     MOVE.B D1, MC68230_PORT_C_DATA
00001664  1439 00A00011           3562mm     MOVE.B MC68230_PORT_A_DATA, D2
0000166A  E14A                    3563mm     LSL.W #8, D2
0000166C  1439 00A00013           3564mm     MOVE.B MC68230_PORT_B_DATA, D2
00001672  0001 0020               3565mm     ORI.B #MC68230_PORT_C_READ, D1
00001676  13C1 00A00019           3566mm     MOVE.B D1, MC68230_PORT_C_DATA
0000167C  13FC 0038 00A00019      3567mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001684                          3568mm     ENDM
00001684  E18A                    3569m     LSL.L #8, D2
00001686  E18A                    3570m     LSL.L #8, D2
00001688                          3571mm     READ_16 #IDE_DATA_REGISTER, D2, D1
00001688  13FC 0000 00A00007      3572mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001690  13FC 0000 00A00005      3573mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001698                          3574mm     
00001698  123C 0030               3575mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
0000169C  0001 0000               3576mm     ORI.B #IDE_DATA_REGISTER, D1
000016A0  13C1 00A00019           3577mm     MOVE.B D1, MC68230_PORT_C_DATA
000016A6  0201 00DF               3578mm     ANDI.B #~MC68230_PORT_C_READ, D1
000016AA  13C1 00A00019           3579mm     MOVE.B D1, MC68230_PORT_C_DATA
000016B0  1439 00A00011           3580mm     MOVE.B MC68230_PORT_A_DATA, D2
000016B6  E14A                    3581mm     LSL.W #8, D2
000016B8  1439 00A00013           3582mm     MOVE.B MC68230_PORT_B_DATA, D2
000016BE  0001 0020               3583mm     ORI.B #MC68230_PORT_C_READ, D1
000016C2  13C1 00A00019           3584mm     MOVE.B D1, MC68230_PORT_C_DATA
000016C8  13FC 0038 00A00019      3585mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000016D0                          3586mm     ENDM
000016D0                          3587m     ENDM
000016D0  5484                    3588      ADD.L #2, D4
000016D2                          3589              
000016D2  7600                    3590      MOVE.L #0, D3                               ; entries printed -> D3
000016D4                          3591      
000016D4                          3592      WHILE.L D4 <LT> #255 DO                     ; read the entire 256 words to complete the transfer, even though we don't care
000016D4                          3593s _10000016
000016D4  B8BC 000000FF           3594s     CMP.L   #255,D4
000016DA  6C00 07A8               3595s     BGE _10000017
000016DE                          3596          IF D3 <LT> D2 THEN
000016DE  B642                    3597s     CMP.W   D2,D3
000016E0  6C00 0754               3598s     BGE _00000014
000016E4                          3599m             READ_32 #IDE_DATA_REGISTER, D5, D1  ; empty flag  -> D5
000016E4                          3600mm     READ_16 #IDE_DATA_REGISTER, D5, D1
000016E4  13FC 0000 00A00007      3601mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
000016EC  13FC 0000 00A00005      3602mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
000016F4                          3603mm     
000016F4  123C 0030               3604mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
000016F8  0001 0000               3605mm     ORI.B #IDE_DATA_REGISTER, D1
000016FC  13C1 00A00019           3606mm     MOVE.B D1, MC68230_PORT_C_DATA
00001702  0201 00DF               3607mm     ANDI.B #~MC68230_PORT_C_READ, D1
00001706  13C1 00A00019           3608mm     MOVE.B D1, MC68230_PORT_C_DATA
0000170C  1A39 00A00011           3609mm     MOVE.B MC68230_PORT_A_DATA, D5
00001712  E14D                    3610mm     LSL.W #8, D5
00001714  1A39 00A00013           3611mm     MOVE.B MC68230_PORT_B_DATA, D5
0000171A  0001 0020               3612mm     ORI.B #MC68230_PORT_C_READ, D1
0000171E  13C1 00A00019           3613mm     MOVE.B D1, MC68230_PORT_C_DATA
00001724  13FC 0038 00A00019      3614mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
0000172C                          3615mm     ENDM
0000172C  E18D                    3616m     LSL.L #8, D5
0000172E  E18D                    3617m     LSL.L #8, D5
00001730                          3618mm     READ_16 #IDE_DATA_REGISTER, D5, D1
00001730  13FC 0000 00A00007      3619mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001738  13FC 0000 00A00005      3620mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001740                          3621mm     
00001740  123C 0030               3622mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001744  0001 0000               3623mm     ORI.B #IDE_DATA_REGISTER, D1
00001748  13C1 00A00019           3624mm     MOVE.B D1, MC68230_PORT_C_DATA
0000174E  0201 00DF               3625mm     ANDI.B #~MC68230_PORT_C_READ, D1
00001752  13C1 00A00019           3626mm     MOVE.B D1, MC68230_PORT_C_DATA
00001758  1A39 00A00011           3627mm     MOVE.B MC68230_PORT_A_DATA, D5
0000175E  E14D                    3628mm     LSL.W #8, D5
00001760  1A39 00A00013           3629mm     MOVE.B MC68230_PORT_B_DATA, D5
00001766  0001 0020               3630mm     ORI.B #MC68230_PORT_C_READ, D1
0000176A  13C1 00A00019           3631mm     MOVE.B D1, MC68230_PORT_C_DATA
00001770  13FC 0038 00A00019      3632mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001778                          3633mm     ENDM
00001778                          3634m     ENDM
00001778  5484                    3635              ADD.L #2, D4
0000177A                          3636          
0000177A                          3637              IF D5 <NE> #1 THEN
0000177A  BA7C 0001               3638s     CMP.W   #1,D5
0000177E  6700 0044               3639s     BEQ _00000015
00001782                          3640m                 PRINT_REG_4BIT D3,D1,D6,A0
00001782  41FA 1006               3641m     LEA BIN2HEX_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
00001786  1C03                    3642m     MOVE.B D3,D6
00001788  0286 0000000F           3643m     ANDI.L #$F,D6
0000178E  1C30 6000               3644m     MOVE.B 0(A0,D6),D6                              ; USE THAT AS AN INDEX INTO THE LUT
00001792                          3645mm     PRINT_CHAR D6,D1
00001792                          3646mm WAIT_FOR_READY_263                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001792                 TRUE     3647mm     IFEQ DEBUG
00001792  1239 00C00003           3648mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001798  0801 0002               3649mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
0000179C  67F4                    3650mm         BEQ WAIT_FOR_READY_263                      ; NO SPACE, CHECK AGAIN
0000179E  13C6 00C00007           3651mm         MOVE.B D6,DUART_TXA                         ; SEND THE NEXT CHARACTER
000017A4                          3652mm     ENDC
000017A4                          3653mm 
000017A4                 FALSE    3654mm     IFNE DEBUG
000017A4                          3655mm     ENDC
000017A4                          3656mm 
000017A4                          3657mm     ENDM
000017A4                          3658m     ENDM
000017A4  41FA 103D               3659                  LEA INDEX_SEP(PC),A0
000017A8                          3660m                 PRINT_STR A0,D1
000017A8                          3661m LOOP_264
000017A8  0C10 0000               3662m     CMP.B #NULL,(A0)                                ; 0 -> DONE
000017AC  6700 0016               3663m     BEQ EXIT_264
000017B0                          3664mm     PRINT_CHAR (A0)+,D1
000017B0                          3665mm WAIT_FOR_READY_265                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
000017B0                 TRUE     3666mm     IFEQ DEBUG
000017B0  1239 00C00003           3667mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
000017B6  0801 0002               3668mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
000017BA  67F4                    3669mm         BEQ WAIT_FOR_READY_265                      ; NO SPACE, CHECK AGAIN
000017BC  13D8 00C00007           3670mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000017C2                          3671mm     ENDC
000017C2                          3672mm 
000017C2                 FALSE    3673mm     IFNE DEBUG
000017C2                          3674mm     ENDC
000017C2                          3675mm 
000017C2                          3676mm     ENDM
000017C2  60E4                    3677m     BRA LOOP_264
000017C4                          3678m EXIT_264
000017C4                          3679m     ENDM
000017C4                          3680              ENDI
000017C4                          3681s _00000015
000017C4                          3682              
000017C4                          3683m             READ_32 #IDE_DATA_REGISTER, D6, D1 ; strlen
000017C4                          3684mm     READ_16 #IDE_DATA_REGISTER, D6, D1
000017C4  13FC 0000 00A00007      3685mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
000017CC  13FC 0000 00A00005      3686mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
000017D4                          3687mm     
000017D4  123C 0030               3688mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
000017D8  0001 0000               3689mm     ORI.B #IDE_DATA_REGISTER, D1
000017DC  13C1 00A00019           3690mm     MOVE.B D1, MC68230_PORT_C_DATA
000017E2  0201 00DF               3691mm     ANDI.B #~MC68230_PORT_C_READ, D1
000017E6  13C1 00A00019           3692mm     MOVE.B D1, MC68230_PORT_C_DATA
000017EC  1C39 00A00011           3693mm     MOVE.B MC68230_PORT_A_DATA, D6
000017F2  E14E                    3694mm     LSL.W #8, D6
000017F4  1C39 00A00013           3695mm     MOVE.B MC68230_PORT_B_DATA, D6
000017FA  0001 0020               3696mm     ORI.B #MC68230_PORT_C_READ, D1
000017FE  13C1 00A00019           3697mm     MOVE.B D1, MC68230_PORT_C_DATA
00001804  13FC 0038 00A00019      3698mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
0000180C                          3699mm     ENDM
0000180C  E18E                    3700m     LSL.L #8, D6
0000180E  E18E                    3701m     LSL.L #8, D6
00001810                          3702mm     READ_16 #IDE_DATA_REGISTER, D6, D1
00001810  13FC 0000 00A00007      3703mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001818  13FC 0000 00A00005      3704mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001820                          3705mm     
00001820  123C 0030               3706mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001824  0001 0000               3707mm     ORI.B #IDE_DATA_REGISTER, D1
00001828  13C1 00A00019           3708mm     MOVE.B D1, MC68230_PORT_C_DATA
0000182E  0201 00DF               3709mm     ANDI.B #~MC68230_PORT_C_READ, D1
00001832  13C1 00A00019           3710mm     MOVE.B D1, MC68230_PORT_C_DATA
00001838  1C39 00A00011           3711mm     MOVE.B MC68230_PORT_A_DATA, D6
0000183E  E14E                    3712mm     LSL.W #8, D6
00001840  1C39 00A00013           3713mm     MOVE.B MC68230_PORT_B_DATA, D6
00001846  0001 0020               3714mm     ORI.B #MC68230_PORT_C_READ, D1
0000184A  13C1 00A00019           3715mm     MOVE.B D1, MC68230_PORT_C_DATA
00001850  13FC 0038 00A00019      3716mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001858                          3717mm     ENDM
00001858                          3718m     ENDM
00001858  5484                    3719              ADD.L #2, D4
0000185A                          3720              
0000185A                          3721              FOR D6 = #0 TO #5 DO
0000185A  3C3C 0000               3722s     MOVE.W  #0,D6
0000185E  6000 00F2               3723s     BRA _20000015
00001862                          3724s _20000014
00001862                          3725m                 READ_32 #IDE_DATA_REGISTER, D7, D1
00001862                          3726mm     READ_16 #IDE_DATA_REGISTER, D7, D1
00001862  13FC 0000 00A00007      3727mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
0000186A  13FC 0000 00A00005      3728mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001872                          3729mm     
00001872  123C 0030               3730mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001876  0001 0000               3731mm     ORI.B #IDE_DATA_REGISTER, D1
0000187A  13C1 00A00019           3732mm     MOVE.B D1, MC68230_PORT_C_DATA
00001880  0201 00DF               3733mm     ANDI.B #~MC68230_PORT_C_READ, D1
00001884  13C1 00A00019           3734mm     MOVE.B D1, MC68230_PORT_C_DATA
0000188A  1E39 00A00011           3735mm     MOVE.B MC68230_PORT_A_DATA, D7
00001890  E14F                    3736mm     LSL.W #8, D7
00001892  1E39 00A00013           3737mm     MOVE.B MC68230_PORT_B_DATA, D7
00001898  0001 0020               3738mm     ORI.B #MC68230_PORT_C_READ, D1
0000189C  13C1 00A00019           3739mm     MOVE.B D1, MC68230_PORT_C_DATA
000018A2  13FC 0038 00A00019      3740mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000018AA                          3741mm     ENDM
000018AA  E18F                    3742m     LSL.L #8, D7
000018AC  E18F                    3743m     LSL.L #8, D7
000018AE                          3744mm     READ_16 #IDE_DATA_REGISTER, D7, D1
000018AE  13FC 0000 00A00007      3745mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
000018B6  13FC 0000 00A00005      3746mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
000018BE                          3747mm     
000018BE  123C 0030               3748mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
000018C2  0001 0000               3749mm     ORI.B #IDE_DATA_REGISTER, D1
000018C6  13C1 00A00019           3750mm     MOVE.B D1, MC68230_PORT_C_DATA
000018CC  0201 00DF               3751mm     ANDI.B #~MC68230_PORT_C_READ, D1
000018D0  13C1 00A00019           3752mm     MOVE.B D1, MC68230_PORT_C_DATA
000018D6  1E39 00A00011           3753mm     MOVE.B MC68230_PORT_A_DATA, D7
000018DC  E14F                    3754mm     LSL.W #8, D7
000018DE  1E39 00A00013           3755mm     MOVE.B MC68230_PORT_B_DATA, D7
000018E4  0001 0020               3756mm     ORI.B #MC68230_PORT_C_READ, D1
000018E8  13C1 00A00019           3757mm     MOVE.B D1, MC68230_PORT_C_DATA
000018EE  13FC 0038 00A00019      3758mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000018F6                          3759mm     ENDM
000018F6                          3760m     ENDM
000018F6  5484                    3761                  ADD.L #2, D4
000018F8                          3762                              
000018F8                          3763                  IF D5 <NE> #1 THEN
000018F8  BA7C 0001               3764s     CMP.W   #1,D5
000018FC  6700 0052               3765s     BEQ _00000016
00001900  E19F                    3766                      ROL.l #8,D7                 
00001902                          3767m                     PRINT_CHAR D7, D1
00001902                          3768m WAIT_FOR_READY_272                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001902                 TRUE     3769m     IFEQ DEBUG
00001902  1239 00C00003           3770m         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001908  0801 0002               3771m         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
0000190C  67F4                    3772m         BEQ WAIT_FOR_READY_272                      ; NO SPACE, CHECK AGAIN
0000190E  13C7 00C00007           3773m         MOVE.B D7,DUART_TXA                         ; SEND THE NEXT CHARACTER
00001914                          3774m     ENDC
00001914                          3775m 
00001914                 FALSE    3776m     IFNE DEBUG
00001914                          3777m     ENDC
00001914                          3778m 
00001914                          3779m     ENDM
00001914  E19F                    3780                      ROL.l #8,D7                 
00001916                          3781m                     PRINT_CHAR D7, D1
00001916                          3782m WAIT_FOR_READY_273                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001916                 TRUE     3783m     IFEQ DEBUG
00001916  1239 00C00003           3784m         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
0000191C  0801 0002               3785m         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001920  67F4                    3786m         BEQ WAIT_FOR_READY_273                      ; NO SPACE, CHECK AGAIN
00001922  13C7 00C00007           3787m         MOVE.B D7,DUART_TXA                         ; SEND THE NEXT CHARACTER
00001928                          3788m     ENDC
00001928                          3789m 
00001928                 FALSE    3790m     IFNE DEBUG
00001928                          3791m     ENDC
00001928                          3792m 
00001928                          3793m     ENDM
00001928  E19F                    3794                      ROL.l #8,D7                 
0000192A                          3795m                     PRINT_CHAR D7, D1
0000192A                          3796m WAIT_FOR_READY_274                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000192A                 TRUE     3797m     IFEQ DEBUG
0000192A  1239 00C00003           3798m         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001930  0801 0002               3799m         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001934  67F4                    3800m         BEQ WAIT_FOR_READY_274                      ; NO SPACE, CHECK AGAIN
00001936  13C7 00C00007           3801m         MOVE.B D7,DUART_TXA                         ; SEND THE NEXT CHARACTER
0000193C                          3802m     ENDC
0000193C                          3803m 
0000193C                 FALSE    3804m     IFNE DEBUG
0000193C                          3805m     ENDC
0000193C                          3806m 
0000193C                          3807m     ENDM
0000193C  E19F                    3808                      ROL.l #8,D7                 
0000193E                          3809m                     PRINT_CHAR D7, D1
0000193E                          3810m WAIT_FOR_READY_275                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000193E                 TRUE     3811m     IFEQ DEBUG
0000193E  1239 00C00003           3812m         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001944  0801 0002               3813m         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001948  67F4                    3814m         BEQ WAIT_FOR_READY_275                      ; NO SPACE, CHECK AGAIN
0000194A  13C7 00C00007           3815m         MOVE.B D7,DUART_TXA                         ; SEND THE NEXT CHARACTER
00001950                          3816m     ENDC
00001950                          3817m 
00001950                 FALSE    3818m     IFNE DEBUG
00001950                          3819m     ENDC
00001950                          3820m 
00001950                          3821m     ENDM
00001950                          3822                  ENDI
00001950                          3823s _00000016
00001950                          3824              ENDF
00001950  5246                    3825s     ADD.W   #1,D6
00001952                          3826s _20000015
00001952  BC7C 0005               3827s     CMP.W   #5,D6
00001956  6F00 FF0A               3828s     BLE _20000014
0000195A                          3829  
0000195A                          3830m             READ_32 #IDE_DATA_REGISTER, D6, D1  ; skip index
0000195A                          3831mm     READ_16 #IDE_DATA_REGISTER, D6, D1
0000195A  13FC 0000 00A00007      3832mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001962  13FC 0000 00A00005      3833mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
0000196A                          3834mm     
0000196A  123C 0030               3835mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
0000196E  0001 0000               3836mm     ORI.B #IDE_DATA_REGISTER, D1
00001972  13C1 00A00019           3837mm     MOVE.B D1, MC68230_PORT_C_DATA
00001978  0201 00DF               3838mm     ANDI.B #~MC68230_PORT_C_READ, D1
0000197C  13C1 00A00019           3839mm     MOVE.B D1, MC68230_PORT_C_DATA
00001982  1C39 00A00011           3840mm     MOVE.B MC68230_PORT_A_DATA, D6
00001988  E14E                    3841mm     LSL.W #8, D6
0000198A  1C39 00A00013           3842mm     MOVE.B MC68230_PORT_B_DATA, D6
00001990  0001 0020               3843mm     ORI.B #MC68230_PORT_C_READ, D1
00001994  13C1 00A00019           3844mm     MOVE.B D1, MC68230_PORT_C_DATA
0000199A  13FC 0038 00A00019      3845mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000019A2                          3846mm     ENDM
000019A2  E18E                    3847m     LSL.L #8, D6
000019A4  E18E                    3848m     LSL.L #8, D6
000019A6                          3849mm     READ_16 #IDE_DATA_REGISTER, D6, D1
000019A6  13FC 0000 00A00007      3850mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
000019AE  13FC 0000 00A00005      3851mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
000019B6                          3852mm     
000019B6  123C 0030               3853mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
000019BA  0001 0000               3854mm     ORI.B #IDE_DATA_REGISTER, D1
000019BE  13C1 00A00019           3855mm     MOVE.B D1, MC68230_PORT_C_DATA
000019C4  0201 00DF               3856mm     ANDI.B #~MC68230_PORT_C_READ, D1
000019C8  13C1 00A00019           3857mm     MOVE.B D1, MC68230_PORT_C_DATA
000019CE  1C39 00A00011           3858mm     MOVE.B MC68230_PORT_A_DATA, D6
000019D4  E14E                    3859mm     LSL.W #8, D6
000019D6  1C39 00A00013           3860mm     MOVE.B MC68230_PORT_B_DATA, D6
000019DC  0001 0020               3861mm     ORI.B #MC68230_PORT_C_READ, D1
000019E0  13C1 00A00019           3862mm     MOVE.B D1, MC68230_PORT_C_DATA
000019E6  13FC 0038 00A00019      3863mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000019EE                          3864mm     ENDM
000019EE                          3865m     ENDM
000019EE  5484                    3866              ADD.L #2, D4
000019F0                          3867m             READ_32 #IDE_DATA_REGISTER, D6, D1  ; skip length
000019F0                          3868mm     READ_16 #IDE_DATA_REGISTER, D6, D1
000019F0  13FC 0000 00A00007      3869mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
000019F8  13FC 0000 00A00005      3870mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001A00                          3871mm     
00001A00  123C 0030               3872mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001A04  0001 0000               3873mm     ORI.B #IDE_DATA_REGISTER, D1
00001A08  13C1 00A00019           3874mm     MOVE.B D1, MC68230_PORT_C_DATA
00001A0E  0201 00DF               3875mm     ANDI.B #~MC68230_PORT_C_READ, D1
00001A12  13C1 00A00019           3876mm     MOVE.B D1, MC68230_PORT_C_DATA
00001A18  1C39 00A00011           3877mm     MOVE.B MC68230_PORT_A_DATA, D6
00001A1E  E14E                    3878mm     LSL.W #8, D6
00001A20  1C39 00A00013           3879mm     MOVE.B MC68230_PORT_B_DATA, D6
00001A26  0001 0020               3880mm     ORI.B #MC68230_PORT_C_READ, D1
00001A2A  13C1 00A00019           3881mm     MOVE.B D1, MC68230_PORT_C_DATA
00001A30  13FC 0038 00A00019      3882mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001A38                          3883mm     ENDM
00001A38  E18E                    3884m     LSL.L #8, D6
00001A3A  E18E                    3885m     LSL.L #8, D6
00001A3C                          3886mm     READ_16 #IDE_DATA_REGISTER, D6, D1
00001A3C  13FC 0000 00A00007      3887mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001A44  13FC 0000 00A00005      3888mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001A4C                          3889mm     
00001A4C  123C 0030               3890mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001A50  0001 0000               3891mm     ORI.B #IDE_DATA_REGISTER, D1
00001A54  13C1 00A00019           3892mm     MOVE.B D1, MC68230_PORT_C_DATA
00001A5A  0201 00DF               3893mm     ANDI.B #~MC68230_PORT_C_READ, D1
00001A5E  13C1 00A00019           3894mm     MOVE.B D1, MC68230_PORT_C_DATA
00001A64  1C39 00A00011           3895mm     MOVE.B MC68230_PORT_A_DATA, D6
00001A6A  E14E                    3896mm     LSL.W #8, D6
00001A6C  1C39 00A00013           3897mm     MOVE.B MC68230_PORT_B_DATA, D6
00001A72  0001 0020               3898mm     ORI.B #MC68230_PORT_C_READ, D1
00001A76  13C1 00A00019           3899mm     MOVE.B D1, MC68230_PORT_C_DATA
00001A7C  13FC 0038 00A00019      3900mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001A84                          3901mm     ENDM
00001A84                          3902m     ENDM
00001A84  5484                    3903              ADD.L #2, D4
00001A86                          3904  
00001A86                          3905              IF D5 <NE> #1 THEN
00001A86  BA7C 0001               3906s     CMP.W   #1,D5
00001A8A  6700 006C               3907s     BEQ _00000017
00001A8E  41FA 0D53               3908                  LEA INDEX_SEP(PC),A0
00001A92                          3909m                 PRINT_STR A0,D1
00001A92                          3910m LOOP_282
00001A92  0C10 0000               3911m     CMP.B #NULL,(A0)                                ; 0 -> DONE
00001A96  6700 0016               3912m     BEQ EXIT_282
00001A9A                          3913mm     PRINT_CHAR (A0)+,D1
00001A9A                          3914mm WAIT_FOR_READY_283                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001A9A                 TRUE     3915mm     IFEQ DEBUG
00001A9A  1239 00C00003           3916mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001AA0  0801 0002               3917mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001AA4  67F4                    3918mm         BEQ WAIT_FOR_READY_283                      ; NO SPACE, CHECK AGAIN
00001AA6  13D8 00C00007           3919mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00001AAC                          3920mm     ENDC
00001AAC                          3921mm 
00001AAC                 FALSE    3922mm     IFNE DEBUG
00001AAC                          3923mm     ENDC
00001AAC                          3924mm 
00001AAC                          3925mm     ENDM
00001AAC  60E4                    3926m     BRA LOOP_282
00001AAE                          3927m EXIT_282
00001AAE                          3928m     ENDM
00001AAE                          3929m                 PRINT_REG D6,D1,D0,D7,A0
00001AAE  41FA 0D1B               3930m     LEA OX(PC),A0
00001AB2                          3931mm     PRINT_STR A0,D1
00001AB2                          3932mm LOOP_285
00001AB2  0C10 0000               3933mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
00001AB6  6700 0016               3934mm     BEQ EXIT_285
00001ABA                          3935mmm     PRINT_CHAR (A0)+,D1
00001ABA                          3936mmm WAIT_FOR_READY_286                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001ABA                 TRUE     3937mmm     IFEQ DEBUG
00001ABA  1239 00C00003           3938mmm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001AC0  0801 0002               3939mmm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001AC4  67F4                    3940mmm         BEQ WAIT_FOR_READY_286                      ; NO SPACE, CHECK AGAIN
00001AC6  13D8 00C00007           3941mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00001ACC                          3942mmm     ENDC
00001ACC                          3943mmm 
00001ACC                 FALSE    3944mmm     IFNE DEBUG
00001ACC                          3945mmm     ENDC
00001ACC                          3946mmm 
00001ACC                          3947mmm     ENDM
00001ACC  60E4                    3948mm     BRA LOOP_285
00001ACE                          3949mm EXIT_285
00001ACE                          3950mm     ENDM
00001ACE  7E07                    3951m     MOVE.L #7,D7                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00001AD0                          3952m LOOP_284
00001AD0                          3953mm     BIN2HEX D6,D0,A0
00001AD0  41FA 0CB8               3954mm     LEA BIN2HEX_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
00001AD4  E99E                    3955mm     ROL.L #4,D6                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00001AD6  1006                    3956mm     MOVE.B D6,D0
00001AD8  0280 0000000F           3957mm     ANDI.L #$F,D0
00001ADE  1030 0000               3958mm     MOVE.B 0(A0,D0),D0                              ; USE THAT AS AN INDEX INTO THE LUT
00001AE2                          3959mm     ENDM
00001AE2                          3960mm     PRINT_CHAR D0,D1
00001AE2                          3961mm WAIT_FOR_READY_288                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001AE2                 TRUE     3962mm     IFEQ DEBUG
00001AE2  1239 00C00003           3963mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001AE8  0801 0002               3964mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001AEC  67F4                    3965mm         BEQ WAIT_FOR_READY_288                      ; NO SPACE, CHECK AGAIN
00001AEE  13C0 00C00007           3966mm         MOVE.B D0,DUART_TXA                         ; SEND THE NEXT CHARACTER
00001AF4                          3967mm     ENDC
00001AF4                          3968mm 
00001AF4                 FALSE    3969mm     IFNE DEBUG
00001AF4                          3970mm     ENDC
00001AF4                          3971mm 
00001AF4                          3972mm     ENDM
00001AF4  57CF FFDA               3973m     DBEQ D7,LOOP_284
00001AF8                          3974m     ENDM
00001AF8                          3975              ENDI
00001AF8                          3976s _00000017
00001AF8                          3977              
00001AF8                          3978m             READ_32 #IDE_DATA_REGISTER, D6, D1  ; skip load address
00001AF8                          3979mm     READ_16 #IDE_DATA_REGISTER, D6, D1
00001AF8  13FC 0000 00A00007      3980mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001B00  13FC 0000 00A00005      3981mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001B08                          3982mm     
00001B08  123C 0030               3983mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001B0C  0001 0000               3984mm     ORI.B #IDE_DATA_REGISTER, D1
00001B10  13C1 00A00019           3985mm     MOVE.B D1, MC68230_PORT_C_DATA
00001B16  0201 00DF               3986mm     ANDI.B #~MC68230_PORT_C_READ, D1
00001B1A  13C1 00A00019           3987mm     MOVE.B D1, MC68230_PORT_C_DATA
00001B20  1C39 00A00011           3988mm     MOVE.B MC68230_PORT_A_DATA, D6
00001B26  E14E                    3989mm     LSL.W #8, D6
00001B28  1C39 00A00013           3990mm     MOVE.B MC68230_PORT_B_DATA, D6
00001B2E  0001 0020               3991mm     ORI.B #MC68230_PORT_C_READ, D1
00001B32  13C1 00A00019           3992mm     MOVE.B D1, MC68230_PORT_C_DATA
00001B38  13FC 0038 00A00019      3993mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001B40                          3994mm     ENDM
00001B40  E18E                    3995m     LSL.L #8, D6
00001B42  E18E                    3996m     LSL.L #8, D6
00001B44                          3997mm     READ_16 #IDE_DATA_REGISTER, D6, D1
00001B44  13FC 0000 00A00007      3998mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001B4C  13FC 0000 00A00005      3999mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001B54                          4000mm     
00001B54  123C 0030               4001mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001B58  0001 0000               4002mm     ORI.B #IDE_DATA_REGISTER, D1
00001B5C  13C1 00A00019           4003mm     MOVE.B D1, MC68230_PORT_C_DATA
00001B62  0201 00DF               4004mm     ANDI.B #~MC68230_PORT_C_READ, D1
00001B66  13C1 00A00019           4005mm     MOVE.B D1, MC68230_PORT_C_DATA
00001B6C  1C39 00A00011           4006mm     MOVE.B MC68230_PORT_A_DATA, D6
00001B72  E14E                    4007mm     LSL.W #8, D6
00001B74  1C39 00A00013           4008mm     MOVE.B MC68230_PORT_B_DATA, D6
00001B7A  0001 0020               4009mm     ORI.B #MC68230_PORT_C_READ, D1
00001B7E  13C1 00A00019           4010mm     MOVE.B D1, MC68230_PORT_C_DATA
00001B84  13FC 0038 00A00019      4011mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001B8C                          4012mm     ENDM
00001B8C                          4013m     ENDM
00001B8C  5484                    4014              ADD.L #2, D4
00001B8E                          4015              IF D5 <NE> #1 THEN
00001B8E  BA7C 0001               4016s     CMP.W   #1,D5
00001B92  6700 006C               4017s     BEQ _00000018
00001B96  41FA 0C4B               4018                  LEA INDEX_SEP(PC),A0
00001B9A                          4019m                 PRINT_STR A0,D1
00001B9A                          4020m LOOP_292
00001B9A  0C10 0000               4021m     CMP.B #NULL,(A0)                                ; 0 -> DONE
00001B9E  6700 0016               4022m     BEQ EXIT_292
00001BA2                          4023mm     PRINT_CHAR (A0)+,D1
00001BA2                          4024mm WAIT_FOR_READY_293                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001BA2                 TRUE     4025mm     IFEQ DEBUG
00001BA2  1239 00C00003           4026mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001BA8  0801 0002               4027mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001BAC  67F4                    4028mm         BEQ WAIT_FOR_READY_293                      ; NO SPACE, CHECK AGAIN
00001BAE  13D8 00C00007           4029mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00001BB4                          4030mm     ENDC
00001BB4                          4031mm 
00001BB4                 FALSE    4032mm     IFNE DEBUG
00001BB4                          4033mm     ENDC
00001BB4                          4034mm 
00001BB4                          4035mm     ENDM
00001BB4  60E4                    4036m     BRA LOOP_292
00001BB6                          4037m EXIT_292
00001BB6                          4038m     ENDM
00001BB6                          4039m                 PRINT_REG D6,D1,D0,D7,A0
00001BB6  41FA 0C13               4040m     LEA OX(PC),A0
00001BBA                          4041mm     PRINT_STR A0,D1
00001BBA                          4042mm LOOP_295
00001BBA  0C10 0000               4043mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
00001BBE  6700 0016               4044mm     BEQ EXIT_295
00001BC2                          4045mmm     PRINT_CHAR (A0)+,D1
00001BC2                          4046mmm WAIT_FOR_READY_296                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001BC2                 TRUE     4047mmm     IFEQ DEBUG
00001BC2  1239 00C00003           4048mmm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001BC8  0801 0002               4049mmm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001BCC  67F4                    4050mmm         BEQ WAIT_FOR_READY_296                      ; NO SPACE, CHECK AGAIN
00001BCE  13D8 00C00007           4051mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00001BD4                          4052mmm     ENDC
00001BD4                          4053mmm 
00001BD4                 FALSE    4054mmm     IFNE DEBUG
00001BD4                          4055mmm     ENDC
00001BD4                          4056mmm 
00001BD4                          4057mmm     ENDM
00001BD4  60E4                    4058mm     BRA LOOP_295
00001BD6                          4059mm EXIT_295
00001BD6                          4060mm     ENDM
00001BD6  7E07                    4061m     MOVE.L #7,D7                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00001BD8                          4062m LOOP_294
00001BD8                          4063mm     BIN2HEX D6,D0,A0
00001BD8  41FA 0BB0               4064mm     LEA BIN2HEX_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
00001BDC  E99E                    4065mm     ROL.L #4,D6                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00001BDE  1006                    4066mm     MOVE.B D6,D0
00001BE0  0280 0000000F           4067mm     ANDI.L #$F,D0
00001BE6  1030 0000               4068mm     MOVE.B 0(A0,D0),D0                              ; USE THAT AS AN INDEX INTO THE LUT
00001BEA                          4069mm     ENDM
00001BEA                          4070mm     PRINT_CHAR D0,D1
00001BEA                          4071mm WAIT_FOR_READY_298                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001BEA                 TRUE     4072mm     IFEQ DEBUG
00001BEA  1239 00C00003           4073mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001BF0  0801 0002               4074mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001BF4  67F4                    4075mm         BEQ WAIT_FOR_READY_298                      ; NO SPACE, CHECK AGAIN
00001BF6  13C0 00C00007           4076mm         MOVE.B D0,DUART_TXA                         ; SEND THE NEXT CHARACTER
00001BFC                          4077mm     ENDC
00001BFC                          4078mm 
00001BFC                 FALSE    4079mm     IFNE DEBUG
00001BFC                          4080mm     ENDC
00001BFC                          4081mm 
00001BFC                          4082mm     ENDM
00001BFC  57CF FFDA               4083m     DBEQ D7,LOOP_294
00001C00                          4084m     ENDM
00001C00                          4085              ENDI
00001C00                          4086s _00000018
00001C00                          4087  
00001C00                          4088m             READ_32 #IDE_DATA_REGISTER, D6, D1  ; skip go address
00001C00                          4089mm     READ_16 #IDE_DATA_REGISTER, D6, D1
00001C00  13FC 0000 00A00007      4090mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001C08  13FC 0000 00A00005      4091mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001C10                          4092mm     
00001C10  123C 0030               4093mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001C14  0001 0000               4094mm     ORI.B #IDE_DATA_REGISTER, D1
00001C18  13C1 00A00019           4095mm     MOVE.B D1, MC68230_PORT_C_DATA
00001C1E  0201 00DF               4096mm     ANDI.B #~MC68230_PORT_C_READ, D1
00001C22  13C1 00A00019           4097mm     MOVE.B D1, MC68230_PORT_C_DATA
00001C28  1C39 00A00011           4098mm     MOVE.B MC68230_PORT_A_DATA, D6
00001C2E  E14E                    4099mm     LSL.W #8, D6
00001C30  1C39 00A00013           4100mm     MOVE.B MC68230_PORT_B_DATA, D6
00001C36  0001 0020               4101mm     ORI.B #MC68230_PORT_C_READ, D1
00001C3A  13C1 00A00019           4102mm     MOVE.B D1, MC68230_PORT_C_DATA
00001C40  13FC 0038 00A00019      4103mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001C48                          4104mm     ENDM
00001C48  E18E                    4105m     LSL.L #8, D6
00001C4A  E18E                    4106m     LSL.L #8, D6
00001C4C                          4107mm     READ_16 #IDE_DATA_REGISTER, D6, D1
00001C4C  13FC 0000 00A00007      4108mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001C54  13FC 0000 00A00005      4109mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001C5C                          4110mm     
00001C5C  123C 0030               4111mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001C60  0001 0000               4112mm     ORI.B #IDE_DATA_REGISTER, D1
00001C64  13C1 00A00019           4113mm     MOVE.B D1, MC68230_PORT_C_DATA
00001C6A  0201 00DF               4114mm     ANDI.B #~MC68230_PORT_C_READ, D1
00001C6E  13C1 00A00019           4115mm     MOVE.B D1, MC68230_PORT_C_DATA
00001C74  1C39 00A00011           4116mm     MOVE.B MC68230_PORT_A_DATA, D6
00001C7A  E14E                    4117mm     LSL.W #8, D6
00001C7C  1C39 00A00013           4118mm     MOVE.B MC68230_PORT_B_DATA, D6
00001C82  0001 0020               4119mm     ORI.B #MC68230_PORT_C_READ, D1
00001C86  13C1 00A00019           4120mm     MOVE.B D1, MC68230_PORT_C_DATA
00001C8C  13FC 0038 00A00019      4121mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001C94                          4122mm     ENDM
00001C94                          4123m     ENDM
00001C94  5484                    4124              ADD.L #2, D4        
00001C96                          4125              IF D5 <NE> #1 THEN
00001C96  BA7C 0001               4126s     CMP.W   #1,D5
00001C9A  6700 006C               4127s     BEQ _00000019
00001C9E  41FA 0B43               4128                  LEA INDEX_SEP(PC),A0
00001CA2                          4129m                 PRINT_STR A0,D1
00001CA2                          4130m LOOP_302
00001CA2  0C10 0000               4131m     CMP.B #NULL,(A0)                                ; 0 -> DONE
00001CA6  6700 0016               4132m     BEQ EXIT_302
00001CAA                          4133mm     PRINT_CHAR (A0)+,D1
00001CAA                          4134mm WAIT_FOR_READY_303                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001CAA                 TRUE     4135mm     IFEQ DEBUG
00001CAA  1239 00C00003           4136mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001CB0  0801 0002               4137mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001CB4  67F4                    4138mm         BEQ WAIT_FOR_READY_303                      ; NO SPACE, CHECK AGAIN
00001CB6  13D8 00C00007           4139mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00001CBC                          4140mm     ENDC
00001CBC                          4141mm 
00001CBC                 FALSE    4142mm     IFNE DEBUG
00001CBC                          4143mm     ENDC
00001CBC                          4144mm 
00001CBC                          4145mm     ENDM
00001CBC  60E4                    4146m     BRA LOOP_302
00001CBE                          4147m EXIT_302
00001CBE                          4148m     ENDM
00001CBE                          4149m                 PRINT_REG D6,D1,D0,D7,A0
00001CBE  41FA 0B0B               4150m     LEA OX(PC),A0
00001CC2                          4151mm     PRINT_STR A0,D1
00001CC2                          4152mm LOOP_305
00001CC2  0C10 0000               4153mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
00001CC6  6700 0016               4154mm     BEQ EXIT_305
00001CCA                          4155mmm     PRINT_CHAR (A0)+,D1
00001CCA                          4156mmm WAIT_FOR_READY_306                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001CCA                 TRUE     4157mmm     IFEQ DEBUG
00001CCA  1239 00C00003           4158mmm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001CD0  0801 0002               4159mmm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001CD4  67F4                    4160mmm         BEQ WAIT_FOR_READY_306                      ; NO SPACE, CHECK AGAIN
00001CD6  13D8 00C00007           4161mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00001CDC                          4162mmm     ENDC
00001CDC                          4163mmm 
00001CDC                 FALSE    4164mmm     IFNE DEBUG
00001CDC                          4165mmm     ENDC
00001CDC                          4166mmm 
00001CDC                          4167mmm     ENDM
00001CDC  60E4                    4168mm     BRA LOOP_305
00001CDE                          4169mm EXIT_305
00001CDE                          4170mm     ENDM
00001CDE  7E07                    4171m     MOVE.L #7,D7                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00001CE0                          4172m LOOP_304
00001CE0                          4173mm     BIN2HEX D6,D0,A0
00001CE0  41FA 0AA8               4174mm     LEA BIN2HEX_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
00001CE4  E99E                    4175mm     ROL.L #4,D6                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00001CE6  1006                    4176mm     MOVE.B D6,D0
00001CE8  0280 0000000F           4177mm     ANDI.L #$F,D0
00001CEE  1030 0000               4178mm     MOVE.B 0(A0,D0),D0                              ; USE THAT AS AN INDEX INTO THE LUT
00001CF2                          4179mm     ENDM
00001CF2                          4180mm     PRINT_CHAR D0,D1
00001CF2                          4181mm WAIT_FOR_READY_308                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001CF2                 TRUE     4182mm     IFEQ DEBUG
00001CF2  1239 00C00003           4183mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001CF8  0801 0002               4184mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001CFC  67F4                    4185mm         BEQ WAIT_FOR_READY_308                      ; NO SPACE, CHECK AGAIN
00001CFE  13C0 00C00007           4186mm         MOVE.B D0,DUART_TXA                         ; SEND THE NEXT CHARACTER
00001D04                          4187mm     ENDC
00001D04                          4188mm 
00001D04                 FALSE    4189mm     IFNE DEBUG
00001D04                          4190mm     ENDC
00001D04                          4191mm 
00001D04                          4192mm     ENDM
00001D04  57CF FFDA               4193m     DBEQ D7,LOOP_304
00001D08                          4194m     ENDM
00001D08                          4195              ENDI
00001D08                          4196s _00000019
00001D08                          4197  
00001D08                          4198m             READ_32 #IDE_DATA_REGISTER, D6, D1  ; skip start block
00001D08                          4199mm     READ_16 #IDE_DATA_REGISTER, D6, D1
00001D08  13FC 0000 00A00007      4200mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001D10  13FC 0000 00A00005      4201mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001D18                          4202mm     
00001D18  123C 0030               4203mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001D1C  0001 0000               4204mm     ORI.B #IDE_DATA_REGISTER, D1
00001D20  13C1 00A00019           4205mm     MOVE.B D1, MC68230_PORT_C_DATA
00001D26  0201 00DF               4206mm     ANDI.B #~MC68230_PORT_C_READ, D1
00001D2A  13C1 00A00019           4207mm     MOVE.B D1, MC68230_PORT_C_DATA
00001D30  1C39 00A00011           4208mm     MOVE.B MC68230_PORT_A_DATA, D6
00001D36  E14E                    4209mm     LSL.W #8, D6
00001D38  1C39 00A00013           4210mm     MOVE.B MC68230_PORT_B_DATA, D6
00001D3E  0001 0020               4211mm     ORI.B #MC68230_PORT_C_READ, D1
00001D42  13C1 00A00019           4212mm     MOVE.B D1, MC68230_PORT_C_DATA
00001D48  13FC 0038 00A00019      4213mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001D50                          4214mm     ENDM
00001D50  E18E                    4215m     LSL.L #8, D6
00001D52  E18E                    4216m     LSL.L #8, D6
00001D54                          4217mm     READ_16 #IDE_DATA_REGISTER, D6, D1
00001D54  13FC 0000 00A00007      4218mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001D5C  13FC 0000 00A00005      4219mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001D64                          4220mm     
00001D64  123C 0030               4221mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001D68  0001 0000               4222mm     ORI.B #IDE_DATA_REGISTER, D1
00001D6C  13C1 00A00019           4223mm     MOVE.B D1, MC68230_PORT_C_DATA
00001D72  0201 00DF               4224mm     ANDI.B #~MC68230_PORT_C_READ, D1
00001D76  13C1 00A00019           4225mm     MOVE.B D1, MC68230_PORT_C_DATA
00001D7C  1C39 00A00011           4226mm     MOVE.B MC68230_PORT_A_DATA, D6
00001D82  E14E                    4227mm     LSL.W #8, D6
00001D84  1C39 00A00013           4228mm     MOVE.B MC68230_PORT_B_DATA, D6
00001D8A  0001 0020               4229mm     ORI.B #MC68230_PORT_C_READ, D1
00001D8E  13C1 00A00019           4230mm     MOVE.B D1, MC68230_PORT_C_DATA
00001D94  13FC 0038 00A00019      4231mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001D9C                          4232mm     ENDM
00001D9C                          4233m     ENDM
00001D9C  5484                    4234              ADD.L #2, D4        
00001D9E                          4235              IF D5 <NE> #1 THEN
00001D9E  BA7C 0001               4236s     CMP.W   #1,D5
00001DA2  6700 008C               4237s     BEQ _0000001A
00001DA6  41FA 0A3B               4238                  LEA INDEX_SEP(PC),A0
00001DAA                          4239m                 PRINT_STR A0,D1
00001DAA                          4240m LOOP_312
00001DAA  0C10 0000               4241m     CMP.B #NULL,(A0)                                ; 0 -> DONE
00001DAE  6700 0016               4242m     BEQ EXIT_312
00001DB2                          4243mm     PRINT_CHAR (A0)+,D1
00001DB2                          4244mm WAIT_FOR_READY_313                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001DB2                 TRUE     4245mm     IFEQ DEBUG
00001DB2  1239 00C00003           4246mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001DB8  0801 0002               4247mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001DBC  67F4                    4248mm         BEQ WAIT_FOR_READY_313                      ; NO SPACE, CHECK AGAIN
00001DBE  13D8 00C00007           4249mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00001DC4                          4250mm     ENDC
00001DC4                          4251mm 
00001DC4                 FALSE    4252mm     IFNE DEBUG
00001DC4                          4253mm     ENDC
00001DC4                          4254mm 
00001DC4                          4255mm     ENDM
00001DC4  60E4                    4256m     BRA LOOP_312
00001DC6                          4257m EXIT_312
00001DC6                          4258m     ENDM
00001DC6                          4259m                 PRINT_REG D6,D1,D0,D7,A0
00001DC6  41FA 0A03               4260m     LEA OX(PC),A0
00001DCA                          4261mm     PRINT_STR A0,D1
00001DCA                          4262mm LOOP_315
00001DCA  0C10 0000               4263mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
00001DCE  6700 0016               4264mm     BEQ EXIT_315
00001DD2                          4265mmm     PRINT_CHAR (A0)+,D1
00001DD2                          4266mmm WAIT_FOR_READY_316                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001DD2                 TRUE     4267mmm     IFEQ DEBUG
00001DD2  1239 00C00003           4268mmm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001DD8  0801 0002               4269mmm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001DDC  67F4                    4270mmm         BEQ WAIT_FOR_READY_316                      ; NO SPACE, CHECK AGAIN
00001DDE  13D8 00C00007           4271mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00001DE4                          4272mmm     ENDC
00001DE4                          4273mmm 
00001DE4                 FALSE    4274mmm     IFNE DEBUG
00001DE4                          4275mmm     ENDC
00001DE4                          4276mmm 
00001DE4                          4277mmm     ENDM
00001DE4  60E4                    4278mm     BRA LOOP_315
00001DE6                          4279mm EXIT_315
00001DE6                          4280mm     ENDM
00001DE6  7E07                    4281m     MOVE.L #7,D7                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00001DE8                          4282m LOOP_314
00001DE8                          4283mm     BIN2HEX D6,D0,A0
00001DE8  41FA 09A0               4284mm     LEA BIN2HEX_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
00001DEC  E99E                    4285mm     ROL.L #4,D6                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
00001DEE  1006                    4286mm     MOVE.B D6,D0
00001DF0  0280 0000000F           4287mm     ANDI.L #$F,D0
00001DF6  1030 0000               4288mm     MOVE.B 0(A0,D0),D0                              ; USE THAT AS AN INDEX INTO THE LUT
00001DFA                          4289mm     ENDM
00001DFA                          4290mm     PRINT_CHAR D0,D1
00001DFA                          4291mm WAIT_FOR_READY_318                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001DFA                 TRUE     4292mm     IFEQ DEBUG
00001DFA  1239 00C00003           4293mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001E00  0801 0002               4294mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001E04  67F4                    4295mm         BEQ WAIT_FOR_READY_318                      ; NO SPACE, CHECK AGAIN
00001E06  13C0 00C00007           4296mm         MOVE.B D0,DUART_TXA                         ; SEND THE NEXT CHARACTER
00001E0C                          4297mm     ENDC
00001E0C                          4298mm 
00001E0C                 FALSE    4299mm     IFNE DEBUG
00001E0C                          4300mm     ENDC
00001E0C                          4301mm 
00001E0C                          4302mm     ENDM
00001E0C  57CF FFDA               4303m     DBEQ D7,LOOP_314
00001E10                          4304m     ENDM
00001E10                          4305m                 PRINT_CRLF D1,A1
00001E10  43FA 09B3               4306m     LEA CRLF(PC),A1
00001E14                          4307mm     PRINT_STR A1,D1
00001E14                          4308mm LOOP_320
00001E14  0C11 0000               4309mm     CMP.B #NULL,(A1)                                ; 0 -> DONE
00001E18  6700 0016               4310mm     BEQ EXIT_320
00001E1C                          4311mmm     PRINT_CHAR (A1)+,D1
00001E1C                          4312mmm WAIT_FOR_READY_321                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00001E1C                 TRUE     4313mmm     IFEQ DEBUG
00001E1C  1239 00C00003           4314mmm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00001E22  0801 0002               4315mmm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00001E26  67F4                    4316mmm         BEQ WAIT_FOR_READY_321                      ; NO SPACE, CHECK AGAIN
00001E28  13D9 00C00007           4317mmm         MOVE.B (A1)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00001E2E                          4318mmm     ENDC
00001E2E                          4319mmm 
00001E2E                 FALSE    4320mmm     IFNE DEBUG
00001E2E                          4321mmm     ENDC
00001E2E                          4322mmm 
00001E2E                          4323mmm     ENDM
00001E2E  60E4                    4324mm     BRA LOOP_320
00001E30                          4325mm EXIT_320
00001E30                          4326mm     ENDM
00001E30                          4327m     ENDM
00001E30                          4328              ENDI
00001E30                          4329s _0000001A
00001E30                          4330          
00001E30  5283                    4331              ADD.L #1, D3
00001E32                          4332          ELSE
00001E32  6000 004C               4333s     BRA _0000001B
00001E36                          4334s _00000014
00001E36                          4335m             READ_16 #IDE_DATA_REGISTER, D6, D1  ; ignore
00001E36  13FC 0000 00A00007      4336m     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001E3E  13FC 0000 00A00005      4337m     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00001E46                          4338m     
00001E46  123C 0030               4339m     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00001E4A  0001 0000               4340m     ORI.B #IDE_DATA_REGISTER, D1
00001E4E  13C1 00A00019           4341m     MOVE.B D1, MC68230_PORT_C_DATA
00001E54  0201 00DF               4342m     ANDI.B #~MC68230_PORT_C_READ, D1
00001E58  13C1 00A00019           4343m     MOVE.B D1, MC68230_PORT_C_DATA
00001E5E  1C39 00A00011           4344m     MOVE.B MC68230_PORT_A_DATA, D6
00001E64  E14E                    4345m     LSL.W #8, D6
00001E66  1C39 00A00013           4346m     MOVE.B MC68230_PORT_B_DATA, D6
00001E6C  0001 0020               4347m     ORI.B #MC68230_PORT_C_READ, D1
00001E70  13C1 00A00019           4348m     MOVE.B D1, MC68230_PORT_C_DATA
00001E76  13FC 0038 00A00019      4349m     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001E7E                          4350m     ENDM
00001E7E  5284                    4351              ADD.L #1, D4    
00001E80                          4352          ENDI
00001E80                          4353s _0000001B
00001E80                          4354      ENDW
00001E80  6000 F852               4355s     BRA _10000016
00001E84                          4356s _10000017
00001E84                          4357      
00001E84  6000 E4BE               4358      BRA MAIN_LOOP
00001E88                          4359      
00001E88                          4360  B
00001E88  13FC 0038 00A00019      4361      MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001E90                          4362      
00001E90                          4363m     WRITE_8 #IDE_DRIVESEL_MASTER, #IDE_DRIVESEL_REGISTER, D0
00001E90  13FC 00FF 00A00007      4364m     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
00001E98  103C 0030               4365m     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
00001E9C  0000 0006               4366m     ORI.B #IDE_DRIVESEL_REGISTER, D0
00001EA0  13C0 00A00019           4367m     MOVE.B D0, MC68230_PORT_C_DATA
00001EA6  0200 00EF               4368m     ANDI.B #~MC68230_PORT_C_WRITE, D0
00001EAA  13FC 00E0 00A00013      4369m     MOVE.B #IDE_DRIVESEL_MASTER, MC68230_PORT_B_DATA
00001EB2  13C0 00A00019           4370m     MOVE.B D0, MC68230_PORT_C_DATA
00001EB8  0000 0010               4371m     ORI.B #MC68230_PORT_C_WRITE, D0
00001EBC  13C0 00A00019           4372m     MOVE.B D0, MC68230_PORT_C_DATA
00001EC2  13FC 0038 00A00019      4373m     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001ECA                          4374m     ENDM
00001ECA                          4375m     WAIT_DRIVE_READY D0, D1
00001ECA                          4376m LOOP_324
00001ECA                          4377mm     READ_IDE_STATUS D0, D1
00001ECA                          4378mmm     READ_8 #IDE_STATUS_REGISTER, D0, D1
00001ECA  13FC 0000 00A00007      4379mmm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001ED2  123C 0030               4380mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1
00001ED6  0001 0007               4381mmm     ORI.B #IDE_STATUS_REGISTER, D1
00001EDA  13C1 00A00019           4382mmm     MOVE.B D1, MC68230_PORT_C_DATA
00001EE0  0201 00DF               4383mmm     ANDI.B #~MC68230_PORT_C_READ, D1
00001EE4  13C1 00A00019           4384mmm     MOVE.B D1, MC68230_PORT_C_DATA
00001EEA  1039 00A00013           4385mmm     MOVE.B MC68230_PORT_B_DATA, D0
00001EF0  0001 0020               4386mmm     ORI.B #MC68230_PORT_C_READ, D1
00001EF4  13C1 00A00019           4387mmm     MOVE.B D1, MC68230_PORT_C_DATA
00001EFA  13FC 0038 00A00019      4388mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001F02                          4389mmm     ENDM
00001F02                          4390mm     ENDM
00001F02  0800 0006               4391m     BTST #IDE_STATUS_READY, D0
00001F06  67C2                    4392m     BEQ LOOP_324
00001F08                          4393m     ENDM
00001F08                          4394          
00001F08  2607                    4395      MOVE.L D7,D3                                ; grab the address accumulator into D3 as block startb
00001F0A                          4396              
00001F0A  7801                    4397      MOVE.L #1, D4                               ; flag for first iteration
00001F0C  7A01                    4398      MOVE.L #1, D5                               ; sentinel to prime the loop
00001F0E                          4399      WHILE.L D5 <GT> #0 DO
00001F0E                          4400s _10000018
00001F0E  BABC 00000000           4401s     CMP.L   #0,D5
00001F14  6F00 049E               4402s     BLE _10000019
00001F18                          4403m         SEND_READ_COMMAND_AND_WAIT D3, D0, D1, D2
00001F18                          4404mm     WAIT_DRIVE_NOT_BUSY D0, D1
00001F18                          4405mm LOOP_328
00001F18                          4406mmm     READ_IDE_STATUS D0, D1
00001F18                          4407mmmm     READ_8 #IDE_STATUS_REGISTER, D0, D1
00001F18  13FC 0000 00A00007      4408mmmm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00001F20  123C 0030               4409mmmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1
00001F24  0001 0007               4410mmmm     ORI.B #IDE_STATUS_REGISTER, D1
00001F28  13C1 00A00019           4411mmmm     MOVE.B D1, MC68230_PORT_C_DATA
00001F2E  0201 00DF               4412mmmm     ANDI.B #~MC68230_PORT_C_READ, D1
00001F32  13C1 00A00019           4413mmmm     MOVE.B D1, MC68230_PORT_C_DATA
00001F38  1039 00A00013           4414mmmm     MOVE.B MC68230_PORT_B_DATA, D0
00001F3E  0001 0020               4415mmmm     ORI.B #MC68230_PORT_C_READ, D1
00001F42  13C1 00A00019           4416mmmm     MOVE.B D1, MC68230_PORT_C_DATA
00001F48  13FC 0038 00A00019      4417mmmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001F50                          4418mmmm     ENDM
00001F50                          4419mmm     ENDM
00001F50  0800 0007               4420mm     BTST #IDE_STATUS_BUSY, D0
00001F54  66C2                    4421mm     BNE LOOP_328
00001F56                          4422mm     ENDM
00001F56                          4423mm     SET_READ_ADDRESS D3, D0, D1, D2
00001F56                          4424mmm     WRITE_8 #1, #IDE_SECTOR_COUNT_REGISTER, D0
00001F56  13FC 00FF 00A00007      4425mmm     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
00001F5E  103C 0030               4426mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
00001F62  0000 0002               4427mmm     ORI.B #IDE_SECTOR_COUNT_REGISTER, D0
00001F66  13C0 00A00019           4428mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001F6C  0200 00EF               4429mmm     ANDI.B #~MC68230_PORT_C_WRITE, D0
00001F70  13FC 0001 00A00013      4430mmm     MOVE.B #1, MC68230_PORT_B_DATA
00001F78  13C0 00A00019           4431mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001F7E  0000 0010               4432mmm     ORI.B #MC68230_PORT_C_WRITE, D0
00001F82  13C0 00A00019           4433mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001F88  13FC 0038 00A00019      4434mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001F90                          4435mmm     ENDM
00001F90  2203                    4436mm     MOVE.L D3,D1
00001F92                          4437mmm     WRITE_8 D1, #IDE_LBA_0_7_REGISTER, D0
00001F92  13FC 00FF 00A00007      4438mmm     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
00001F9A  103C 0030               4439mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
00001F9E  0000 0003               4440mmm     ORI.B #IDE_LBA_0_7_REGISTER, D0
00001FA2  13C0 00A00019           4441mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001FA8  0200 00EF               4442mmm     ANDI.B #~MC68230_PORT_C_WRITE, D0
00001FAC  13C1 00A00013           4443mmm     MOVE.B D1, MC68230_PORT_B_DATA
00001FB2  13C0 00A00019           4444mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001FB8  0000 0010               4445mmm     ORI.B #MC68230_PORT_C_WRITE, D0
00001FBC  13C0 00A00019           4446mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001FC2  13FC 0038 00A00019      4447mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00001FCA                          4448mmm     ENDM
00001FCA  E089                    4449mm     LSR.L #8, D1
00001FCC                          4450mmm     WRITE_8 D1, #IDE_LBA_8_15_REGISTER, D0
00001FCC  13FC 00FF 00A00007      4451mmm     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
00001FD4  103C 0030               4452mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
00001FD8  0000 0004               4453mmm     ORI.B #IDE_LBA_8_15_REGISTER, D0
00001FDC  13C0 00A00019           4454mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001FE2  0200 00EF               4455mmm     ANDI.B #~MC68230_PORT_C_WRITE, D0
00001FE6  13C1 00A00013           4456mmm     MOVE.B D1, MC68230_PORT_B_DATA
00001FEC  13C0 00A00019           4457mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001FF2  0000 0010               4458mmm     ORI.B #MC68230_PORT_C_WRITE, D0
00001FF6  13C0 00A00019           4459mmm     MOVE.B D0, MC68230_PORT_C_DATA
00001FFC  13FC 0038 00A00019      4460mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00002004                          4461mmm     ENDM
00002004  E089                    4462mm     LSR.L #8, D1                                
00002006                          4463mmm     WRITE_8 D1, #IDE_LBA_16_23_REGISTER, D0
00002006  13FC 00FF 00A00007      4464mmm     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
0000200E  103C 0030               4465mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
00002012  0000 0005               4466mmm     ORI.B #IDE_LBA_16_23_REGISTER, D0
00002016  13C0 00A00019           4467mmm     MOVE.B D0, MC68230_PORT_C_DATA
0000201C  0200 00EF               4468mmm     ANDI.B #~MC68230_PORT_C_WRITE, D0
00002020  13C1 00A00013           4469mmm     MOVE.B D1, MC68230_PORT_B_DATA
00002026  13C0 00A00019           4470mmm     MOVE.B D0, MC68230_PORT_C_DATA
0000202C  0000 0010               4471mmm     ORI.B #MC68230_PORT_C_WRITE, D0
00002030  13C0 00A00019           4472mmm     MOVE.B D0, MC68230_PORT_C_DATA
00002036  13FC 0038 00A00019      4473mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
0000203E                          4474mmm     ENDM
0000203E  E089                    4475mm     LSR.L #8, D1
00002040                          4476mmm     READ_8 #IDE_DRIVESEL_REGISTER, D2, D0
00002040  13FC 0000 00A00007      4477mmm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00002048  103C 0030               4478mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
0000204C  0000 0006               4479mmm     ORI.B #IDE_DRIVESEL_REGISTER, D0
00002050  13C0 00A00019           4480mmm     MOVE.B D0, MC68230_PORT_C_DATA
00002056  0200 00DF               4481mmm     ANDI.B #~MC68230_PORT_C_READ, D0
0000205A  13C0 00A00019           4482mmm     MOVE.B D0, MC68230_PORT_C_DATA
00002060  1439 00A00013           4483mmm     MOVE.B MC68230_PORT_B_DATA, D2
00002066  0000 0020               4484mmm     ORI.B #MC68230_PORT_C_READ, D0
0000206A  13C0 00A00019           4485mmm     MOVE.B D0, MC68230_PORT_C_DATA
00002070  13FC 0038 00A00019      4486mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00002078                          4487mmm     ENDM
00002078  0201 000F               4488mm     ANDI.B #$0F,D1
0000207C  8401                    4489mm     OR.B D1,D2
0000207E                          4490mmm     WRITE_8 D2, #IDE_DRIVESEL_REGISTER, D0
0000207E  13FC 00FF 00A00007      4491mmm     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
00002086  103C 0030               4492mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
0000208A  0000 0006               4493mmm     ORI.B #IDE_DRIVESEL_REGISTER, D0
0000208E  13C0 00A00019           4494mmm     MOVE.B D0, MC68230_PORT_C_DATA
00002094  0200 00EF               4495mmm     ANDI.B #~MC68230_PORT_C_WRITE, D0
00002098  13C2 00A00013           4496mmm     MOVE.B D2, MC68230_PORT_B_DATA
0000209E  13C0 00A00019           4497mmm     MOVE.B D0, MC68230_PORT_C_DATA
000020A4  0000 0010               4498mmm     ORI.B #MC68230_PORT_C_WRITE, D0
000020A8  13C0 00A00019           4499mmm     MOVE.B D0, MC68230_PORT_C_DATA
000020AE  13FC 0038 00A00019      4500mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000020B6                          4501mmm     ENDM
000020B6                          4502mm     ENDM
000020B6                          4503mm     SEND_COMMAND #IDE_COMMAND_READ_WITH_RETRY, D0
000020B6                          4504mmm     WRITE_8 #IDE_COMMAND_READ_WITH_RETRY, #IDE_COMMAND_REGISTER, D0
000020B6  13FC 00FF 00A00007      4505mmm     MOVE.B #MC68230_PORT_DIRECTION_WRITE, MC68230_PORT_B_DIRECTION
000020BE  103C 0030               4506mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D0
000020C2  0000 0007               4507mmm     ORI.B #IDE_COMMAND_REGISTER, D0
000020C6  13C0 00A00019           4508mmm     MOVE.B D0, MC68230_PORT_C_DATA
000020CC  0200 00EF               4509mmm     ANDI.B #~MC68230_PORT_C_WRITE, D0
000020D0  13FC 0020 00A00013      4510mmm     MOVE.B #IDE_COMMAND_READ_WITH_RETRY, MC68230_PORT_B_DATA
000020D8  13C0 00A00019           4511mmm     MOVE.B D0, MC68230_PORT_C_DATA
000020DE  0000 0010               4512mmm     ORI.B #MC68230_PORT_C_WRITE, D0
000020E2  13C0 00A00019           4513mmm     MOVE.B D0, MC68230_PORT_C_DATA
000020E8  13FC 0038 00A00019      4514mmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000020F0                          4515mmm     ENDM
000020F0                          4516mm     ENDM
000020F0                          4517mm     WAIT_DRIVE_NOT_BUSY D0, D1
000020F0                          4518mm LOOP_340
000020F0                          4519mmm     READ_IDE_STATUS D0, D1
000020F0                          4520mmmm     READ_8 #IDE_STATUS_REGISTER, D0, D1
000020F0  13FC 0000 00A00007      4521mmmm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
000020F8  123C 0030               4522mmmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1
000020FC  0001 0007               4523mmmm     ORI.B #IDE_STATUS_REGISTER, D1
00002100  13C1 00A00019           4524mmmm     MOVE.B D1, MC68230_PORT_C_DATA
00002106  0201 00DF               4525mmmm     ANDI.B #~MC68230_PORT_C_READ, D1
0000210A  13C1 00A00019           4526mmmm     MOVE.B D1, MC68230_PORT_C_DATA
00002110  1039 00A00013           4527mmmm     MOVE.B MC68230_PORT_B_DATA, D0
00002116  0001 0020               4528mmmm     ORI.B #MC68230_PORT_C_READ, D1
0000211A  13C1 00A00019           4529mmmm     MOVE.B D1, MC68230_PORT_C_DATA
00002120  13FC 0038 00A00019      4530mmmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00002128                          4531mmmm     ENDM
00002128                          4532mmm     ENDM
00002128  0800 0007               4533mm     BTST #IDE_STATUS_BUSY, D0
0000212C  66C2                    4534mm     BNE LOOP_340
0000212E                          4535mm     ENDM
0000212E                          4536mm     WAIT_DRIVE_DRQ D0, D1
0000212E                          4537mm LOOP_343
0000212E                          4538mmm     READ_IDE_STATUS D0, D1
0000212E                          4539mmmm     READ_8 #IDE_STATUS_REGISTER, D0, D1
0000212E  13FC 0000 00A00007      4540mmmm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00002136  123C 0030               4541mmmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1
0000213A  0001 0007               4542mmmm     ORI.B #IDE_STATUS_REGISTER, D1
0000213E  13C1 00A00019           4543mmmm     MOVE.B D1, MC68230_PORT_C_DATA
00002144  0201 00DF               4544mmmm     ANDI.B #~MC68230_PORT_C_READ, D1
00002148  13C1 00A00019           4545mmmm     MOVE.B D1, MC68230_PORT_C_DATA
0000214E  1039 00A00013           4546mmmm     MOVE.B MC68230_PORT_B_DATA, D0
00002154  0001 0020               4547mmmm     ORI.B #MC68230_PORT_C_READ, D1
00002158  13C1 00A00019           4548mmmm     MOVE.B D1, MC68230_PORT_C_DATA
0000215E  13FC 0038 00A00019      4549mmmm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00002166                          4550mmmm     ENDM
00002166                          4551mmm     ENDM
00002166  0800 0003               4552mm     BTST #IDE_STATUS_DRQ, D0
0000216A  67C2                    4553mm     BEQ LOOP_343
0000216C                          4554mm     ENDM
0000216C                          4555m     ENDM
0000216C                          4556m         PRINT_CHAR #'.', D1
0000216C                          4557m WAIT_FOR_READY_346                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000216C                 TRUE     4558m     IFEQ DEBUG
0000216C  1239 00C00003           4559m         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00002172  0801 0002               4560m         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00002176  67F4                    4561m         BEQ WAIT_FOR_READY_346                      ; NO SPACE, CHECK AGAIN
00002178  13FC 002E 00C00007      4562m         MOVE.B #'.',DUART_TXA                           ; SEND THE NEXT CHARACTER
00002180                          4563m     ENDC
00002180                          4564m 
00002180                 FALSE    4565m     IFNE DEBUG
00002180                          4566m     ENDC
00002180                          4567m 
00002180                          4568m     ENDM
00002180                          4569          
00002180                          4570          IF D4 <EQ> #1 THEN
00002180  B87C 0001               4571s     CMP.W   #1,D4
00002184  6600 01C8               4572s     BNE _0000001C
00002188                          4573m             READ_32 #IDE_DATA_REGISTER, D2, D1      ; start -> D2
00002188                          4574mm     READ_16 #IDE_DATA_REGISTER, D2, D1
00002188  13FC 0000 00A00007      4575mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00002190  13FC 0000 00A00005      4576mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00002198                          4577mm     
00002198  123C 0030               4578mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
0000219C  0001 0000               4579mm     ORI.B #IDE_DATA_REGISTER, D1
000021A0  13C1 00A00019           4580mm     MOVE.B D1, MC68230_PORT_C_DATA
000021A6  0201 00DF               4581mm     ANDI.B #~MC68230_PORT_C_READ, D1
000021AA  13C1 00A00019           4582mm     MOVE.B D1, MC68230_PORT_C_DATA
000021B0  1439 00A00011           4583mm     MOVE.B MC68230_PORT_A_DATA, D2
000021B6  E14A                    4584mm     LSL.W #8, D2
000021B8  1439 00A00013           4585mm     MOVE.B MC68230_PORT_B_DATA, D2
000021BE  0001 0020               4586mm     ORI.B #MC68230_PORT_C_READ, D1
000021C2  13C1 00A00019           4587mm     MOVE.B D1, MC68230_PORT_C_DATA
000021C8  13FC 0038 00A00019      4588mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000021D0                          4589mm     ENDM
000021D0  E18A                    4590m     LSL.L #8, D2
000021D2  E18A                    4591m     LSL.L #8, D2
000021D4                          4592mm     READ_16 #IDE_DATA_REGISTER, D2, D1
000021D4  13FC 0000 00A00007      4593mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
000021DC  13FC 0000 00A00005      4594mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
000021E4                          4595mm     
000021E4  123C 0030               4596mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
000021E8  0001 0000               4597mm     ORI.B #IDE_DATA_REGISTER, D1
000021EC  13C1 00A00019           4598mm     MOVE.B D1, MC68230_PORT_C_DATA
000021F2  0201 00DF               4599mm     ANDI.B #~MC68230_PORT_C_READ, D1
000021F6  13C1 00A00019           4600mm     MOVE.B D1, MC68230_PORT_C_DATA
000021FC  1439 00A00011           4601mm     MOVE.B MC68230_PORT_A_DATA, D2
00002202  E14A                    4602mm     LSL.W #8, D2
00002204  1439 00A00013           4603mm     MOVE.B MC68230_PORT_B_DATA, D2
0000220A  0001 0020               4604mm     ORI.B #MC68230_PORT_C_READ, D1
0000220E  13C1 00A00019           4605mm     MOVE.B D1, MC68230_PORT_C_DATA
00002214  13FC 0038 00A00019      4606mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
0000221C                          4607mm     ENDM
0000221C                          4608m     ENDM
0000221C  2042                    4609              MOVE.L D2, A0                           ; set up target         
0000221E                          4610m             READ_32 #IDE_DATA_REGISTER, D5, D1      ; end -> D5
0000221E                          4611mm     READ_16 #IDE_DATA_REGISTER, D5, D1
0000221E  13FC 0000 00A00007      4612mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00002226  13FC 0000 00A00005      4613mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
0000222E                          4614mm     
0000222E  123C 0030               4615mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00002232  0001 0000               4616mm     ORI.B #IDE_DATA_REGISTER, D1
00002236  13C1 00A00019           4617mm     MOVE.B D1, MC68230_PORT_C_DATA
0000223C  0201 00DF               4618mm     ANDI.B #~MC68230_PORT_C_READ, D1
00002240  13C1 00A00019           4619mm     MOVE.B D1, MC68230_PORT_C_DATA
00002246  1A39 00A00011           4620mm     MOVE.B MC68230_PORT_A_DATA, D5
0000224C  E14D                    4621mm     LSL.W #8, D5
0000224E  1A39 00A00013           4622mm     MOVE.B MC68230_PORT_B_DATA, D5
00002254  0001 0020               4623mm     ORI.B #MC68230_PORT_C_READ, D1
00002258  13C1 00A00019           4624mm     MOVE.B D1, MC68230_PORT_C_DATA
0000225E  13FC 0038 00A00019      4625mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00002266                          4626mm     ENDM
00002266  E18D                    4627m     LSL.L #8, D5
00002268  E18D                    4628m     LSL.L #8, D5
0000226A                          4629mm     READ_16 #IDE_DATA_REGISTER, D5, D1
0000226A  13FC 0000 00A00007      4630mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00002272  13FC 0000 00A00005      4631mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
0000227A                          4632mm     
0000227A  123C 0030               4633mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
0000227E  0001 0000               4634mm     ORI.B #IDE_DATA_REGISTER, D1
00002282  13C1 00A00019           4635mm     MOVE.B D1, MC68230_PORT_C_DATA
00002288  0201 00DF               4636mm     ANDI.B #~MC68230_PORT_C_READ, D1
0000228C  13C1 00A00019           4637mm     MOVE.B D1, MC68230_PORT_C_DATA
00002292  1A39 00A00011           4638mm     MOVE.B MC68230_PORT_A_DATA, D5
00002298  E14D                    4639mm     LSL.W #8, D5
0000229A  1A39 00A00013           4640mm     MOVE.B MC68230_PORT_B_DATA, D5
000022A0  0001 0020               4641mm     ORI.B #MC68230_PORT_C_READ, D1
000022A4  13C1 00A00019           4642mm     MOVE.B D1, MC68230_PORT_C_DATA
000022AA  13FC 0038 00A00019      4643mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000022B2                          4644mm     ENDM
000022B2                          4645m     ENDM
000022B2  9A82                    4646              SUB.L D2, D5                            ; work out num bytes
000022B4                          4647m             READ_32 #IDE_DATA_REGISTER, D7, D1      ; read entry point into address accumulator
000022B4                          4648mm     READ_16 #IDE_DATA_REGISTER, D7, D1
000022B4  13FC 0000 00A00007      4649mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
000022BC  13FC 0000 00A00005      4650mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
000022C4                          4651mm     
000022C4  123C 0030               4652mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
000022C8  0001 0000               4653mm     ORI.B #IDE_DATA_REGISTER, D1
000022CC  13C1 00A00019           4654mm     MOVE.B D1, MC68230_PORT_C_DATA
000022D2  0201 00DF               4655mm     ANDI.B #~MC68230_PORT_C_READ, D1
000022D6  13C1 00A00019           4656mm     MOVE.B D1, MC68230_PORT_C_DATA
000022DC  1E39 00A00011           4657mm     MOVE.B MC68230_PORT_A_DATA, D7
000022E2  E14F                    4658mm     LSL.W #8, D7
000022E4  1E39 00A00013           4659mm     MOVE.B MC68230_PORT_B_DATA, D7
000022EA  0001 0020               4660mm     ORI.B #MC68230_PORT_C_READ, D1
000022EE  13C1 00A00019           4661mm     MOVE.B D1, MC68230_PORT_C_DATA
000022F4  13FC 0038 00A00019      4662mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
000022FC                          4663mm     ENDM
000022FC  E18F                    4664m     LSL.L #8, D7
000022FE  E18F                    4665m     LSL.L #8, D7
00002300                          4666mm     READ_16 #IDE_DATA_REGISTER, D7, D1
00002300  13FC 0000 00A00007      4667mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
00002308  13FC 0000 00A00005      4668mm     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00002310                          4669mm     
00002310  123C 0030               4670mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
00002314  0001 0000               4671mm     ORI.B #IDE_DATA_REGISTER, D1
00002318  13C1 00A00019           4672mm     MOVE.B D1, MC68230_PORT_C_DATA
0000231E  0201 00DF               4673mm     ANDI.B #~MC68230_PORT_C_READ, D1
00002322  13C1 00A00019           4674mm     MOVE.B D1, MC68230_PORT_C_DATA
00002328  1E39 00A00011           4675mm     MOVE.B MC68230_PORT_A_DATA, D7
0000232E  E14F                    4676mm     LSL.W #8, D7
00002330  1E39 00A00013           4677mm     MOVE.B MC68230_PORT_B_DATA, D7
00002336  0001 0020               4678mm     ORI.B #MC68230_PORT_C_READ, D1
0000233A  13C1 00A00019           4679mm     MOVE.B D1, MC68230_PORT_C_DATA
00002340  13FC 0038 00A00019      4680mm     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
00002348                          4681mm     ENDM
00002348                          4682m     ENDM
00002348  7406                    4683              MOVE.L #6, D2                           ; words read so far
0000234A                          4684          ELSE
0000234A  6000 0004               4685s     BRA _0000001D
0000234E                          4686s _0000001C
0000234E  7400                    4687              MOVE.L #0, D2                           ; words read so far
00002350                          4688          ENDI
00002350                          4689s _0000001D
00002350                          4690              
00002350                          4691          FOR.L D6 = D2 TO #255 DO
00002350  2C02                    4692s     MOVE.L  D2,D6
00002352  6000 0050               4693s     BRA _20000017
00002356                          4694s _20000016
00002356                          4695m             READ_16 #IDE_DATA_REGISTER, D0, D1
00002356  13FC 0000 00A00007      4696m     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_B_DIRECTION
0000235E  13FC 0000 00A00005      4697m     MOVE.B #MC68230_PORT_DIRECTION_READ, MC68230_PORT_A_DIRECTION
00002366                          4698m     
00002366  123C 0030               4699m     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE), D1    
0000236A  0001 0000               4700m     ORI.B #IDE_DATA_REGISTER, D1
0000236E  13C1 00A00019           4701m     MOVE.B D1, MC68230_PORT_C_DATA
00002374  0201 00DF               4702m     ANDI.B #~MC68230_PORT_C_READ, D1
00002378  13C1 00A00019           4703m     MOVE.B D1, MC68230_PORT_C_DATA
0000237E  1039 00A00011           4704m     MOVE.B MC68230_PORT_A_DATA, D0
00002384  E148                    4705m     LSL.W #8, D0
00002386  1039 00A00013           4706m     MOVE.B MC68230_PORT_B_DATA, D0
0000238C  0001 0020               4707m     ORI.B #MC68230_PORT_C_READ, D1
00002390  13C1 00A00019           4708m     MOVE.B D1, MC68230_PORT_C_DATA
00002396  13FC 0038 00A00019      4709m     MOVE.B #(MC68230_PORT_C_READ | MC68230_PORT_C_WRITE | MC68230_PORT_C_CS), MC68230_PORT_C_DATA
0000239E                          4710m     ENDM
0000239E  30C0                    4711              MOVE.W D0,(A0)+
000023A0  5585                    4712              SUB.L #2, D5
000023A2                          4713          ENDF
000023A2  5286                    4714s     ADD.L   #1,D6
000023A4                          4715s _20000017
000023A4  BCBC 000000FF           4716s     CMP.L   #255,D6
000023AA  6FAA                    4717s     BLE _20000016
000023AC                          4718          
000023AC  5283                    4719          ADD.L #1, D3                                ; next block
000023AE  7800                    4720          MOVE.L #0, D4                               ; not the first anymore
000023B0                          4721      ENDW
000023B0  6000 FB5C               4722s     BRA _10000018
000023B4                          4723s _10000019
000023B4                          4724  
000023B4                          4725m     PRINT_CRLF D3,A3
000023B4  47FA 040F               4726m     LEA CRLF(PC),A3
000023B8                          4727mm     PRINT_STR A3,D3
000023B8                          4728mm LOOP_358
000023B8  0C13 0000               4729mm     CMP.B #NULL,(A3)                                ; 0 -> DONE
000023BC  6700 0016               4730mm     BEQ EXIT_358
000023C0                          4731mmm     PRINT_CHAR (A3)+,D3
000023C0                          4732mmm WAIT_FOR_READY_359                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
000023C0                 TRUE     4733mmm     IFEQ DEBUG
000023C0  1639 00C00003           4734mmm         MOVE.B DUART_SRA,D3                         ; READ STATUS REGISTER
000023C6  0803 0002               4735mmm         BTST #2,D3                                  ; CHECK FOR SPACE TO SEND
000023CA  67F4                    4736mmm         BEQ WAIT_FOR_READY_359                      ; NO SPACE, CHECK AGAIN
000023CC  13DB 00C00007           4737mmm         MOVE.B (A3)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000023D2                          4738mmm     ENDC
000023D2                          4739mmm 
000023D2                 FALSE    4740mmm     IFNE DEBUG
000023D2                          4741mmm     ENDC
000023D2                          4742mmm 
000023D2                          4743mmm     ENDM
000023D2  60E4                    4744mm     BRA LOOP_358
000023D4                          4745mm EXIT_358
000023D4                          4746mm     ENDM
000023D4                          4747m     ENDM
000023D4                          4748      
000023D4  6000 DF6E               4749      BRA MAIN_LOOP
000023D8                          4750  
000023D8                          4751  HEX_DIGIT
000023D8  E98F                    4752      LSL.L #4,D7                                     ; add the next digit in the next 4 bits
000023DA                          4753m     HEX2BIN D2,D2,A0
000023DA  41FA 03BE               4754m     LEA HEX2BIN_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
000023DE  0402 0030               4755m     SUB.B #'0',D2                                   ; WORK OUT OFFSET AND MASK OFF ANYTHING ROGUE
000023E2  C4BC 000000FF           4756m     AND.L #$FF,D2                                   ; IGNORE THE TOP 3 BYTES
000023E8  1430 2000               4757m     MOVE.B 0(A0,D2),D2                              ; USE THAT AS AN INDEX INTO THE LUT   
000023EC                          4758m     ENDM
000023EC  8E02                    4759      OR.B D2,D7  
000023EE  6000 DF74               4760      BRA GET_INPUT
000023F2                          4761  
000023F2                          4762  ; exceptions    
000023F2                          4763  BUS_ERROR_HANDLER
000023F2                          4764  
000023F2  41FA 03FA               4765      LEA BUS_ERROR(PC),A0
000023F6                          4766m     PRINT_STR A0,D1
000023F6                          4767m LOOP_361
000023F6  0C10 0000               4768m     CMP.B #NULL,(A0)                                ; 0 -> DONE
000023FA  6700 0016               4769m     BEQ EXIT_361
000023FE                          4770mm     PRINT_CHAR (A0)+,D1
000023FE                          4771mm WAIT_FOR_READY_362                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
000023FE                 TRUE     4772mm     IFEQ DEBUG
000023FE  1239 00C00003           4773mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00002404  0801 0002               4774mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00002408  67F4                    4775mm         BEQ WAIT_FOR_READY_362                      ; NO SPACE, CHECK AGAIN
0000240A  13D8 00C00007           4776mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00002410                          4777mm     ENDC
00002410                          4778mm 
00002410                 FALSE    4779mm     IFNE DEBUG
00002410                          4780mm     ENDC
00002410                          4781mm 
00002410                          4782mm     ENDM
00002410  60E4                    4783m     BRA LOOP_361
00002412                          4784m EXIT_361
00002412                          4785m     ENDM
00002412                          4786  
00002412  7000                    4787      MOVE.L #0,D0
00002414  3017                    4788      MOVE.W (SP),D0
00002416                          4789  
00002416  0800 0004               4790      BTST #4,D0
0000241A  6700 0026               4791      BEQ WRITE
0000241E                          4792      
0000241E  41FA 03E3               4793      LEA READING(PC),A0
00002422                          4794m     PRINT_STR A0,D1
00002422                          4795m LOOP_363
00002422  0C10 0000               4796m     CMP.B #NULL,(A0)                                ; 0 -> DONE
00002426  6700 0016               4797m     BEQ EXIT_363
0000242A                          4798mm     PRINT_CHAR (A0)+,D1
0000242A                          4799mm WAIT_FOR_READY_364                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000242A                 TRUE     4800mm     IFEQ DEBUG
0000242A  1239 00C00003           4801mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00002430  0801 0002               4802mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00002434  67F4                    4803mm         BEQ WAIT_FOR_READY_364                      ; NO SPACE, CHECK AGAIN
00002436  13D8 00C00007           4804mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
0000243C                          4805mm     ENDC
0000243C                          4806mm 
0000243C                 FALSE    4807mm     IFNE DEBUG
0000243C                          4808mm     ENDC
0000243C                          4809mm 
0000243C                          4810mm     ENDM
0000243C  60E4                    4811m     BRA LOOP_363
0000243E                          4812m EXIT_363
0000243E                          4813m     ENDM
0000243E                          4814  
0000243E  6000 0022               4815      BRA CONTINUE    
00002442                          4816  WRITE
00002442  41FA 03C8               4817      LEA WRITING(PC),A0
00002446                          4818m     PRINT_STR A0,D1
00002446                          4819m LOOP_365
00002446  0C10 0000               4820m     CMP.B #NULL,(A0)                                ; 0 -> DONE
0000244A  6700 0016               4821m     BEQ EXIT_365
0000244E                          4822mm     PRINT_CHAR (A0)+,D1
0000244E                          4823mm WAIT_FOR_READY_366                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000244E                 TRUE     4824mm     IFEQ DEBUG
0000244E  1239 00C00003           4825mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
00002454  0801 0002               4826mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00002458  67F4                    4827mm         BEQ WAIT_FOR_READY_366                      ; NO SPACE, CHECK AGAIN
0000245A  13D8 00C00007           4828mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00002460                          4829mm     ENDC
00002460                          4830mm 
00002460                 FALSE    4831mm     IFNE DEBUG
00002460                          4832mm     ENDC
00002460                          4833mm 
00002460                          4834mm     ENDM
00002460  60E4                    4835m     BRA LOOP_365
00002462                          4836m EXIT_365
00002462                          4837m     ENDM
00002462                          4838  
00002462                          4839  CONTINUE
00002462  222F 0002               4840      MOVE.L 2(SP),D1
00002466                          4841m     PRINT_REG D1,D2,D3,D4,A0
00002466  41FA 0363               4842m     LEA OX(PC),A0
0000246A                          4843mm     PRINT_STR A0,D2
0000246A                          4844mm LOOP_368
0000246A  0C10 0000               4845mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
0000246E  6700 0016               4846mm     BEQ EXIT_368
00002472                          4847mmm     PRINT_CHAR (A0)+,D2
00002472                          4848mmm WAIT_FOR_READY_369                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00002472                 TRUE     4849mmm     IFEQ DEBUG
00002472  1439 00C00003           4850mmm         MOVE.B DUART_SRA,D2                         ; READ STATUS REGISTER
00002478  0802 0002               4851mmm         BTST #2,D2                                  ; CHECK FOR SPACE TO SEND
0000247C  67F4                    4852mmm         BEQ WAIT_FOR_READY_369                      ; NO SPACE, CHECK AGAIN
0000247E  13D8 00C00007           4853mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00002484                          4854mmm     ENDC
00002484                          4855mmm 
00002484                 FALSE    4856mmm     IFNE DEBUG
00002484                          4857mmm     ENDC
00002484                          4858mmm 
00002484                          4859mmm     ENDM
00002484  60E4                    4860mm     BRA LOOP_368
00002486                          4861mm EXIT_368
00002486                          4862mm     ENDM
00002486  7807                    4863m     MOVE.L #7,D4                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
00002488                          4864m LOOP_367
00002488                          4865mm     BIN2HEX D1,D3,A0
00002488  41FA 0300               4866mm     LEA BIN2HEX_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
0000248C  E999                    4867mm     ROL.L #4,D1                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
0000248E  1601                    4868mm     MOVE.B D1,D3
00002490  0283 0000000F           4869mm     ANDI.L #$F,D3
00002496  1630 3000               4870mm     MOVE.B 0(A0,D3),D3                              ; USE THAT AS AN INDEX INTO THE LUT
0000249A                          4871mm     ENDM
0000249A                          4872mm     PRINT_CHAR D3,D2
0000249A                          4873mm WAIT_FOR_READY_371                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000249A                 TRUE     4874mm     IFEQ DEBUG
0000249A  1439 00C00003           4875mm         MOVE.B DUART_SRA,D2                         ; READ STATUS REGISTER
000024A0  0802 0002               4876mm         BTST #2,D2                                  ; CHECK FOR SPACE TO SEND
000024A4  67F4                    4877mm         BEQ WAIT_FOR_READY_371                      ; NO SPACE, CHECK AGAIN
000024A6  13C3 00C00007           4878mm         MOVE.B D3,DUART_TXA                         ; SEND THE NEXT CHARACTER
000024AC                          4879mm     ENDC
000024AC                          4880mm 
000024AC                 FALSE    4881mm     IFNE DEBUG
000024AC                          4882mm     ENDC
000024AC                          4883mm 
000024AC                          4884mm     ENDM
000024AC  57CC FFDA               4885m     DBEQ D4,LOOP_367
000024B0                          4886m     ENDM
000024B0                          4887  
000024B0  41FA 0363               4888      LEA FROM(PC),A0
000024B4                          4889m     PRINT_STR A0,D0
000024B4                          4890m LOOP_372
000024B4  0C10 0000               4891m     CMP.B #NULL,(A0)                                ; 0 -> DONE
000024B8  6700 0016               4892m     BEQ EXIT_372
000024BC                          4893mm     PRINT_CHAR (A0)+,D0
000024BC                          4894mm WAIT_FOR_READY_373                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
000024BC                 TRUE     4895mm     IFEQ DEBUG
000024BC  1039 00C00003           4896mm         MOVE.B DUART_SRA,D0                         ; READ STATUS REGISTER
000024C2  0800 0002               4897mm         BTST #2,D0                                  ; CHECK FOR SPACE TO SEND
000024C6  67F4                    4898mm         BEQ WAIT_FOR_READY_373                      ; NO SPACE, CHECK AGAIN
000024C8  13D8 00C00007           4899mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000024CE                          4900mm     ENDC
000024CE                          4901mm 
000024CE                 FALSE    4902mm     IFNE DEBUG
000024CE                          4903mm     ENDC
000024CE                          4904mm 
000024CE                          4905mm     ENDM
000024CE  60E4                    4906m     BRA LOOP_372
000024D0                          4907m EXIT_372
000024D0                          4908m     ENDM
000024D0                          4909  
000024D0  222F 000A               4910      MOVE.L 10(SP),D1
000024D4                          4911m     PRINT_REG D1,D2,D3,D4,A0
000024D4  41FA 02F5               4912m     LEA OX(PC),A0
000024D8                          4913mm     PRINT_STR A0,D2
000024D8                          4914mm LOOP_375
000024D8  0C10 0000               4915mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
000024DC  6700 0016               4916mm     BEQ EXIT_375
000024E0                          4917mmm     PRINT_CHAR (A0)+,D2
000024E0                          4918mmm WAIT_FOR_READY_376                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
000024E0                 TRUE     4919mmm     IFEQ DEBUG
000024E0  1439 00C00003           4920mmm         MOVE.B DUART_SRA,D2                         ; READ STATUS REGISTER
000024E6  0802 0002               4921mmm         BTST #2,D2                                  ; CHECK FOR SPACE TO SEND
000024EA  67F4                    4922mmm         BEQ WAIT_FOR_READY_376                      ; NO SPACE, CHECK AGAIN
000024EC  13D8 00C00007           4923mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
000024F2                          4924mmm     ENDC
000024F2                          4925mmm 
000024F2                 FALSE    4926mmm     IFNE DEBUG
000024F2                          4927mmm     ENDC
000024F2                          4928mmm 
000024F2                          4929mmm     ENDM
000024F2  60E4                    4930mm     BRA LOOP_375
000024F4                          4931mm EXIT_375
000024F4                          4932mm     ENDM
000024F4  7807                    4933m     MOVE.L #7,D4                                    ; LOOP ROUND ALL 8 HEX CHARACTERS OF 4 BITS EACH
000024F6                          4934m LOOP_374
000024F6                          4935mm     BIN2HEX D1,D3,A0
000024F6  41FA 0292               4936mm     LEA BIN2HEX_LUT(PC),A0                          ; LOAD THE LOOKUP TABLE
000024FA  E999                    4937mm     ROL.L #4,D1                                     ; SHIFT THE TOP 4 BITS DOWN TO BOTTOM OF THE REGISTER THE AND MASK OFF EVERYTHING ELSE
000024FC  1601                    4938mm     MOVE.B D1,D3
000024FE  0283 0000000F           4939mm     ANDI.L #$F,D3
00002504  1630 3000               4940mm     MOVE.B 0(A0,D3),D3                              ; USE THAT AS AN INDEX INTO THE LUT
00002508                          4941mm     ENDM
00002508                          4942mm     PRINT_CHAR D3,D2
00002508                          4943mm WAIT_FOR_READY_378                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00002508                 TRUE     4944mm     IFEQ DEBUG
00002508  1439 00C00003           4945mm         MOVE.B DUART_SRA,D2                         ; READ STATUS REGISTER
0000250E  0802 0002               4946mm         BTST #2,D2                                  ; CHECK FOR SPACE TO SEND
00002512  67F4                    4947mm         BEQ WAIT_FOR_READY_378                      ; NO SPACE, CHECK AGAIN
00002514  13C3 00C00007           4948mm         MOVE.B D3,DUART_TXA                         ; SEND THE NEXT CHARACTER
0000251A                          4949mm     ENDC
0000251A                          4950mm 
0000251A                 FALSE    4951mm     IFNE DEBUG
0000251A                          4952mm     ENDC
0000251A                          4953mm 
0000251A                          4954mm     ENDM
0000251A  57CC FFDA               4955m     DBEQ D4,LOOP_374
0000251E                          4956m     ENDM
0000251E                          4957m     PRINT_CRLF D0,A0
0000251E  41FA 02A5               4958m     LEA CRLF(PC),A0
00002522                          4959mm     PRINT_STR A0,D0
00002522                          4960mm LOOP_380
00002522  0C10 0000               4961mm     CMP.B #NULL,(A0)                                ; 0 -> DONE
00002526  6700 0016               4962mm     BEQ EXIT_380
0000252A                          4963mmm     PRINT_CHAR (A0)+,D0
0000252A                          4964mmm WAIT_FOR_READY_381                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
0000252A                 TRUE     4965mmm     IFEQ DEBUG
0000252A  1039 00C00003           4966mmm         MOVE.B DUART_SRA,D0                         ; READ STATUS REGISTER
00002530  0800 0002               4967mmm         BTST #2,D0                                  ; CHECK FOR SPACE TO SEND
00002534  67F4                    4968mmm         BEQ WAIT_FOR_READY_381                      ; NO SPACE, CHECK AGAIN
00002536  13D8 00C00007           4969mmm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
0000253C                          4970mmm     ENDC
0000253C                          4971mmm 
0000253C                 FALSE    4972mmm     IFNE DEBUG
0000253C                          4973mmm     ENDC
0000253C                          4974mmm 
0000253C                          4975mmm     ENDM
0000253C  60E4                    4976mm     BRA LOOP_380
0000253E                          4977mm EXIT_380
0000253E                          4978mm     ENDM
0000253E                          4979m     ENDM
0000253E                          4980      
0000253E  207C 00000004           4981      MOVE.L #4,A0
00002544  4ED0                    4982      JMP (A0)
00002546                          4983          
00002546                          4984  ILLEGAL_HANDLER
00002546  13FC 0007 00E00001      4985      MOVE.B #7,DISPLAY   
0000254E  207C 00000004           4986      MOVE.L #4,A0
00002554  4ED0                    4987      JMP (A0)
00002556                          4988          
00002556                          4989  UNHANDLED_HANDLER
00002556  41FA 02C4               4990      LEA UNHANDLED(PC),A0
0000255A  4EF9 0000257E           4991      JMP PRINTIT_RTE
00002560                          4992      
00002560                          4993  UNINITIALISED_HANDLER
00002560  41FA 02D0               4994      LEA UNINITIALISED(PC),A0
00002564  4EF9 0000257E           4995      JMP PRINTIT_RTE
0000256A                          4996  
0000256A                          4997  TICK_HANDLER
0000256A  1039 00C0001F           4998      MOVE.B DUART_RESET_OPR,D0
00002570  41FA 0275               4999      LEA TICK(PC),A0
00002574  4EF9 0000257E           5000      JMP PRINTIT_RTE
0000257A                          5001  
0000257A                          5002  SPURIOUS_HANDLER
0000257A  41FA 02D5               5003      LEA SPURIOUS(PC),A0
0000257E                          5004  PRINTIT_RTE
0000257E                          5005m     PRINT_STR A0,D1
0000257E                          5006m LOOP_382
0000257E  0C10 0000               5007m     CMP.B #NULL,(A0)                                ; 0 -> DONE
00002582  6700 0016               5008m     BEQ EXIT_382
00002586                          5009mm     PRINT_CHAR (A0)+,D1
00002586                          5010mm WAIT_FOR_READY_383                                  ; WAIT UNTIL THE THERE IS SPACE TO SEND
00002586                 TRUE     5011mm     IFEQ DEBUG
00002586  1239 00C00003           5012mm         MOVE.B DUART_SRA,D1                         ; READ STATUS REGISTER
0000258C  0801 0002               5013mm         BTST #2,D1                                  ; CHECK FOR SPACE TO SEND
00002590  67F4                    5014mm         BEQ WAIT_FOR_READY_383                      ; NO SPACE, CHECK AGAIN
00002592  13D8 00C00007           5015mm         MOVE.B (A0)+,DUART_TXA                          ; SEND THE NEXT CHARACTER
00002598                          5016mm     ENDC
00002598                          5017mm 
00002598                 FALSE    5018mm     IFNE DEBUG
00002598                          5019mm     ENDC
00002598                          5020mm 
00002598                          5021mm     ENDM
00002598  60E4                    5022m     BRA LOOP_382
0000259A                          5023m EXIT_382
0000259A                          5024m     ENDM
0000259A  4E73                    5025      RTE 
0000259C                          5026      
0000259C  FFFF FFFF               5027      SIMHALT                                             ; halt simulator
000025A0                          5028  
000025A0                          5029  ; strings
000025A0= 50 72 65 73 73 20 ...   5030  HELPPROMPT DC.B 'Press ? for help',CR,LF,NULL
000025B3= 5B 3F 5D 09 09 09 ...   5031  HELP    DC.B '[?]',TAB,TAB,TAB,'help',CR,LF
000025BF= 5B 76 5D 09 09 09 ...   5032          DC.B '[v]',TAB,TAB,TAB,'version',CR,LF
000025CE= 78 78 78 78 78 78 ...   5033          DC.B 'xxxxxxxx[r]',TAB,TAB,'read long',CR,LF
000025E6= 78 78 78 78 78 78 ...   5034          DC.B 'xxxxxxxx[w]xxxxxxxx',TAB,'write long',CR,LF
00002606= 78 78 78 78 78 78 ...   5035          DC.B 'xxxxxxxx[s]',TAB,TAB,'download S records',CR,LF
00002627= 78 78 78 78 78 78 ...   5036          DC.B 'xxxxxxxx[g]',TAB,TAB,'go',CR,LF
00002638= 5B 7A 5D 09 09 09 ...   5037          DC.B '[z]',TAB,TAB,TAB,'zap memory',CR,LF
0000264A= 78 78 78 78 78 78 ...   5038          DC.B 'xxxxxxxx[l]xxxxxxxx',TAB,'load to EEPROM',CR,LF
0000266E= 78 78 78 78 78 78 ...   5039          DC.B 'xxxxxxxx[p]xxxxxxxx',TAB,'patch EEPROM',CR,LF
00002690= 23 09 09 09 77 72 ...   5040          DC.B '#',TAB,TAB,TAB,'write protect EEPROM',CR,LF
000026AA= 5B 78 5D 09 09 09 ...   5041          DC.B '[x]',TAB,TAB,TAB,'print registers',CR,LF
000026C1= 5B 49 5D 09 09 09 ...   5042          DC.B '[I]',TAB,TAB,TAB,'enable interrupts',CR,LF
000026DA= 5B 6F 5D 09 09 09 ...   5043          DC.B '[o]',TAB,TAB,TAB,'disable interrupts',CR,LF
000026F4= 5B 69 5D 09 09 09 ...   5044          DC.B '[i]',TAB,TAB,TAB,'index the disk',CR,LF
0000270A= 78 78 78 78 78 78 ...   5045          DC.B 'xxxxxxxx[b]',TAB,TAB,'boot from disk',CR,LF,NULL
00002728= 48 75 68 3F 0D 0A 00    5046  HUH  DC.B 'Huh?',CR,LF,NULL
0000272F= 20 53 20 72 65 63 ...   5047  READ    DC.B ' S records read, start address = ',NULL
00002751= 57 3A 20 55 6E 6B ...   5048  UNREC   DC.B 'W: Unknown Srec type: ',NULL
00002768= 21 20 43 53 20 66 ...   5049  CS_FAILURE  DC.B '! CS failure at ',NULL
00002779= 21 20 52 41 4D 20 ...   5050  RAM_ERROR   DC.B '! RAM error at: ',NULL
0000278A= 30 31 32 33 34 35 ...   5051  BIN2HEX_LUT DC.B '0123456789ABCDEF'
0000279A= 00 01 02 03 04 05 ...   5052  HEX2BIN_LUT DC.B 0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,$A,$B,$C,$D,$E,$F
000027B1= 4C 6F 61 64 69 6E ...   5053  LOADING DC.B 'Loading EEPROM...',CR,LF,NULL
000027C5= 0D 0A 00                5054  CRLF    DC.B CR,LF,NULL
000027C8= 3E 20 00                5055  PROMPT  DC.B '> ',NULL
000027CB= 30 78 00                5056  ox      DC.B '0x',NULL
000027CE= 20 2D 3E 20 00          5057  to      DC.B ' -> ',NULL
000027D3= 20 66 6F 72 20 00       5058  for     DC.B ' for ',NULL
000027D9= 53 50 3A 20 00          5059  STACK_POINTER DC.B 'SP: ',NULL
000027DE= 53 52 3A 20 00          5060  STATUS_REGISTER DC.B 'SR: ',NULL
000027E3= 20 3A 20 00             5061  INDEX_SEP DC.B ' : ',NULL
000027E7= 74 69 63 6B 0D 0A 00    5062  TICK DC.B 'tick',CR,LF,NULL
000027EE= 2A 20 42 75 73 2F ...   5063  BUS_ERROR DC.B '* Bus/address error ',NULL
00002803= 72 65 61 64 69 6E ...   5064  READING DC.B 'reading ',NULL
0000280C= 77 72 69 74 69 6E ...   5065  WRITING DC.B 'writing ',NULL
00002815= 20 66 72 6F 6D 20 00    5066  FROM DC.B ' from ',NULL
0000281C= 2A 20 55 6E 68 61 ...   5067  UNHANDLED DC.B '* Unhandled interrupt',NULL
00002832= 2A 20 55 6E 69 74 ...   5068  UNINITIALISED DC.B '* Unitialised interrupt vector',NULL
00002851= 2A 20 53 70 75 72 ...   5069  SPURIOUS DC.B '* Spurious interrupt',NULL
00002866= 4D 44 46 2D 6D 6F ...   5070  VERSION DC.B 'MDF-mon V1.142 (27/05/2021)',CR,LF,NULL   ; this is the last line on purpose, so if it prints, we can be sure we got it all
00002884= 00                      5071  END     DC.B 0
00002885                          5072      END START                                           ; last line of source

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
B                   1E88
BIN2HEX             0
BIN2HEX_LUT         278A
BUS_ERROR           27EE
BUS_ERROR_HANDLER   23F2
CONTINUE            2462
CONTINUE_101        A7A
CONTINUE_54         618
CONTINUE_57         668
CONTINUE_60         6AC
CONTINUE_64         72E
CONTINUE_68         78E
CONTINUE_72         7F8
CONTINUE_76         864
CONTINUE_80         8DA
CONTINUE_84         93A
CONTINUE_88         99A
CR                  D
CRLF                27C5
CS_FAILURE          2768
DEBUG               0
DI                  1340
DISPLAY             E00001
DISPLAY_            0
DISPLAY_BASE        E00000
DOWNLOAD            7E4
DOWNLOAD_BYTE       B54
DOWNLOAD_DONE       B72
DUART_ACR           C00009
DUART_ACR_          4
DUART_BASE          C00000
DUART_CRA           C00005
DUART_CRA_          2
DUART_CRB           C00015
DUART_CRB_          A
DUART_CSRA          C00003
DUART_CSRA_         1
DUART_CSRB          C00013
DUART_CSRB_         9
DUART_CTLR          C0000F
DUART_CTLR_         7
DUART_CTUR          C0000D
DUART_CTUR_         6
DUART_IMR           C0000B
DUART_IMR_          5
DUART_IVR           C00019
DUART_IVR_          C
DUART_MRA           C00001
DUART_MRA_          0
DUART_MRB           C00011
DUART_MRB_          8
DUART_OPCR          C0001B
DUART_OPCR_         D
DUART_RESET_OPR     C0001F
DUART_RESET_OPR_    F
DUART_RXA           C00007
DUART_RXA_          3
DUART_RXB           C00017
DUART_RXB_          B
DUART_SET_OPR       C0001D
DUART_SET_OPR_      E
DUART_SRA           C00003
DUART_SRA_          1
DUART_SRB           C00013
DUART_SRB_          9
DUART_TXA           C00007
DUART_TXA_          3
DUART_TXB           C00017
DUART_TXB_          B
EI                  1330
END                 2884
EXIT_10             288
EXIT_105            AD8
EXIT_107            AF8
EXIT_110            B18
EXIT_115            B62
EXIT_118            B92
EXIT_121            BB2
EXIT_125            BFC
EXIT_128            C1E
EXIT_133            C68
EXIT_135            CE4
EXIT_138            D08
EXIT_143            D52
EXIT_15             2D2
EXIT_150            DE4
EXIT_153            E54
EXIT_156            E76
EXIT_160            EC0
EXIT_163            EE2
EXIT_167            F2C
EXIT_17             2F2
EXIT_170            F4C
EXIT_175            F96
EXIT_190            10B8
EXIT_193            111C
EXIT_196            113C
EXIT_20             312
EXIT_200            1186
EXIT_203            11A8
EXIT_208            11F2
EXIT_212            1234
EXIT_215            1256
EXIT_22             364
EXIT_220            12A0
EXIT_222            12C0
EXIT_225            12E2
EXIT_230            132C
EXIT_264            17C4
EXIT_28             3F0
EXIT_282            1AAE
EXIT_285            1ACE
EXIT_292            1BB6
EXIT_295            1BD6
EXIT_30             470
EXIT_302            1CBE
EXIT_305            1CDE
EXIT_312            1DC6
EXIT_315            1DE6
EXIT_32             49C
EXIT_320            1E30
EXIT_35             4C6
EXIT_358            23D4
EXIT_361            2412
EXIT_363            243E
EXIT_365            2462
EXIT_368            2486
EXIT_372            24D0
EXIT_375            24F4
EXIT_380            253E
EXIT_382            259A
EXIT_45             574
EXIT_5              240
EXIT_52             5EA
EXIT_7              260
EXIT_92             9FA
EXIT_94             A1A
EXIT_98             A4C
FOR                 27D3
FROM                2815
G                   C6C
GET_INPUT           364
H                   474
HASH                1350
HELP                25B3
HELPPROMPT          25A0
HEX2BIN             10B
HEX2BIN_LUT         279A
HEX_DIGIT           23D8
HUH                 2728
I                   1366
IDE_COMMAND_READ_WITH_RETRY  20
IDE_COMMAND_REGISTER  7
IDE_DATA_REGISTER   0
IDE_DRIVESEL_MASTER  E0
IDE_DRIVESEL_REGISTER  6
IDE_LBA_0_7_REGISTER  3
IDE_LBA_16_23_REGISTER  5
IDE_LBA_8_15_REGISTER  4
IDE_SECTOR_COUNT_REGISTER  2
IDE_STATUS_BUSY     7
IDE_STATUS_DRQ      3
IDE_STATUS_READY    6
IDE_STATUS_REGISTER  7
ILLEGAL_HANDLER     2546
INDEX_SEP           27E3
L                   D62
LF                  A
LOADING             27B1
LOOP_10             26C
LOOP_105            ABC
LOOP_107            ADC
LOOP_109            B1A
LOOP_110            AFC
LOOP_115            B46
LOOP_118            B76
LOOP_120            BB4
LOOP_121            B96
LOOP_125            BE0
LOOP_127            C20
LOOP_128            C02
LOOP_133            C4C
LOOP_135            CC8
LOOP_137            D0A
LOOP_138            CEC
LOOP_143            D36
LOOP_15             2B6
LOOP_150            DC8
LOOP_153            E38
LOOP_155            E78
LOOP_156            E5A
LOOP_160            EA4
LOOP_162            EE4
LOOP_163            EC6
LOOP_167            F10
LOOP_169            F4E
LOOP_17             2D6
LOOP_170            F30
LOOP_175            F7A
LOOP_190            109C
LOOP_193            1100
LOOP_195            113E
LOOP_196            1120
LOOP_20             2F6
LOOP_200            116A
LOOP_202            11AA
LOOP_203            118C
LOOP_208            11D6
LOOP_212            1218
LOOP_214            1258
LOOP_215            123A
LOOP_22             348
LOOP_220            1284
LOOP_222            12A4
LOOP_224            12E4
LOOP_225            12C6
LOOP_230            1310
LOOP_234            13A8
LOOP_238            13E6
LOOP_250            15BE
LOOP_253            15FC
LOOP_264            17A8
LOOP_28             3D4
LOOP_282            1A92
LOOP_284            1AD0
LOOP_285            1AB2
LOOP_292            1B9A
LOOP_294            1BD8
LOOP_295            1BBA
LOOP_30             454
LOOP_302            1CA2
LOOP_304            1CE0
LOOP_305            1CC2
LOOP_312            1DAA
LOOP_314            1DE8
LOOP_315            1DCA
LOOP_32             480
LOOP_320            1E14
LOOP_324            1ECA
LOOP_328            1F18
LOOP_34             4C8
LOOP_340            20F0
LOOP_343            212E
LOOP_35             4AA
LOOP_358            23B8
LOOP_361            23F6
LOOP_363            2422
LOOP_365            2446
LOOP_367            2488
LOOP_368            246A
LOOP_372            24B4
LOOP_374            24F6
LOOP_375            24D8
LOOP_380            2522
LOOP_382            257E
LOOP_45             558
LOOP_5              224
LOOP_52             5CE
LOOP_7              244
LOOP_9              28A
LOOP_92             9DE
LOOP_94             9FE
LOOP_98             A30
MAIN_LOOP           344
MC68230_BASE        A00000
MC68230_GENERAL_CONTROL  A00001
MC68230_GENERAL_CONTROL_  0
MC68230_INTERRUPT_VECTOR  A0000B
MC68230_INTERRUPT_VECTOR_  5
MC68230_PORT_A_ALTERNATE  A00015
MC68230_PORT_A_ALTERNATE_  A
MC68230_PORT_A_CONTROL  A0000D
MC68230_PORT_A_CONTROL_  6
MC68230_PORT_A_DATA  A00011
MC68230_PORT_A_DATA_  8
MC68230_PORT_A_DIRECTION  A00005
MC68230_PORT_A_DIRECTION_  2
MC68230_PORT_B_ALTERNATE  A00017
MC68230_PORT_B_ALTERNATE_  B
MC68230_PORT_B_CONTROL  A0000F
MC68230_PORT_B_CONTROL_  7
MC68230_PORT_B_DATA  A00013
MC68230_PORT_B_DATA_  9
MC68230_PORT_B_DIRECTION  A00007
MC68230_PORT_B_DIRECTION_  3
MC68230_PORT_C_CS   8
MC68230_PORT_C_DATA  A00019
MC68230_PORT_C_DATA_  C
MC68230_PORT_C_DIRECTION  A00009
MC68230_PORT_C_DIRECTION_  4
MC68230_PORT_C_READ  20
MC68230_PORT_C_WRITE  10
MC68230_PORT_DIRECTION_READ  0
MC68230_PORT_DIRECTION_WRITE  FF
MC68230_SERVICE_REQUEST  A00003
MC68230_SERVICE_REQUEST_  1
MC68230_STATUS      A0001B
MC68230_STATUS_     D
NULL                0
OX                  27CB
P                   1044
PRINTIT             480
PRINTIT_RTE         257E
PRINT_CHAR          203
PRINT_CRLF          3A0
PRINT_REG           4E8
PRINT_REG_4BIT      438
PRINT_STR           3CB
PROGRAM             CFE
PROGRAM_VECTOR      D95
PROMPT              27C8
PROTECT             AF0
R                   4A0
RAM                 200000
RAM_ERROR           2779
READ                272F
READING             2803
READ_16             1188
READ_32             13B5
READ_8              E13
READ_CHAR           6DD
READ_IDE_STATUS     1404
RESET               4
ROM                 0
S                   5F2
SEND_COMMAND        1686
SEND_READ_COMMAND_AND_WAIT  16B5
SET_READ_ADDRESS    1524
SPURIOUS            2851
SPURIOUS_HANDLER    257A
STACK               0
STACK_ADDRESS       2E0000
STACK_POINTER       27D9
START               104
STATUS_REGISTER     27DE
TAB                 9
TICK                27E7
TICK_HANDLER        256A
TO                  27CE
UNHANDLED           281C
UNHANDLED_HANDLER   2556
UNINITIALISED       2832
UNINITIALISED_HANDLER  2560
UNPROTECT           A29
UNREC               2751
USER                100
V                   47C
VECS                8
VERSION             2866
W                   578
WAIT_CHAR           599
WAIT_DRIVE_DRQ      14D4
WAIT_DRIVE_NOT_BUSY  1483
WAIT_DRIVE_READY    1431
WAIT_FOR_COMPLETE_177  FA8
WAIT_FOR_COMPLETE_179  FCA
WAIT_FOR_COMPLETE_180  FDC
WAIT_FOR_COMPLETE_182  100A
WAIT_FOR_COMPLETE_183  101C
WAIT_FOR_COMPLETE_210  11F4
WAIT_FOR_READY_1    1CE
WAIT_FOR_READY_101  A5E
WAIT_FOR_READY_106  AC4
WAIT_FOR_READY_108  AE4
WAIT_FOR_READY_11   274
WAIT_FOR_READY_111  B04
WAIT_FOR_READY_113  B2C
WAIT_FOR_READY_116  B4E
WAIT_FOR_READY_119  B7E
WAIT_FOR_READY_122  B9E
WAIT_FOR_READY_124  BC6
WAIT_FOR_READY_126  BE8
WAIT_FOR_READY_129  C0A
WAIT_FOR_READY_13   29C
WAIT_FOR_READY_131  C32
WAIT_FOR_READY_134  C54
WAIT_FOR_READY_136  CD0
WAIT_FOR_READY_139  CF4
WAIT_FOR_READY_141  D1C
WAIT_FOR_READY_144  D3E
WAIT_FOR_READY_145  D70
WAIT_FOR_READY_147  D8A
WAIT_FOR_READY_151  DD0
WAIT_FOR_READY_154  E40
WAIT_FOR_READY_157  E62
WAIT_FOR_READY_159  E8A
WAIT_FOR_READY_16   2BE
WAIT_FOR_READY_161  EAC
WAIT_FOR_READY_164  ECE
WAIT_FOR_READY_166  EF6
WAIT_FOR_READY_168  F18
WAIT_FOR_READY_171  F38
WAIT_FOR_READY_173  F60
WAIT_FOR_READY_176  F82
WAIT_FOR_READY_18   2DE
WAIT_FOR_READY_185  1050
WAIT_FOR_READY_187  106A
WAIT_FOR_READY_191  10A4
WAIT_FOR_READY_194  1108
WAIT_FOR_READY_197  1128
WAIT_FOR_READY_199  1150
WAIT_FOR_READY_2    1E2
WAIT_FOR_READY_201  1172
WAIT_FOR_READY_204  1194
WAIT_FOR_READY_206  11BC
WAIT_FOR_READY_209  11DE
WAIT_FOR_READY_21   2FE
WAIT_FOR_READY_213  1220
WAIT_FOR_READY_216  1242
WAIT_FOR_READY_218  126A
WAIT_FOR_READY_221  128C
WAIT_FOR_READY_223  12AC
WAIT_FOR_READY_226  12CE
WAIT_FOR_READY_228  12F6
WAIT_FOR_READY_23   350
WAIT_FOR_READY_231  1318
WAIT_FOR_READY_24   364
WAIT_FOR_READY_26   37E
WAIT_FOR_READY_263  1792
WAIT_FOR_READY_265  17B0
WAIT_FOR_READY_272  1902
WAIT_FOR_READY_273  1916
WAIT_FOR_READY_274  192A
WAIT_FOR_READY_275  193E
WAIT_FOR_READY_283  1A9A
WAIT_FOR_READY_286  1ABA
WAIT_FOR_READY_288  1AE2
WAIT_FOR_READY_29   3DC
WAIT_FOR_READY_293  1BA2
WAIT_FOR_READY_296  1BC2
WAIT_FOR_READY_298  1BEA
WAIT_FOR_READY_3    1F6
WAIT_FOR_READY_303  1CAA
WAIT_FOR_READY_306  1CCA
WAIT_FOR_READY_308  1CF2
WAIT_FOR_READY_31   45C
WAIT_FOR_READY_313  1DB2
WAIT_FOR_READY_316  1DD2
WAIT_FOR_READY_318  1DFA
WAIT_FOR_READY_321  1E1C
WAIT_FOR_READY_33   488
WAIT_FOR_READY_346  216C
WAIT_FOR_READY_359  23C0
WAIT_FOR_READY_36   4B2
WAIT_FOR_READY_362  23FE
WAIT_FOR_READY_364  242A
WAIT_FOR_READY_366  244E
WAIT_FOR_READY_369  2472
WAIT_FOR_READY_371  249A
WAIT_FOR_READY_373  24BC
WAIT_FOR_READY_376  24E0
WAIT_FOR_READY_378  2508
WAIT_FOR_READY_38   4DA
WAIT_FOR_READY_381  252A
WAIT_FOR_READY_383  2586
WAIT_FOR_READY_39   4F0
WAIT_FOR_READY_40   506
WAIT_FOR_READY_41   51A
WAIT_FOR_READY_42   52E
WAIT_FOR_READY_43   542
WAIT_FOR_READY_46   560
WAIT_FOR_READY_47   582
WAIT_FOR_READY_49   59C
WAIT_FOR_READY_53   5D6
WAIT_FOR_READY_54   5FC
WAIT_FOR_READY_56   636
WAIT_FOR_READY_57   64C
WAIT_FOR_READY_6    22C
WAIT_FOR_READY_60   690
WAIT_FOR_READY_64   712
WAIT_FOR_READY_68   772
WAIT_FOR_READY_72   7DC
WAIT_FOR_READY_76   848
WAIT_FOR_READY_8    24C
WAIT_FOR_READY_80   8BE
WAIT_FOR_READY_84   91E
WAIT_FOR_READY_88   97E
WAIT_FOR_READY_93   9E6
WAIT_FOR_READY_95   A06
WAIT_FOR_READY_96   A1A
WAIT_FOR_READY_99   A38
WAIT_FOR_SRECORD    5FC
WRITE               2442
WRITE_8             FCC
WRITING             280C
X                   1214
Z                   C72
_00000000           218
_00000001           3A4
_00000002           3B8
_00000003           6F2
_00000004           A50
_00000005           700
_00000006           8A6
_00000007           82E
_00000008           A50
_00000009           9DA
_0000000A           A50
_0000000B           B66
_0000000C           B72
_0000000D           D52
_0000000E           FB2
_0000000F           FD4
_00000010           FE6
_00000011           1014
_00000012           1026
_00000013           11FE
_00000014           1E36
_00000015           17C4
_00000016           1950
_00000017           1AF8
_00000018           1C00
_00000019           1D08
_0000001A           1E30
_0000001B           1E80
_0000001C           234E
_0000001D           2350
_10000000           686
_10000001           6DC
_10000002           708
_10000003           75E
_10000004           768
_10000005           7BE
_10000006           7D2
_10000007           828
_10000008           832
_10000009           8A0
_1000000A           83E
_1000000B           894
_1000000C           8B4
_1000000D           90A
_1000000E           914
_1000000F           96A
_10000010           974
_10000011           9CA
_10000012           A54
_10000013           AAA
_10000014           F96
_10000015           FB8
_10000016           16D4
_10000017           1E84
_10000018           1F0E
_10000019           23B4
_20000000           132
_20000001           13E
_20000002           14C
_20000003           158
_20000004           580
_20000005           5C4
_20000006           C84
_20000007           C94
_20000008           CAE
_20000009           D54
_2000000A           D6E
_2000000B           DB2
_2000000C           E2A
_2000000D           E2E
_2000000E           FEE
_2000000F           1028
_20000010           104E
_20000011           1092
_20000012           10F2
_20000013           10F6
_20000014           1862
_20000015           1952
_20000016           2356
_20000017           23A4
